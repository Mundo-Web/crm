import{C as B,c as z,j as r,r as n}from"./CreateReactScript-CdFATXLL.js";import{a as D,S as O}from"./SetSelectValue-LobsmpW5.js";import{S as H}from"./StatusesRest-tekotSX4.js";import{A as U}from"./Adminto-B_ZcJn3o.js";import{M as V}from"./Modal-BJsTSCqc.js";import{I as g}from"./InputFormGroup-BPFMjg9P.js";import{T as W}from"./TextareaFormGroup-q-Exg-UZ.js";import{S as Y}from"./sweetalert2.esm.all-BuvcKzCS.js";import{C as E}from"./CheckboxFormGroup-b80e8ZQD.js";import{S as J}from"./SelectFormGroup-Hk9l0VmW.js";import"./Logout-Dfbya5P9.js";const P=new H,K=({statuses:d,tables:t})=>{const[a,m]=n.useState(d);n.useRef();const p=n.useRef(),f=n.useRef(),c=n.useRef(),h=n.useRef(),x=n.useRef(),b=n.useRef(),j=n.useRef(),N=n.useRef(),v=n.useRef(),[F,w]=n.useState(!1),[R,S]=n.useState(!1),[y,C]=n.useState(!1),[G,I]=n.useState(!1),[_,A]=n.useState(!0),q=e=>{var l,s,i,o,u,k;e!=null&&e.id?w(!0):w(!1),I(((l=e==null?void 0:e.table)==null?void 0:l.id)=="e05a43e5-b3a6-46ce-8d1f-381a73498f33"||((s=e==null?void 0:e.table)==null?void 0:s.id)=="a8367789-666e-4929-aacb-7cbc2fbf74de"),A(((i=e==null?void 0:e.table)==null?void 0:i.id)=="e05a43e5-b3a6-46ce-8d1f-381a73498f33"),C((e==null?void 0:e.pipeline)??!1),f.current.value=(e==null?void 0:e.id)||null,O(c.current,(o=e==null?void 0:e.table)==null?void 0:o.id,(u=e==null?void 0:e.table)==null?void 0:u.name),$(v.current).val((e==null?void 0:e.children)??[]).trigger("change"),(k=e==null?void 0:e.table)!=null&&k.id?$(c.current).parents(".form-group").hide():$(c.current).parents(".form-group").show(),h.current.value=(e==null?void 0:e.name)||null,x.current.value=(e==null?void 0:e.color)||"#343a40",b.current.value=(e==null?void 0:e.order)||"",j.current.value=(e==null?void 0:e.description)||null,S((e==null?void 0:e.require)||!1),$(p.current).modal("show")},M=async e=>{e.preventDefault();const l={id:f.current.value||void 0,table_id:c.current.value,name:h.current.value,color:x.current.value,order:b.current.value,description:j.current.value,require:R,action_required:R?"product":null,pipeline:y,children:$(v.current).val()},s=await P.save(l);s&&(a.find(i=>i.id==s.id)?m(i=>{const o=i.findIndex(u=>u.id==s.id);return i[o]=s,[...i]}):m(i=>[...i,s]),$(p.current).modal("hide"))},T=async e=>{const{isConfirmed:l}=await Y.fire({title:"Estas seguro de eliminar este estado?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!l||!await P.delete(e)||m(i=>[...i.filter(o=>o.id!=e)])};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"container",children:r.jsx("div",{className:"row align-items-start justify-content-center",children:t.map((e,l)=>r.jsx("div",{className:"col-md-6",children:r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[r.jsx("h5",{className:"my-0 text-capitalize",children:e.name}),r.jsx("button",{className:"btn btn-xs btn-primary rounded-pill",onClick:()=>q({table:e}),children:"Nuevo estado"})]})}),r.jsx("div",{className:"card-body d-flex align-items-start justify-content-center gap-2",style:{flexWrap:"wrap",minHeight:"200px",maxHeight:"300px",overflowY:"auto"},children:a.filter(s=>s.table_id===e.id).sort((s,i)=>s.order-i.order).map((s,i)=>r.jsxs("div",{className:"btn-group dropup col-auto",children:[r.jsxs("span",{type:"button",className:"btn btn-sm btn-white d-flex gap-2 align-items-center",style:{cursor:"default"},children:[r.jsx("h4",{className:"my-0",children:s.order}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{children:[r.jsx("i",{className:"mdi mdi-circle me-1",style:{color:s.color}}),s.name,s.require&&r.jsx("span",{className:"text-danger ms-1",children:"*"}),r.jsx("span",{className:"badge rounded-pill bg-secondary ms-1",children:s.children_count})]}),r.jsxs("small",{className:"text-muted",style:{fontSize:"10px"},children:["Ult. uso: ",s.last_used_at]})]})]}),r.jsx("button",{type:"button",className:"btn btn-sm btn-white dropdown-toggle","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:r.jsx("i",{className:"mdi mdi-dots-vertical"})}),r.jsxs("div",{className:"dropdown-menu",children:[r.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>q(s),children:"Editar"}),r.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>T(s.id),children:"Eliminar"})]})]},i))})]})},l))})}),r.jsx(V,{modalRef:p,title:F?"Editar estado":"Agregar estado",onSubmit:M,size:"sm",children:r.jsxs("div",{className:"row",id:"status-crud-container",children:[r.jsx("input",{ref:f,type:"hidden"}),r.jsx(g,{eRef:h,label:"Nombre de estado",col:"col-12",required:!0}),r.jsx(D,{eRef:c,label:"Tabla",col:"col-12",dropdownParent:"#status-crud-container",searchAPI:"/api/tables/paginate",searchBy:"name",required:!0}),r.jsx(g,{eRef:x,type:"color",label:"Color",col:"col-6",required:!0}),r.jsx(g,{eRef:b,type:"number",label:"Orden",col:"col-6",required:!0}),r.jsx(W,{eRef:j,label:"Descripcion",col:"col-12"}),r.jsx("div",{className:"col-12 mb-2",children:r.jsx(E,{eRef:N,label:"¿Requerir producto?",id:"require",title:"Obliga al usuario a escoger un producto antes de cambiar a este estado",checked:R,setChecked:S})}),r.jsx("div",{className:"col-12 mb-2",hidden:!G,children:r.jsx(E,{eRef:N,label:"¿Mostrar en Pipeline?",id:"pipeline",title:"Si está activo, este estado aparecerá en el pipeline de leads; si no, permanecerá oculto",checked:y,setChecked:C})}),r.jsx("div",{className:"col-12 ",hidden:!_,children:r.jsx(J,{eRef:v,label:"Estados hijos",dropdownParent:"#status-crud-container",multiple:!0,children:a.filter(({table_id:e})=>e=="9c27e649-574a-47eb-82af-851c5d425434").map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))})})]})})]})};B((d,t)=>{if(!t.can("statuses","root","all","list"))return location.href="/";z(d).render(r.jsx(U,{...t,title:"Gestor de estados",children:r.jsx(K,{...t})}))});
