import{C as F,c as G,j as s,r as n}from"./CreateReactScript-CdFATXLL.js";import{a as M,S as T}from"./SetSelectValue-LobsmpW5.js";import{S as B}from"./StatusesRest-DlbZc1G5.js";import{A as z}from"./Adminto-B_ZcJn3o.js";import{M as D}from"./Modal-C8cczzz-.js";import{I as v}from"./InputFormGroup-BPFMjg9P.js";import{T as O}from"./TextareaFormGroup-q-Exg-UZ.js";import{S as H}from"./sweetalert2.esm.all-BuvcKzCS.js";import{C as q}from"./CheckboxFormGroup-b80e8ZQD.js";import"./Logout-Dfbya5P9.js";const k=new B,U=({statuses:a,tables:o})=>{const[R,d]=n.useState(a);n.useRef();const m=n.useRef(),p=n.useRef(),c=n.useRef(),f=n.useRef(),x=n.useRef(),h=n.useRef(),b=n.useRef(),g=n.useRef(),[E,N]=n.useState(!1),[j,w]=n.useState(!1),[y,S]=n.useState(!1),[P,I]=n.useState(!1),C=e=>{var l,r,i,t,u;e!=null&&e.id?N(!0):N(!1),I(((l=e==null?void 0:e.table)==null?void 0:l.id)=="e05a43e5-b3a6-46ce-8d1f-381a73498f33"||((r=e==null?void 0:e.table)==null?void 0:r.id)=="a8367789-666e-4929-aacb-7cbc2fbf74de"),S((e==null?void 0:e.pipeline)??!1),p.current.value=(e==null?void 0:e.id)||null,T(c.current,(i=e==null?void 0:e.table)==null?void 0:i.id,(t=e==null?void 0:e.table)==null?void 0:t.name),(u=e==null?void 0:e.table)!=null&&u.id?$(c.current).parents(".form-group").hide():$(c.current).parents(".form-group").show(),f.current.value=(e==null?void 0:e.name)||null,x.current.value=(e==null?void 0:e.color)||"#343a40",h.current.value=(e==null?void 0:e.order)||"",b.current.value=(e==null?void 0:e.description)||null,w((e==null?void 0:e.require)||!1),$(m.current).modal("show")},_=async e=>{e.preventDefault();const l={id:p.current.value||void 0,table_id:c.current.value,name:f.current.value,color:x.current.value,order:h.current.value,description:b.current.value,require:j,action_required:j?"product":null,pipeline:y},r=await k.save(l);r&&(R.find(i=>i.id==r.id)?d(i=>{const t=i.findIndex(u=>u.id==r.id);return i[t]=r,[...i]}):d(i=>[...i,r]),$(m.current).modal("hide"))},A=async e=>{const{isConfirmed:l}=await H.fire({title:"Estas seguro de eliminar este estado?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!l||!await k.delete(e)||d(i=>[...i.filter(t=>t.id!=e)])};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"container",children:s.jsx("div",{className:"row align-items-start justify-content-center",children:o.map((e,l)=>s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[s.jsx("h5",{className:"my-0 text-capitalize",children:e.name}),s.jsx("button",{className:"btn btn-xs btn-primary rounded-pill",onClick:()=>C({table:e}),children:"Nuevo estado"})]})}),s.jsx("div",{className:"card-body d-flex align-items-start justify-content-center gap-2",style:{flexWrap:"wrap",minHeight:"200px",maxHeight:"300px",overflowY:"auto"},children:R.filter(r=>r.table_id===e.id).sort((r,i)=>r.order-i.order).map((r,i)=>s.jsxs("div",{className:"btn-group dropup col-auto",children:[s.jsxs("span",{type:"button",className:"btn btn-sm btn-white d-flex gap-2 align-items-center",style:{cursor:"default"},children:[s.jsx("h4",{className:"my-0",children:r.order}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{children:[s.jsx("i",{className:"mdi mdi-circle me-1",style:{color:r.color}}),r.name,r.require&&s.jsx("span",{className:"text-danger ms-1",children:"*"}),s.jsx("span",{className:"badge rounded-pill bg-secondary ms-1",children:r.children_count})]}),s.jsxs("small",{className:"text-muted",style:{fontSize:"10px"},children:["Ult. uso: ",r.last_used_at]})]})]}),s.jsx("button",{type:"button",className:"btn btn-sm btn-white dropdown-toggle","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:s.jsx("i",{className:"mdi mdi-dots-vertical"})}),s.jsxs("div",{className:"dropdown-menu",children:[s.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>C(r),children:"Editar"}),s.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>A(r.id),children:"Eliminar"})]})]},i))})]})},l))})}),s.jsx(D,{modalRef:m,title:E?"Editar estado":"Agregar estado",onSubmit:_,size:"sm",children:s.jsxs("div",{className:"row",id:"status-crud-container",children:[s.jsx("input",{ref:p,type:"hidden"}),s.jsx(v,{eRef:f,label:"Nombre de estado",col:"col-12",required:!0}),s.jsx(M,{eRef:c,label:"Tabla",col:"col-12",dropdownParent:"#status-crud-container",searchAPI:"/api/tables/paginate",searchBy:"name",required:!0}),s.jsx(v,{eRef:x,type:"color",label:"Color",col:"col-6",required:!0}),s.jsx(v,{eRef:h,type:"number",label:"Orden",col:"col-6",required:!0}),s.jsx(O,{eRef:b,label:"Descripcion",col:"col-12"}),s.jsx("div",{className:"col-12",children:s.jsx(q,{eRef:g,label:"¿Requerir producto?",id:"require",title:"Obliga al usuario a escoger un producto antes de cambiar a este estado",checked:j,setChecked:w})}),s.jsx("div",{className:"col-12 mt-2",hidden:!P,children:s.jsx(q,{eRef:g,label:"¿Mostrar en Pipeline?",id:"pipeline",title:"Si está activo, este estado aparecerá en el pipeline de leads; si no, permanecerá oculto",checked:y,setChecked:S})})]})})]})};F((a,o)=>{if(!o.can("statuses","root","all","list"))return location.href="/";G(a).render(s.jsx(z,{...o,title:"Gestor de estados",children:s.jsx(U,{...o})}))});
