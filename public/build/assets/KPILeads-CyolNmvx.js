var D=Object.defineProperty;var J=(d,l,i)=>l in d?D(d,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[l]=i;var b=(d,l,i)=>J(d,typeof l!="symbol"?l+"":l,i);import{m as g,C as V,c as X,j as e,r as n,G as h}from"./CreateReactScript-DWfX8fUe.js";import{A as z,i as x}from"./Adminto-MJzZ0wrP.js";import{S as Q}from"./SelectFormGroup-CfDcQqlq.js";import{r as Z}from"./server.browser-Czgk6xS9.js";import{N as m}from"./Number2Currency-e57Tgsuk.js";import{S as ee}from"./sweetalert2.esm.all-C4h_z6Pa.js";import"./Logout-2N6K_MpN.js";class S{}b(S,"kpi",async l=>{const{result:i}=await g.Fetch(`/api/dashboard/leads/kpi/${l}`);return{data:(i==null?void 0:i.data)??[],summary:(i==null?void 0:i.summary)??{}}});const ae=({months:d=[],currentMonth:l,currentYear:i})=>{const[j,y]=n.useState(`${i}-${l}`),[w,C]=n.useState([]),[_,k]=n.useState([]),[A,E]=n.useState(0),[M,P]=n.useState(0),[F,q]=n.useState(0),[I,T]=n.useState(0),[G,R]=n.useState(0),[L,Y]=n.useState(0),[W,B]=n.useState(0),[O,H]=n.useState(0),[c,p]=n.useState({}),[v,N]=n.useState([]),[K,U]=n.useState([]),f=({id:a,text:s,element:t})=>{if(!a)return s;const r=$(t).data("option");return $(Z(e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:s}),e.jsxs("small",{children:[e.jsx("i",{className:"me-1 fa fa-users"}),r.quantity," entradas"]})]})))};n.useEffect(()=>{p({}),N([]),S.kpi(j).then(({data:a,summary:s})=>{k(a),C(s.grouped??[]),E(s.totalCount??0),P(s.clientsCount??0),q(s.archivedCount??0),T(s.managingCount??0),R(s.totalSum??0),Y(s.clientsSum??0),B(s.archivedSum??0),H(s.managingSum??0),p(s.leadSources??{}),N(s.originCounts??[]),U(s.usersAssignation??[])})},[j]),n.useEffect(()=>{const a=document.getElementById("leadsStatusPie");let s;return a&&(window.leadsStatusChart&&window.leadsStatusChart.destroy(),s=new Chart(a,{type:"pie",data:{labels:[h.APP_NAME,"WhatsApp","Integración"],datasets:[{data:[c.crm_count,c.whatsapp_count,c.integration_count],backgroundColor:["#f1556c","#1abc9c","#4a81d4"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),window.leadsStatusChart=s),()=>{window.leadsStatusChart&&window.leadsStatusChart.destroy()}},[c]),n.useEffect(()=>($('[data-plugin="knob"]').knob({draw:function(){const a=this.i.attr("data-count");$(this.i).val(a)}}),()=>{$('[data-plugin="knob"]').trigger("change")}),[c,v]),n.useEffect(()=>{g.GET.message&&(ee.fire({icon:"success",title:"Operación exitosa",text:g.GET.message}),history.pushState(null,null,"/home"))},[null]);const u=c.crm_count+c.whatsapp_count+c.integration_count;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2",children:e.jsx(Q,{minimumResultsForSearch:-1,templateResult:f,templateSelection:f,onChange:a=>y(a.target.value),children:d.map((a,s)=>{const t=moment({month:a.month-1,year:a.year});return e.jsx("option",{value:a.id,"data-option":JSON.stringify(a),children:t.format("MMMM YYYY").toTitleCase()},s)})})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("h4",{className:"mt-0 mb-2",children:"Vista general de leads"})})}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card card-body",children:[e.jsx("div",{style:{height:"250px"},children:e.jsx("canvas",{id:"leadsStatusPie",width:"100%",height:"100%"})}),e.jsx("h4",{className:"mt-3 mb-2 text-center",children:"Ingreso de leads"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-evenly",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#f1556c","data-bgcolor":"#f1556c33",value:c.crm_count/u*100||0,"data-count":c.crm_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center",children:h.APP_NAME})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#1abc9c","data-bgcolor":"#1abc9c33",value:c.whatsapp_count/u*100||0,"data-count":c.whatsapp_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center",children:"WhatsApp"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#4a81d4","data-bgcolor":"#4a81d433",value:c.integration_count/u*100||0,"data-count":c.integration_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center",children:"Integracion"})]})]})]})}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-info","data-plugin":"counterup",children:A}),e.jsx("h5",{children:"Leads"}),e.jsxs("small",{children:["S/. ",m(G)]})]})})})}),e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-success","data-plugin":"counterup",children:M}),e.jsx("h5",{children:"Convertidos"}),e.jsxs("small",{children:["S/. ",m(L)]})]})})})}),e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-danger","data-plugin":"counterup",children:F}),e.jsx("h5",{children:"No convertidos"}),e.jsxs("small",{children:["S/. ",m(W)]})]})})})}),e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-primary","data-plugin":"counterup",children:I}),e.jsx("h5",{children:"En gestion"}),e.jsxs("small",{children:["S/. ",m(O)]})]})})})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"header-title text-center my-0",children:"Ingreso de Leads por Integración"})}),e.jsx("div",{className:" card-body",style:{minHeight:"160px"},children:e.jsx("div",{className:"d-flex flex-wrap gap-2 justify-content-evenly",children:v.map((a,s)=>{const t=a.count||0,r=t/c.integration_count*100,o=`${t.origin}-${t.count}-${s}`;return e.jsxs("div",{id:o,className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"100","data-height":"100","data-fgcolor":"#4a81d4","data-bgcolor":"#4a81d433",value:r,"data-count":t,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center mt-1",children:a.origin})]},o)})})})]})})})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xl-3 col-lg-4 col-sm-6 col-xs-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-danger",children:e.jsxs("h4",{className:"header-title my-0 text-white",children:[e.jsx("i",{className:"mdi mdi-podium-gold me-1"}),"Ranking de atenciones"]})}),e.jsx("div",{className:"card-body",style:{maxHeight:"400px",overflowY:"auto"},children:e.jsx("div",{className:"inbox-widget",children:K.sort((a,s)=>s.count-a.count).map((a,s)=>{const t=`${a.assigned.name.split(" ")[0]} ${a.assigned.lastname.split(" ")[0]}`;return e.jsxs("div",{className:"inbox-item",children:[e.jsxs("div",{className:"inbox-item-img position-relative",children:[s<=1&&e.jsx("i",{className:`user-featured position-absolute mdi mdi-star ${s==0&&"text-warning"}`}),e.jsx("img",{className:`rounded-circle aspect-square ${s==0&&"border-warning"}`,src:`//${h.APP_DOMAIN}/api/profile/thumbnail/${a.assigned.relative_id}`,style:{padding:s<=1?"2px":0,border:s<=1?"2px solid":0},onError:r=>{r.target.onerror=null,r.target.src=`//ui-avatars.com/api/?name=${t.replaceAll(" ","+")}&color=7F9CF5&background=EBF4FF`}})]}),e.jsx("h5",{className:"inbox-item-author mt-0 mb-2 text-truncate",children:t}),e.jsx("p",{className:"inbox-item-text",children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap w-100",children:[e.jsx(x,{content:`${a.count} leads atendidos`,children:e.jsxs("div",{className:"text-start",style:{width:"50px"},children:[e.jsx("i",{className:"mdi mdi-account me-1"}),a.count]})}),e.jsx(x,{content:`${a.emails_sent} mails enviados`,children:e.jsxs("div",{className:"text-start",style:{width:"50px"},children:[e.jsx("i",{className:"mdi mdi-email-send me-1"}),a.emails_sent]})}),a.converted!==null&&e.jsx(x,{content:`${a.converted} leads convertidos`,children:e.jsxs("div",{className:"text-start",style:{width:"50px"},children:[e.jsx("i",{className:"mdi mdi-account-check me-1"}),a.converted]})})]})})]},s)})})})]})}),e.jsx("div",{className:"col-xl-9 col-lg-8 col-sm-6 col-xs-12",children:e.jsx("div",{className:"d-flex gap-3 mb-3",style:{overflowX:"auto"},children:w.map((a,s)=>e.jsxs("div",{className:"card",style:{minWidth:"270px",maxWidth:"270px"},children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"header-title my-0 text-truncate w-100",style:{color:a.color},children:a.name}),e.jsx("small",{className:"font-bold",children:e.jsx("b",{children:a.quantity})})]}),e.jsx("div",{className:"card-body",style:{maxHeight:"400px",overflowY:"auto"},children:e.jsx("div",{className:"d-flex gap-3 flex-column",children:_.filter(({status_id:t})=>t==a.id).sort((t,r)=>r.quantity-t.quantity).map((t,r)=>{const o=(t.quantity/a.quantity*100).toFixed(2);return e.jsxs("div",{children:[e.jsxs("h5",{className:"my-0",children:[t.manage_status_name," ",e.jsx("span",{className:"float-end",style:{color:t.manage_status_color},children:t.quantity})]}),e.jsx("div",{className:"progress progress-bar-alt-primary progress-sm mt-0",style:{backgroundColor:`${t.manage_status_color}44`},children:e.jsx("div",{className:"progress-bar progress-animated wow animated animated",role:"progressbar","aria-valuenow":o,"aria-valuemin":"0","aria-valuemax":"100",style:{width:`${o}%`,visibility:"visible",animationName:"animationProgress",backgroundColor:t.manage_status_color}})})]},r)})})})]},s))})})]})]})};V((d,l)=>{X(d).render(e.jsx(z,{...l,title:"KPI - Leads",children:e.jsx(ae,{...l})}))});
