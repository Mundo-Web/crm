var Gs=Object.defineProperty;var Hs=(h,a,o)=>a in h?Gs(h,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):h[a]=o;var me=(h,a,o)=>Hs(h,typeof a!="symbol"?a+"":a,o);import{r as i,j as e,m as F,G as M,L as le,C as zs,c as qs}from"./CreateReactScript-DSh221L4.js";import{i as H,S as ce,B as Ws,W as Ys,A as Vs}from"./Adminto-CxkkDmWv.js";import{Q as Xs,a as Ks}from"./QuillFormGroup-MokamjrH.js";import{C as Qs,a as Js,P as Zs,b as us,H as hs,T as Ls}from"./ProductsByClientsRest-CKl_dIfx.js";import{L as Ns}from"./LeadsRest-D6W3Dn0K.js";import{T as et}from"./TasksRest-BNnU4CMm.js";import{U as vs}from"./UsersRest-CuirQA9r.js";import{M as xe}from"./Modal-D-tXYeXz.js";import{I as ie}from"./InputFormGroup-DsuG1yrP.js";import{T as ws}from"./TextareaFormGroup-CVonM_0b.js";import{S as pe}from"./SelectFormGroup-D827EBoU.js";import{T as ne}from"./TippyButton-BY7aP8sy.js";import{a as st,S as tt}from"./SetSelectValue-HiwDtLZy.js";import{D as ys}from"./Dropdown-7dNvA4Pv.js";import{D as Se}from"./DropdownItem-BOKSg5Pi.js";import{N as _e}from"./Number2Currency-e57Tgsuk.js";import{r as ps}from"./server.browser-DoheiHq8.js";import{R as nt}from"./RepositoryDropzone-ClzfO_tq.js";import{T as at,D as xs}from"./DxPanelButton-B7q8MKlo.js";import{R as ee}from"./ReactAppend-CCPXxX5R.js";import{S as rt}from"./StatusesRest-aDNm-4OS.js";const fs=h=>String(h).toLowerCase().split(" ").map(a=>a.trim()).filter(Boolean).join("-"),it=async(h,a)=>{const o=h.getBoundingClientRect(),b=o.left+window.scrollX,I=o.top+window.scrollY,A=b+o.width/2,q=I+o.height/2,_=a.getBoundingClientRect(),U=_.left+window.scrollX,y=_.top+window.scrollY,G=U+_.width/2,O=y+_.height/2,k=`
    @keyframes xAxis {
      0% {
        left: ${A}px;
        top: ${q}px;
      }
      100% {
        left: ${G}px;
        top: ${O}px;
      }
    }
    @keyframes yAxis {
      0% {
        color: #343a40;
      }
      100% {
        color: #343a40;
      }
    }
  `;$("#send-to-div-style").attr("href","data:text/css;charset=UTF-8,"+encodeURIComponent(k))},ct=h=>{const a=$("#icon-2-send");a.addClass("sending-to-div"),setTimeout(()=>{a.removeClass("sending-to-div"),$(h).addClass("shake"),setTimeout(function(){$(h).removeClass("shake")},1e3)},1e3)},lt=({onChange:h=()=>{},onDelete:a=()=>{},...o})=>{const[b,I]=i.useState(!1),[A,q]=i.useState(o.pivot_price),_=i.useRef(null);i.useEffect(()=>{const y=G=>{_.current&&!_.current.contains(G.target)&&(I(!1),A!==o.price&&(console.log("cambio a:",A),h({...o,price:A})))};return b?document.addEventListener("mousedown",y):document.removeEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[b,A,o,h]);const U=y=>{y.key==="Enter"&&(y.preventDefault(),I(!1),A!==o.price&&(console.log("cambio a:",A),h({...o,price:A})))};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"card mb-0",style:{border:`1px solid ${o.color}44`,backgroundColor:`${o.color}11`},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("div",{className:"float-end",children:e.jsx(H,{content:"Quitar producto",children:e.jsx("i",{className:"fa fa-times",onClick:()=>a(o),style:{cursor:"pointer"}})})}),e.jsx("h5",{className:"header-title mt-0 mb-1",style:{fontSize:"14.4px",color:o.color},children:o.name}),b?e.jsx("input",{ref:_,className:"form-control form-control-sm",type:"number",value:A,onChange:y=>q(parseFloat(y.target.value)||0),onKeyDown:U}):e.jsxs("small",{onClick:()=>I(!0),style:{cursor:"text"},children:["S/. ",_e(A)]})]})})})},ot="/build/assets/google-CZOMqMi4.svg";class Cs{constructor(){me(this,"check",async()=>{const{status:a,result:o}=await F.Fetch("/api/gmail/check");return a?o==null?void 0:o.data:F.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:(o==null?void 0:o.message)||"Ocurrió un error inesperado",type:"danger"})});me(this,"list",async a=>{const{status:o,result:b}=await F.Fetch("/api/gmail",{method:"POST",body:F.JSON.stringify({email:a})});return o?b==null?void 0:b.data:F.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:(b==null?void 0:b.message)||"Ocurrió un error inesperado",type:"danger"})});me(this,"getDetails",async a=>{const{status:o,result:b}=await F.Fetch(`/api/gmail/details/${a}`);return o?b==null?void 0:b.data:F.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:(b==null?void 0:b.message)||"Ocurrió un error inesperado",type:"danger"})});me(this,"send",async a=>{const{status:o,result:b}=await F.Fetch("/api/gmail/send",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(F.Cookies.get("XSRF-TOKEN"))},body:F.JSON.stringify(a)});return o?(b==null?void 0:b.data)??!0:F.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:(b==null?void 0:b.message)||"Ocurrió un error inesperado",type:"danger"})})}}const dt=new Cs,mt=({data:h,inReplyTo:a,modalRef:o,onSend:b=()=>{},defaultMessages:I,signs:A=[]})=>{const q=i.useRef(),_=i.useRef(),U=i.useRef(),y=i.useRef(),G=i.useRef(),[O,k]=i.useState(!1),[P,E]=i.useState(!1),[C,j]=i.useState(!1),[u,S]=i.useState([]),z=N=>{S(d=>d.filter(v=>v.id!==N))},J=()=>{U.current.value="",y.current.value="",y.editor.root.innerHTML="",$(q.current).val(null).trigger("change"),$(_.current).val(null).trigger("change"),E(!1),j(!1),S([])},K=async N=>{const d=$(y.editor.root);if(!N){d.find("#mailing-sign").remove();return}const v=e.jsx("img",{id:"mailing-sign",src:`${M.APP_PROTOCOL}://${M.APP_DOMAIN}/repository/signs/${N.sign}`,alt:N.name,style:{maxWidth:"480px"}});if(d.find('[id="mailing-sign-container"]').length===0){const x=ps(e.jsxs(e.Fragment,{children:[e.jsx("p",{}),e.jsx("p",{}),e.jsx("p",{}),e.jsx("p",{children:"--"}),e.jsx("p",{id:"mailing-sign-container",children:v})]}));d.append(x)}else d.find('[id="mailing-sign-container"]').html(ps(v))},Z=async N=>{N.preventDefault(),k(!0);const d=y.current.value,x=$(`<div>${d}</div>`).text().toLowerCase().match(/\b(adjunt\w*)\b/g);if(x&&x.length>0&&u.length===0&&!(await ce.fire({title:"¿Enviar sin adjuntos?",html:`En tu mensaje has escrito "${x[0]}", pero no lleva ningun archivo adjunto ¿quieres enviarlo igualmente?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, enviar",cancelButtonText:"Cancelar"})).isConfirmed){k(!1);return}const f={to:h==null?void 0:h.id,subject:U.current.value,body:d,cc:[],bcc:[],attachments:[]};a&&(f.inReplyTo=a.id);const D=P?$(q.current).val()||[]:[],T=C?$(_.current).val()||[]:[];D.length>0&&(f.cc=D),T.length>0&&(f.bcc=T),f.attachments=u;const R=await dt.send(f);k(!1),R&&(F.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"El correo ha sido enviado correctamente"}),J(),$(o.current).modal("hide"),b(R))},L=N=>{if(!N){y.current.value="",y.editor.root.innerHTML="",S([]);return}const d=$(`<div>${N.description}</div>`);d.find(".mention").each((v,x)=>{const f=$(x),D=f.attr("data-id");f.removeClass("mention"),f.text(h[D])}),U.current.value=N.name,y.current.value=N.description,y.editor.root.innerHTML=d.html(),S(N.attachments)};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{modalRef:o,size:"lg",zIndex:1050,onSubmit:Z,hideHeader:!0,hideFooter:!0,onClose:J,children:e.jsxs("div",{id:"mailing-modal",children:[e.jsx("button",{type:"button",className:"btn-close float-end","data-bs-dismiss":"modal","aria-label":"Close"}),e.jsx("h4",{className:"header-title mb-0",children:"Mensaje nuevo"}),e.jsx("hr",{className:"my-2"}),a&&e.jsxs("div",{className:"mb-2",children:[e.jsx("i",{className:"fas fa-reply me-1"})," ",a==null?void 0:a.sender]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Para:"})," ",h==null?void 0:h.contact_name,e.jsxs("small",{className:"text-muted d-block",children:["<",h==null?void 0:h.contact_email,">"]})]}),e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsxs("div",{className:"form-check me-3",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",id:"showCC",checked:P,onChange:()=>E(!P)}),e.jsx("label",{className:"form-check-label",htmlFor:"showCC",children:"CC"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",id:"showBCC",checked:C,onChange:()=>j(!C)}),e.jsx("label",{className:"form-check-label",htmlFor:"showBCC",children:"CCO"})]})]}),P&&e.jsx(pe,{eRef:q,label:"CC",tags:!0,dropdownParent:"#mailing-modal",multiple:!0}),C&&e.jsx(pe,{eRef:_,label:"CCO",tags:!0,dropdownParent:"#mailing-modal",multiple:!0}),e.jsx(ws,{eRef:U,label:"Asunto",rows:1,required:!0}),e.jsx(Xs,{eRef:y,label:"Mensaje",required:!0}),u.length>0&&e.jsxs("div",{className:"border rounded p-2 mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{className:"mdi mdi-paperclip me-1"}),e.jsxs("small",{className:"text-muted",children:["Archivos adjuntos (",u.length,")"]})]}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:u.map((N,d)=>e.jsxs("div",{className:"border rounded p-1 d-flex align-items-center gap-2",style:{fontSize:"0.8rem"},children:[e.jsx("i",{className:"mdi mdi-file"}),e.jsx("span",{children:N.name}),e.jsx("button",{type:"button",className:"btn btn-xs btn-soft-danger py-0 px-1",onClick:()=>z(N.id),children:e.jsx("i",{className:"mdi mdi-close"})})]},d))})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",type:"submit",disabled:O,children:["Enviar",O?e.jsx("i",{className:"fa fa-spin fa-spinner ms-1"}):e.jsx("i",{className:"fas fa-location-arrow ms-1"})]}),e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(H,{content:"Adjuntar archivos",children:e.jsx("button",{className:"btn btn-sm btn-white mb-0",type:"button",onClick:()=>$(G.current).modal("show"),children:e.jsx("i",{className:"mdi mdi-paperclip"})})}),e.jsxs("div",{class:"dropdown",children:[e.jsx(H,{content:"Usar plantilla",children:e.jsx("button",{class:"btn btn-sm  btn-white dropdown-toggle",type:"button",id:"dropdown-templates-button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:e.jsx("i",{class:"mdi mdi-message-bulleted"})})}),e.jsxs("div",{class:"dropdown-menu","aria-labelledby":"dropdown-templates-button",children:[e.jsxs("span",{class:"dropdown-item",style:{cursor:"pointer"},onClick:()=>L(),children:[e.jsx("i",{className:"mdi mdi-broom me-1"}),"Limpiar contenido"]}),I.filter(N=>N.type=="email").map((N,d)=>e.jsx("span",{class:"dropdown-item",style:{cursor:"pointer"},onClick:()=>L(N),children:N.name},d)),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("a",{class:"dropdown-item",href:`${M.APP_PROTOCOL}://${M.APP_DOMAIN}/signs`,target:"_blank",children:["Gestionar plantillas",e.jsx("i",{className:"mdi mdi-arrow-top-right ms-1"})]})]})]}),e.jsxs("div",{class:"dropdown",children:[e.jsx(H,{content:"Insertar firma",children:e.jsx("button",{class:"btn btn-sm  btn-white dropdown-toggle",type:"button",id:"dropdown-signs-button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:e.jsx("i",{class:"mdi mdi-pen"})})}),e.jsxs("div",{class:"dropdown-menu","aria-labelledby":"dropdown-signs-button",children:[e.jsx("span",{class:"dropdown-item",style:{cursor:"pointer"},onClick:()=>K(),children:"Sin firma"}),A.map((N,d)=>e.jsxs("span",{class:"dropdown-item d-flex gap-1 align-items-center",style:{cursor:"pointer"},onClick:()=>K(N),children:[e.jsx("img",{src:`${M.APP_PROTOCOL}://${M.APP_DOMAIN}/repository/signs/${N.sign}`,alt:N.name,style:{width:"20px",aspectRatio:1,objectFit:"cover",objectPosition:"center"}}),N.name||e.jsx("i",{className:"text-muted",children:"Sin nombre"})]},d)),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("a",{class:"dropdown-item",href:`${M.APP_PROTOCOL}://${M.APP_DOMAIN}/signs`,target:"_blank",children:["Gestionar firmas",e.jsx("i",{className:"mdi mdi-arrow-top-right ms-1"})]})]})]})]})]}),e.jsx("button",{className:"btn btn-sm btn-danger",type:"button",onClick:J,children:e.jsx("i",{className:"mdi mdi-delete"})})]})]})}),e.jsx(xe,{modalRef:G,title:"Repositorio",size:"full-width",hideFooter:!0,zIndex:1070,children:e.jsx(nt,{height:"calc(100vh - 300px)",multiple:!0,selectedFiles:u,setSelectedFiles:S,selectable:!0})})]})},ut=h=>{if(h<1024)return`${h} B`;const a=["KB","MB","GB"];let o=-1,b=h;for(;b>=1024&&o<a.length-1;)b/=1024,o++;return`${b.toFixed(1)} ${a[o]}`},gs=new rt;function bs({defaultValue:h,items:a=[],base:o={},canCreate:b=!1,canUpdate:I=!1,canDelete:A=!1,onItemClick:q=()=>{},onDropdownClose:_=()=>{}}){const U=i.useRef(),y=i.useRef(),G=i.useRef(),O=i.useRef(),[k,P]=i.useState(a),[E,C]=i.useState(!1),[j,u]=i.useState(!1),S=k.find(d=>d.id==h.id),z=i.useCallback((d,v,x)=>{const f=d.scrollTop,D=v-f,T=performance.now(),R=c=>{const g=c-T,w=Math.min(g/x,1),B=w<.5?4*w*w*w:1-Math.pow(-2*w+2,3)/2;d.scrollTop=f+D*B,w<1&&requestAnimationFrame(R)};requestAnimationFrame(R),F.Local.onchange("statuses",c=>{console.log(c)})},[]);i.useEffect(()=>{if(E&&O.current){const d=O.current.scrollHeight-O.current.clientHeight;z(O.current,d,300),C(!1)}F.Local.set("statuses",k)},[k,E,z]),i.useEffect(()=>{const d=$(U.current),v=()=>{const x=structuredClone(k).filter(f=>f.id).map(f=>(f.editing=!1,f));P(x),_(j,x)};return d.on("hidden.bs.dropdown",v),()=>{d.off("hidden.bs.dropdown",v)}},[j,k]);const J=d=>{d.stopPropagation(),P(v=>[...v.map(x=>(x.editing=!1,x)),{editing:!0}]),C(!0)},K=(d,v)=>{d.stopPropagation(),P(x=>x.map(f=>{if(f.id)return f.editing=f.id===v.id,f}).filter(Boolean))},Z=async(d,v)=>{d.stopPropagation();const{isConfirmed:x}=await ce.fire({title:"Estas seguro de eliminar este estado?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});if(!x)return;const f=await gs.delete(v.id);if(console.log(f),!f)return;const D=structuredClone(k).map(T=>{if(T.id&&T.id!=v.id)return T.editing=T.id===v.id,T}).filter(Boolean);P(D),u(!0),_(!0,D)},L=async(d,v)=>{d.preventDefault();const x=await gs.save({...structuredClone(o),id:v.id??void 0,name:y.current.value,color:G.current.value});x&&(k.find(f=>f.id==x.id)?P(f=>{const D=f.findIndex(T=>T.id==x.id);return f[D]=x,structuredClone(f).filter(T=>T.id)}):P(f=>[...f.filter(D=>D.id),x]),u(v.name!=x.name||v.color!=x.color))},N=d=>{P(v=>v.filter(x=>x.id||!x.editing).map(x=>({...x,editing:!1})))};return e.jsxs(ys,{ddRef:U,className:"btn btn-white text-truncate",title:S.name,tippy:"Actualizar estado",style:{border:"none",borderRadius:"0",width:"179px",height:"47px",color:"#fff",fontWeight:"bolder",backgroundColor:S.color},children:[e.jsx("div",{ref:O,style:{maxHeight:"173px",overflowY:"auto"},children:k.sort((d,v)=>d.order-v.order).map((d,v)=>{const{name:x,color:f,editing:D}=d,T=`item-${crypto.randomUUID()}`;return e.jsx(Se,{onClick:R=>{D?R.stopPropagation():(P(c=>[...c.map(g=>{if(g.id)return g.editing=!1,g}).filter(Boolean)]),q(d))},className:D?"p-0":"p-2 show-button-child",children:D?e.jsxs("form",{className:"input-group",onSubmit:R=>L(R,d),children:[e.jsx("label",{htmlFor:T,className:"input-group-text p-0 d-flex align-items-center",style:{cursor:"pointer"},children:e.jsx("input",{ref:G,id:T,className:"mx-1",type:"color",defaultValue:f,style:{padding:0,height:"25px",width:"25px",border:"none",borderRadius:"4px",cursor:"pointer"}})}),e.jsx("input",{ref:y,className:"form-control",type:"text",defaultValue:x}),e.jsx(H,{content:"Guardar",children:e.jsxs("button",{className:"btn input-group-text btn-xs btn-success waves-effect waves-light",type:"submit",children:[e.jsx("i",{className:"fa fa-check","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Guardar"})]})}),e.jsx(H,{content:"Cancelar",children:e.jsxs("button",{className:"btn input-group-text btn-xs btn-danger waves-effect waves-light",type:"button",onClick:()=>N(),children:[e.jsx("i",{className:"fa fa-times","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Cancelar"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"position-absolute d-flex gap-1",style:{top:"50%",right:"8px",transform:"translateY(-50%)"},children:[I&&e.jsx(H,{content:"Editar",children:e.jsxs("span",{style:{cursor:"pointer"},className:"btn btn-xs btn-soft-primary ",onClick:R=>K(R,d),type:"button",children:[e.jsx("i",{className:"fa fa-pen","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Editar"})]})}),A&&e.jsx(H,{content:"Eliminar",children:e.jsxs("span",{style:{cursor:"pointer"},className:"btn btn-xs btn-soft-danger",onClick:R=>Z(R,d),type:"button",children:[e.jsx("i",{className:"fa fa-trash","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:"Eliminar"})]})})]}),e.jsx("i",{className:"fa fa-circle me-2",style:{color:f},"aria-hidden":"true"}),e.jsx("span",{children:x})]})},v)})}),b&&e.jsxs(Se,{onClick:J,children:[e.jsx("i",{className:"fa fa-plus me-2","aria-hidden":"true"}),e.jsx("span",{children:"Agregar estado"})]})]})}const js=({gridRef:h,rest:a,can:o,defaultLeadStatus:b,statuses:I,manageStatuses:A,onClientStatusClicked:q,onManageStatusChange:_,onLeadClicked:U,onMessagesClicked:y,onAttendClient:G,onOpenModal:O,onMakeLeadClient:k,onArchiveClicked:P,onDeleteClicked:E,title:C})=>e.jsx(at,{gridRef:h,title:C,rest:a,reloadWith:[I,A],toolBar:j=>{j.unshift(xs({className:"btn btn-xs btn-soft-dark text-nowrap",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(h.current).dxDataGrid("instance").refresh()})),o("leads","all","create")&&j.unshift(xs({className:"btn btn-xs btn-soft-primary text-nowrap",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>O()}))},exportable:!0,height:"calc(65vh - 90px)",pageSize:25,allowedPageSizes:[10,25,50,100],columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(j,{data:u})=>{j.attr("style",`height: 48px; border-left: 4px solid ${u.status.color}`),ee(j,e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx(ne,{className:"btn btn-xs btn-white",title:"Ver mensajes",onClick:()=>y(u),children:e.jsx("i",{className:"mdi mdi-whatsapp text-success"})}),e.jsxs("div",{onClick:()=>U(u),style:{cursor:"pointer"},children:[u.status_id==b?e.jsx("b",{className:"d-block",children:u.contact_name}):e.jsx("span",{className:"d-block",children:u.contact_name}),u.products_count>0&&e.jsxs("small",{className:"text-muted",children:[u.products_count," ",u.products_count>1?"productos":"producto"]})]})]}))},fixed:!0,fixedPosition:"left"},{dataField:"assigned.fullname",caption:"Usuario",width:58,cellTemplate:(j,{data:u})=>{j.attr("style","height: 48px"),ee(j,e.jsx("div",{className:"d-flex align-items-center gap-1",children:u.assigned_to?e.jsx(e.Fragment,{children:e.jsx(H,{content:`Atendido por ${u.assigned.name} ${u.assigned.lastname}`,children:e.jsx("img",{className:"avatar-sm rounded-circle",src:`//${M.APP_DOMAIN}/api/profile/thumbnail/${u.assigned.relative_id}`,alt:u.assigned.name})})}):""}))},fixed:!0,fixedPosition:"left"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{dataField:"status.name",caption:"Estado de gestión",dataType:"string",width:180,cellTemplate:(j,{data:u})=>{j.addClass("p-0"),j.attr("style","overflow: visible"),ee(j,e.jsx(bs,{items:I,defaultValue:u.status,base:{table_id:"e05a43e5-b3a6-46ce-8d1f-381a73498f33"},onItemClick:S=>q(u.id,S.id),canCreate:o("statuses","all","create"),canUpdate:o("statuses","all","update"),canDelete:o("statuses","all","delete"),onDropdownClose:(S,z)=>{S&&setStatuses(z)}}))}},{dataField:"manage_status.name",caption:"Estado del lead",dataType:"string",width:180,cellTemplate:(j,{data:u})=>{j.addClass("p-0"),j.attr("style","overflow: visible"),ee(j,e.jsx(bs,{items:A,defaultValue:u.manage_status,base:{table_id:"9c27e649-574a-47eb-82af-851c5d425434"},onItemClick:S=>_(u,S),canCreate:o("statuses","all","create"),canUpdate:o("statuses","all","update"),canDelete:o("statuses","all","delete"),onDropdownClose:(S,z)=>{S&&setManageStatuses(z)}}))}},{dataField:"origin",caption:"Origen",dataType:"string"},{dataField:"triggered_by",caption:"Disparado por",dataType:"string"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(j,{data:u})=>{j.text(moment(u.created_at.replace("Z","+05:00")).format("lll"))},sortOrder:"desc"},{caption:"Acciones",width:240,cellTemplate:(j,{data:u})=>{j.attr("style","display: flex; gap: 4px; height: 47px; overflow: visible"),ee(j,e.jsx(ne,{className:"btn btn-xs btn-soft-warning",title:"Editar lead",onClick:()=>O(u),children:e.jsx("i",{className:"fa fa-pen"})})),ee(j,e.jsx(ne,{className:"btn btn-xs btn-soft-primary",title:"Ver detalles",onClick:()=>U(u),children:e.jsx("i",{className:"fa fa-eye"})})),u.assigned_to?u.assigned_to==le.service_user.id&&ee(j,e.jsx(ne,{className:"btn btn-xs btn-soft-danger",title:"Dejar de atender",onClick:()=>G(u.id,!1),children:e.jsx("i",{className:"fas fa-hands-wash"})})):ee(j,e.jsx(ne,{className:"btn btn-xs btn-soft-dark",title:"Atender lead",onClick:()=>G(u.id,!0),children:e.jsx("i",{className:"fas fa-hands-helping"})})),ee(j,e.jsx(ne,{className:"btn btn-xs btn-soft-success",title:"Convertir en cliente",onClick:async()=>k(u),children:e.jsx("i",{className:"fa fa-user-plus"})})),ee(j,e.jsx(ne,{className:"btn btn-xs btn-soft-dark",title:"Archivar lead",onClick:S=>P(u,S),children:e.jsx("i",{className:"mdi mdi-archive"})})),ee(j,e.jsx(ne,{className:"btn btn-xs btn-soft-danger",title:"Eliminar lead",onClick:()=>E(u),children:e.jsx("i",{className:"fa fa-trash"})}))},allowFiltering:!1,allowExporting:!1}]});class ht extends Ns{constructor(){super(...arguments);me(this,"path","leads/new")}}class pt extends Ws{constructor(){super(...arguments);me(this,"path","messages")}}const xt=new pt,$e=new Ys,ft=new vs,gt=({offCanvasRef:h,dataLoaded:a,setDataLoaded:o,defaultMessages:b,signs:I,onOpenModal:A=()=>{},onLeadClicked:q=()=>{}})=>{h||(h=i.useRef());const _=i.useRef(),U=i.useRef(),y=i.useRef(),G=i.useRef(),O=i.useRef(),[k,P]=i.useState([]),[E,C]=i.useState(!1),[j,u]=i.useState(!1),[S,z]=i.useState(500),[J,K]=i.useState(!1),[Z,L]=i.useState(le.service_user.whatsapp_sign);i.useEffect(()=>{a!=null&&a.contact_phone&&d().then(c=>{P(c),N()})},[a]),i.useEffect(()=>{if(!(a!=null&&a.id))return;const c=setInterval(async()=>{j||await N()},S);return()=>clearInterval(c)},[a,j,S]);const N=async()=>{const c=await v();u(!0);const{data:g}=await xt.paginate({isLoadingAll:!0,filter:[["wa_id","contains",a==null?void 0:a.contact_phone],"and",["microtime",">",c.microtime]],sort:[{selector:"microtime",desc:!1}]});if(u(!1),!g||!a.id)return;g.length>0?z(500):z(2500);const w=await d();w.push(...g),P(w.sort((B,ae)=>ae.microtime-B.microtime))},d=async()=>{const g=await(await caches.open("messages")).match(`${le.business_uuid}/${a.id}`);return g?await g.json()??[]:[]},v=async()=>(await d()).sort((g,w)=>w.microtime-g.microtime)[0]??{microtime:0},x=async c=>{c.preventDefault();const g=_.current.value,w=a.id;C(!0);const B=await $e.send(w,g);C(!1),B&&(_.current.value="")};i.useEffect(()=>{if(a!=null&&a.id&&(caches.open("messages").then(c=>{c.put(`${le.business_uuid}/${a.id}`,new Response(JSON.stringify(k)))}),O.current)){const c=O.current,g=$(c).parent()[0],w=g.scrollHeight-g.scrollTop===g.clientHeight,B=g.scrollTop===0;(w||B)&&(g.scrollTop=c.scrollHeight)}},[k]),i.useEffect(()=>{h.current.addEventListener("hidden.bs.offcanvas",()=>{o(null),P([])}),document.addEventListener("click",c=>{var g,w;!((g=U.current)!=null&&g.contains(c.target))&&(y.current!=c.target||!((w=y.current)!=null&&w.contains(c.target)))&&K(!1)})},[null]);const f=async c=>{const g=c.target.value;await ft.setDefaultSign({type:"whatsapp",sign:g})&&L(g)},D=()=>{$(G.current).modal("show")},T=async()=>{const c=I.find(w=>w.id==Z),g=`${M.APP_PROTOCOL}://${M.APP_DOMAIN}/repository/signs/${c.sign}`;C(!0),await $e.send(a==null?void 0:a.id,`/signature:${g}`),C(!1)},R=b.filter(({type:c})=>c==="whatsapp");return e.jsxs(e.Fragment,{children:[e.jsxs("form",{ref:h,className:"offcanvas offcanvas-end",tabIndex:"-1","aria-labelledby":"offcanvasRightLabel",style:{visibility:"hidden",width:"95%",maxWidth:"600px",zIndex:1041},"aria-hidden":"true",onSubmit:x,children:[e.jsxs("div",{className:"offcanvas-header border-bottom gap-2",children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center w-100",onClick:()=>q(a),style:{cursor:"pointer"},children:[e.jsx("img",{className:"avatar-sm rounded-circle border",src:`${M.WA_URL}/api/profile/${le.business_uuid}/${a==null?void 0:a.contact_phone}`,onError:c=>{c.target.onerror=null,c.target.src=`//${M.APP_DOMAIN}/api/profile/thumbnail/undefined`},alt:a==null?void 0:a.contact_name}),e.jsxs("div",{children:[e.jsx("h5",{className:"my-0",children:a==null?void 0:a.contact_name}),e.jsxs("small",{className:"text-muted",children:["+",a==null?void 0:a.contact_phone]})]})]}),e.jsxs("div",{className:"d-flex gap-1 align-items-center",children:[e.jsxs("div",{className:"dropdown",children:[e.jsx("i",{className:"mdi  mdi-18px mdi-dots-vertical dropdown-toggle",type:"button",id:"offcanvas-options","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":"offcanvas-options",children:[e.jsxs("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>A(a),children:[e.jsx("i",{className:"mdi mdi-eye me-1",style:{width:"20px"}}),"Editar datos del lead"]}),e.jsxs("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:D,children:[e.jsx("i",{className:"fa fa-signature me-1",style:{width:"20px"}}),"Ver firmas disponibles"]}),e.jsxs("span",{className:"dropdown-item",style:{cursor:"pointer"},"data-bs-dismiss":"offcanvas",children:[e.jsx("i",{className:"mdi mdi-close me-1",style:{width:"20px"}}),"Cerrar chat"]})]})]}),e.jsx("i",{className:"mdi  mdi-18px mdi-close","data-bs-dismiss":"offcanvas",style:{cursor:"pointer"}})]})]}),e.jsx("div",{className:"offcanvas-body",children:e.jsx("ul",{ref:O,className:"conversation-list slimscroll w-100 align-items-bottom","data-simplebar":!0,children:k.sort((c,g)=>c.microtime-g.microtime).map((c,g)=>{const w=c.message.replace(/\{\{.*?\}\}/gs,""),B=c.role!=="Human";let ae="";return w.startsWith("/attachment:")&&(ae=w.split(`
`)[0]),e.jsx("li",{className:c.role=="Human"?"":"odd",children:e.jsxs("div",{className:"message-list",children:[e.jsx("div",{className:"chat-avatar",children:e.jsx("img",{className:"border",style:{aspectRatio:1},src:B?`//${M.APP_DOMAIN}/api/profile/thumbnail/${le.relative_id}`:`${M.WA_URL}/api/profile/${le.business_uuid}/${c.wa_id}`,onError:W=>{W.target.onerror=null,W.target.src=`//${M.APP_DOMAIN}/api/profile/thumbnail/undefined`},alt:a==null?void 0:a.contact_name})}),e.jsxs("div",{className:"conversation-text",children:[e.jsx("div",{className:"ctext-wrap",children:w.startsWith("/signature:")?e.jsx("img",{src:w.replace("/signature:",""),alt:`${le.service_user.fullname} signature`,style:{minWidth:"300px",maxWidth:"100%",minHeight:"200px",maxHeight:"300px",borderRadius:"4px",objectFit:"cover"},onError:W=>{W.target.onerror=null,W.target.src="//placehold.co/500x200?text=404"}}):e.jsxs(e.Fragment,{children:[ae&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:ae.replace("/attachment:",""),className:"mb-1",alt:"attachment",style:{minWidth:"300px",width:"100%",maxWidth:"100%",minHeight:"200px",maxHeight:"300px",borderRadius:"4px",objectFit:"cover"},onError:W=>{$(W.target).remove()}}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsxs("a",{className:"btn btn-xs btn-white mb-1 text-nowrap d-flex text-end",href:ae.replace("/attachment:",""),target:"_blank",download:!0,children:[e.jsx("i",{className:"mdi mdi-download me-1"}),e.jsx("span",{children:"Descargar adjunto"})]})})]}),e.jsx("p",{children:w.replace(ae,"")})]})}),e.jsx("span",{className:"time",children:moment(c.created_at).format("YYYY-MM-DD HH:mm:ss")})]})]})},g)})})}),e.jsxs("div",{className:"offcanvas-footer",children:[e.jsx("div",{ref:U,className:"p-2",onClick:c=>c.stopPropagation(),hidden:!J,style:{transition:"all .125s"},children:e.jsx("div",{className:"d-flex gap-2",children:R.map((c,g)=>e.jsx("span",{className:"badge bg-light text-dark",style:{cursor:"pointer"},onClick:async()=>{if(K(!1),C(!0),c.attachments.length>0){const w=c.attachments[0],B=`${M.APP_URL}/cloud/${w.file}`;await $e.send(a==null?void 0:a.id,`/attachment:${B}
${c.description}`),C(!1);return}await $e.send(a==null?void 0:a.id,c.description),C(!1)},title:c.description,children:c.name},g))})}),e.jsxs("div",{className:"d-flex gap-2 p-2 align-items-end",children:[e.jsx("textarea",{ref:_,className:"form-control w-100",placeholder:"Ingrese su mensaje aqui",rows:1,style:{minHeight:27,fieldSizing:"content"},disabled:E,required:!0}),e.jsxs("div",{className:"d-flex gap-1",children:[e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"btn btn-white dropdown-toggle px-1",type:"button",id:"message-options","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-plus"})}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":"message-options",children:[Z?e.jsxs("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:T,children:[e.jsx("i",{className:"fa fa-signature me-1",style:{width:"20px"}}),"Enviar firma"]}):e.jsx(H,{content:"Selecciona una firma por defecto",children:e.jsxs("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:D,children:[e.jsx("i",{className:"fa fa-signature me-1",style:{width:"20px"}}),"Enviar firma"]})}),(R==null?void 0:R.length)>0&&e.jsxs("span",{ref:y,className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>K(!0),children:[e.jsx("i",{className:"mdi mdi-message-bulleted me-1",style:{width:"20px"}}),"Mensajes predeterminados"]})]})]}),e.jsx("button",{className:"btn btn-dark waves-effect waves-light",type:"submit",disabled:E,children:E?e.jsx("i",{className:"mdi mdi-spinner mdi-loading"}):e.jsx("i",{className:"mdi mdi-arrow-top-right"})})]})]})]})]}),e.jsxs(xe,{modalRef:G,title:"Tus firmas",hideFooter:!0,children:[e.jsx("b",{className:"d-block",children:"¿Desea seleccionar una de sus firmas disponibles como predeterminado?"}),e.jsx("div",{className:"row mt-2",children:I.map((c,g)=>e.jsx("div",{className:"col-md-6",children:e.jsx(H,{content:"Marcar como predeterminado",children:e.jsxs("label",{className:"card border",style:{cursor:"pointer"},children:[e.jsxs("div",{className:"card-header d-flex gap-1 align-items-center py-1 px-2",children:[e.jsx("input",{type:"radio",name:"sign",className:"form-check-input my-0",id:`sign-${c.id}`,checked:c.id==Z,onChange:f,value:c.id}),e.jsx("b",{className:"d-block my-0 w-100 text-truncate",children:c.name||"Sin nombre"})]}),e.jsx("div",{className:"card-body p-0",children:e.jsx("img",{src:`${M.APP_PROTOCOL}://${M.APP_DOMAIN}/repository/signs/${c.sign}`,alt:c.name,className:"img-fluid w-100",style:{objectFit:"cover",aspectRatio:5/2}})})]})})},g))})]})]})},se=new Ns,bt=new ht,jt=new Qs,Be=new Js,Nt=new et,vt=new vs,Re=new Zs,Ue=new Cs,wt=({statuses:h,defaultClientStatus:a,defaultLeadStatus:o,manageStatuses:b,noteTypes:I,products:A=[],processes:q=[],defaultMessages:_=[],session:U,can:y,lead:G,signs:O})=>{var es,ss,ts,ns,as,rs,is,cs,ls,os,ds;const k=i.useRef(),P=i.useRef(),E=i.useRef(),C=i.useRef(),j=i.useRef(),u=i.useRef(),S=i.useRef(),z=i.useRef(),J=i.useRef(),K=i.useRef(),Z=i.useRef(),L=i.useRef(),N=i.useRef(),d=i.useRef(),v=i.useRef(),x=i.useRef(),f=i.useRef(),D=i.useRef(),T=i.useRef(),R=i.useRef(),c=i.useRef(),g=i.useRef(),w=i.useRef(),[B,ae]=i.useState(U),[W,yt]=i.useState(h),[Ne,Ct]=i.useState(b),[Ge,He]=i.useState([]),[t,re]=i.useState(null),[ze,De]=i.useState(null),[te,ue]=i.useState([]),[Q,ks]=i.useState(F.Local.get("default-view")??"kanban"),[Pe,ve]=i.useState([]),[Te,$s]=i.useState(!1),[Rs,qe]=i.useState(crypto.randomUUID()),[_s,Ss]=i.useState(null),[Ae,We]=i.useState([]),[Ye,Ve]=i.useState(!1),[Ds,Xe]=i.useState(null),[p,Ps]=i.useState(null),we={},fe={};I.forEach(s=>{we[s.id]=i.useRef(),fe[s.id]=i.useRef()}),i.useEffect(()=>{if($(k.current).on("hidden.bs.modal",()=>{re(null),history.pushState(null,null,"/leads")}),!G)return;se.get(G).then(m=>{m&&(re(m),ue([]),ve([]),$(k.current).modal("show"),F.GET.annotation&&$(`[data-name="${F.GET.annotation}"]`).click())});const s=d.current,n=new bootstrap.Dropdown(s);s.addEventListener("focus",function(){n.show()}),s.addEventListener("blur",function(){setTimeout(()=>{n.hide()},200)})},[null]),i.useEffect(()=>{Ue.check().then(s=>{if(s.authorized)return $s(!0);Ss(s.auth_url)})},[Rs]),i.useEffect(()=>{Te&&(t!=null&&t.contact_email)&&(Ve(!0),We([]),Ue.list(t.contact_email).then(s=>{We(s??[]),Ve(!1)}))},[Te,t]),i.useEffect(()=>{const s=W.map(n=>`#status-${fs(n.name)}`).join(", ");$(s).sortable({connectWith:".taskList",placeholder:"task-placeholder",forcePlaceholderSize:!0,receive:async function({target:n},{item:m}){const l=n,r=m.get(0);!$(l).sortable("toArray").includes(r.id)||await se.leadStatus({status:l.getAttribute("data-id"),lead:r.id})},update:function(n,m){m.item.parent()[0]}}).disableSelection(),I.forEach(n=>{new Ks(`#editor-${n.id}`,{theme:"bubble",modules:{toolbar:[[{font:[]},{size:[]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{script:"super"},{script:"sub"}],[{header:[!1,1,2,3,4,5,6]},"blockquote","code-block"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["direction",{align:[]}],["link","image","video"],["clean"]],mention:{allowedChars:/^[A-Za-z\sÅÄÖåäö]*$/,mentionDenotationChars:["@","#"],source:async function(m,l,...r){const{data:Y}=await vt.paginate({filter:["fullname","contains",m]});l(Y.map(({relative_id:X,fullname:V})=>({id:X,value:V})))}}}}),$(`#editor-${n.id}`).find(".ql-editor").empty()}),He([]),Q=="kanban"&&oe()},[Q]),i.useEffect(()=>{var s,n;Ke(),Ts(),$(v.current).val((s=t==null?void 0:t.status)==null?void 0:s.id).trigger("change"),$(x.current).val((n=t==null?void 0:t.manage_status)==null?void 0:n.id).trigger("change")},[t]);const oe=async()=>{const s=await se.all();He(s)},Ke=async()=>{const s=await Be.byClient(t==null?void 0:t.id);ue(s??[])},Ts=async()=>{const s=await Re.byClient(t==null?void 0:t.id);ve(s)},ge=async s=>{re(s),history.pushState(null,null,`/leads/${s.id}`),ue([]),$(k.current).modal("show")},As=async s=>{const n=s.target.value,m=we[n].current,l=$(m).find(".ql-editor"),r=l.text().trim(),Y=l.html();if(!r.trim())return ce.fire({title:"Ooops!",text:"Ingresa un valor valido",timer:2e3});let X="",V=!1;switch(n){case"ed37659f-f9dc-49c1-9d0e-6a2effe9bd54":X=`${B.service_user.fullname} → ${t.contact_name}`;break;case"e20c7891-1ef8-4388-8150-4c1028cc4525":if(V=!0,X="Nueva tarea",!L.current.value||!N.current.value)return ce.fire({title:"Oops",text:"Ingresa la fecha de finalizacion de la tarea",timer:2e3});break;default:X=`Nota de ${B.service_user.fullname}`;break}const je=[...new Set([...$(l).find(".mention")].map(he=>he.getAttribute("data-id")))],de=await Be.save({id:fe[n].current.value||void 0,note_type_id:n,process:d.current.value,status_id:$(v.current).is(":visible")?v.current.value:void 0,manage_status_id:$(x.current).is(":visible")?x.current.value:void 0,name:X,description:V?void 0:Y,raw:V?void 0:r,client_id:t.id,tasks:V?[{name:z.current.value,type:J.current.value,priority:K.current.value,description:r?Y:void 0,ends_at:`${L.current.value} ${N.current.value}`,assigned_to:Z.current.value,mentions:je}]:[],mentions:V?[]:je});if(!de)return;l.empty(),fe[n].current.value=null,z.current.value="",d.current.value="",$(J.current).val("Por hacer").trigger("change"),$(K.current).val("Media").trigger("change"),$(Z.current).val("").trigger("change"),L.current.value="",N.current.value="";const ke=structuredClone(te),ms=ke.findIndex(he=>he.id==de.id);ms==-1?ke.push(de):ke[ms]=de,ue(ke),se.get(t.id).then(he=>{he&&re(he)}),Q=="kanban"?oe():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh())},Es=async s=>{const{isConfirmed:n}=await ce.fire({title:"Estas seguro?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});if(!n)return;await Be.delete(s);const m=structuredClone(te).filter(({id:l})=>l!=s);ue(m)},Fs=async s=>{var m,l;const n=we[s.type.id].current;if(k.current.scrollTo({top:0,behavior:"smooth"}),n.classList.add("highlight"),setTimeout(()=>{n.classList.remove("highlight")},2e3),fe[s.type.id].current.value=s.id||null,$(n).find(".ql-editor").html(s.description),s.type.id=="e20c7891-1ef8-4388-8150-4c1028cc4525"){const r=s.tasks[0]??{};z.current.value=r==null?void 0:r.name,$(J.current).val(r==null?void 0:r.type).trigger("change"),$(K.current).val(r==null?void 0:r.priority).trigger("change"),tt(Z.current,(m=r==null?void 0:r.assigned)==null?void 0:m.id,(l=r==null?void 0:r.assigned)==null?void 0:l.fullname),$(n).find(".ql-editor").html(r==null?void 0:r.description),L.current.value=moment(r==null?void 0:r.ends_at).format("YYYY-MM-DD"),N.current.value=moment(r==null?void 0:r.ends_at).format("HH:mm")}},Qe=s=>{F.Local.set("default-view",s),ks(s)},ye=async(s,n)=>{if(await se.leadStatus({lead:s,status:n}),t){const m=structuredClone(t);m.status=W.find(l=>l.id==n),re(m),history.pushState(null,null,`/leads/${m.id}`)}Q=="kanban"?oe():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh())},Ce=async(s,n)=>{await se.attend(s,n),Q=="kanban"?oe():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh())},Je=async(s,n)=>{var l;const m=await Nt.status({id:s,status:n});m&&((l=m==null?void 0:m.data)!=null&&l.refresh&&(Q=="kanban"?oe():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh())),Ke())},Ee=async(s,n)=>{await se.manageStatus({lead:s.id,status:n.id});const m=structuredClone(s);m.manage_status=n,re(m),history.pushState(null,null,`/leads/${m.id}`),Q=="kanban"?oe():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh())},Fe=async(s,n=null)=>{const m=n?n.target:$(`[id="${s.id}"]`).get(0),l=document.getElementById("archived-item");it(m,l);const{isConfirmed:r}=await ce.fire({title:"Este lead sera archivado",text:"Podras verlo en el menu de archivados",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!r||!await jt.delete(s.id)||(Q=="kanban"?$(`[id="${s.id}"]`).remove():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh()),ct(l))},Me=async s=>{const{isConfirmed:n}=await ce.fire({title:"Estas seguro de eliminar este lead?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});n&&(await se.delete(s.id),Q=="kanban"?$(`[id="${s.id}"]`).remove():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh()))},Ms=async s=>{s.preventDefault();const n={id:f.current.value,contact_name:D.current.value||"Lead anonimo",contact_email:T.current.value,contact_phone:R.current.value.keep("0-9"),name:c.current.value||"Lead anonimo",web_url:g.current.value,message:w.current.value||"Sin mensaje",client_width:window.screen.width,client_height:window.screen.height,client_system:navigator.platform??"Linux"};if(!n.id&&!await Ze(!0))return;const m=await se.save(n);m&&(t&&re(m),ze&&De(m),$(P.current).modal("hide"),Q=="kanban"?oe():($(E.current).dxDataGrid("instance").refresh(),$(C.current).dxDataGrid("instance").refresh()))},be=(s={})=>{f.current.value=(s==null?void 0:s.id)??"",D.current.value=(s==null?void 0:s.contact_name)??"",T.current.value=(s==null?void 0:s.contact_email)??"",R.current.value=(s==null?void 0:s.contact_phone)??"",c.current.value=(s==null?void 0:s.name)??"",g.current.value=(s==null?void 0:s.web_url)??"",w.current.value=(s==null?void 0:s.message)??"",$(P.current).modal("show")},Ze=async(s=!1)=>{const n=R.current.value.keep("0-9");R.current.disabled=!0;const m=await se.paginate({filter:["contact_phone","=",n],requireTotalCount:!0,take:1,sort:[{selector:"created_at",desc:!0}]});if(R.current.disabled=!1,(m==null?void 0:m.totalCount)>0){const l=m.data[0],{isConfirmed:r}=await ce.fire({title:"Lead registrado!",text:l.creator?`${l.creator.fullname} ha registrado este lead anteriormente con el nombre de ${l.contact_name}`:`Este numero de telefono ha sido registrado anteriormente con el nombre de ${l.contact_name}`,icon:"warning",confirmButtonText:s?"Continuar de todos modos":"Ok",cancelButtonText:"Cancelar",showCancelButton:s});return r}return!0},Ie=async s=>{const{isConfirmed:n}=await ce.fire({title:"Estas seguro?",text:`${s.contact_name} pasara a ser un cliente!`,icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});n&&ye(s.id,a)},Is=async s=>{const n=await Re.save({client_id:t.id,product_id:s.id,price:s.price});n&&ve(m=>[...m,{...s,pivot_id:n.pivot_id,pivot_price:n.price}])},Os=async s=>{await Re.delete(s.pivot_id)&&ve(m=>m.filter(l=>l.id!=s.id))},Bs=async s=>{await Re.save({id:s.pivot_id,price:s.price})},Us=[];te==null||te.forEach(s=>Us.push(...s.tasks));const Oe=[];te==null||te.forEach(s=>Oe.push(...s.tasks.filter(n=>n.status!="Realizado")));const Le=s=>{De(s),$(S.current).offcanvas("show")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex mb-2 gap-1",children:[e.jsx("input",{id:"view-as-table",type:"radio",name:"view-as",defaultChecked:Q=="table",onClick:()=>Qe("table")}),e.jsx("label",{htmlFor:"view-as-table",children:"Tabla"}),e.jsx("input",{id:"view-as-kanban",type:"radio",name:"view-as",defaultChecked:Q=="kanban",onClick:()=>Qe("kanban")}),e.jsx("label",{htmlFor:"view-as-kanban",children:"Pipelines"})]}),Q=="table"?e.jsxs(e.Fragment,{children:[e.jsx(js,{gridRef:C,rest:se,can:y,defaultLeadStatus:o,manageStatuses:Ne,statuses:W,onClientStatusClicked:ye,onManageStatusChange:Ee,onLeadClicked:ge,onMessagesClicked:Le,onAttendClient:Ce,onOpenModal:be,onMakeLeadClient:Ie,onArchiveClicked:Fe,onDeleteClicked:Me,title:e.jsx("h4",{className:"header-title my-0",children:"Leads - En Gestion"})}),e.jsx(js,{gridRef:E,rest:bt,can:y,defaultLeadStatus:o,manageStatuses:Ne,statuses:W,onClientStatusClicked:ye,onManageStatusChange:Ee,onLeadClicked:ge,onMessagesClicked:Le,onAttendClient:Ce,onOpenModal:be,onMakeLeadClient:Ie,onArchiveClicked:Fe,onDeleteClicked:Me,title:e.jsx("h4",{className:"header-title my-0",children:"Leads - Recien llegados"})})]}):e.jsx("div",{className:"d-flex gap-1 mb-3",style:{overflowX:"auto",minHeight:"calc(100vh - 135px)"},children:W.sort((s,n)=>s.order-n.order).map((s,n)=>{const m=fs(s.name),l=Ge.filter(r=>r.status_id==s.id).length;return e.jsx("div",{style:{minWidth:"270px",maxWidth:"270px"},children:e.jsxs("div",{className:"card mb-0",children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"header-title my-0",style:{color:s.color},children:s.name})}),e.jsxs("div",{className:"card-body taskboard-box p-2",style:{minHeight:"200px",maxHeight:"calc(100vh - 190px)",overflow:"auto"},children:[l>50&&e.jsxs("small",{class:"d-block alert alert-warning py-1 px-2",role:"alert",children:[e.jsx("i",{class:"mdi mdi-alert-outline me-2"}),e.jsxs("span",{children:["Tienes ",l," leads en este estado, recuerda que tambien puedes archivar leads."]})]}),e.jsx("ul",{className:"sortable-list list-unstyled taskList",id:`status-${m}`,"data-id":s.id,children:Ge.filter(r=>r.status_id==s.id).sort((r,Y)=>r.created_at>Y.created_at?-1:1).sort((r,Y)=>r.assigned_to==B.service_user.id?-1:1).map((r,Y)=>{var X,V,je,de;return e.jsx("li",{id:`${r.id}`,style:{cursor:"move"},className:`p-2 ${r.assigned_to==B.service_user.id?"border border-primary":""}`,children:e.jsx("div",{className:"kanban-box",children:e.jsxs("div",{className:"kanban-detail ms-0",children:[e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("a",{href:"#",className:"dropdown-toggle arrow-none card-drop","data-bs-toggle":"dropdown","aria-expanded":"false",children:e.jsx("i",{className:"mdi mdi-dots-vertical"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-end",children:[e.jsxs("a",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>ge(r),children:[e.jsx("i",{className:"fa fa-eye me-1"}),"Ver detalles"]}),e.jsxs("a",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>be(r),children:[e.jsx("i",{className:"fa fa-pen me-1"}),"Editar lead"]}),e.jsxs("a",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>Ie(r),children:[e.jsx("i",{className:"fa fa-user-plus me-1"}),"Convertir en cliente"]}),e.jsxs("a",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>Fe(r),children:[e.jsx("i",{className:"mdi mdi-archive me-1"}),"Archivar lead"]}),e.jsxs("a",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>Me(r),children:[e.jsx("i",{className:"fa fa-trash me-1"}),"Eliminar lead"]})]})]}),e.jsx("h5",{className:"mt-0 text-truncate",children:e.jsx(H,{content:"Ver detalles",children:e.jsx("a",{href:"#",onClick:()=>ge(r),className:"text-dark",children:r.contact_name})})}),e.jsxs("ul",{className:"list-inline d-flex align-items-center gap-1 mb-0",children:[e.jsx("li",{className:"list-inline-item",children:r.assigned_to?r.assigned_to==B.service_user.id?e.jsx(ne,{className:"btn btn-xs btn-soft-danger",title:"Dejar de atender",onClick:()=>Ce(r.id,!1),children:e.jsx("i",{className:"fas fa-hands-wash"})}):e.jsx(H,{content:`Atendido por ${(X=r==null?void 0:r.assigned)==null?void 0:X.fullname}`,children:e.jsx("a",{href:"","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"Username",children:e.jsx("img",{src:`//${M.APP_DOMAIN}/api/profile/${(V=r==null?void 0:r.assigned)==null?void 0:V.relative_id}`,alt:"img",className:"avatar-xs rounded-circle"})})}):e.jsx(ne,{className:"btn btn-xs btn-soft-dark rounded-pill",title:"Atender lead",onClick:()=>Ce(r.id,!0),children:e.jsx("i",{className:"fas fa-hands-helping"})})}),e.jsxs("li",{className:"list-inline-item",children:[e.jsx("span",{className:"badge d-block",style:{backgroundColor:((je=r==null?void 0:r.manage_status)==null?void 0:je.color)||"#6c757d",width:"max-content"},children:((de=r==null?void 0:r.manage_status)==null?void 0:de.name)??"Sin estado"}),e.jsx("small",{className:"text-muted",children:moment(r.created_at).format("LLL")})]})]})]})})},`lead-${Y}`)})})]})]})},`status-${n}`)})}),e.jsx(xe,{modalRef:k,title:"Detalles del lead",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:s=>s.preventDefault(),zIndex:1042,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsx("div",{className:"d-flex mb-3",children:e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("h4",{className:"media-heading mt-0",children:[e.jsx(H,{content:"Modificar datos",children:e.jsx("i",{className:"mdi mdi-lead-pencil me-1",style:{cursor:"pointer"},onClick:()=>be(t)})}),t==null?void 0:t.contact_name]}),e.jsx("span",{className:"badge bg-primary me-1",children:(t==null?void 0:t.contact_position)||"Trabajador"})," ",e.jsxs("small",{className:"text-muted",children:["desde ",e.jsx("b",{children:t==null?void 0:t.origin})]})]})}),e.jsx("hr",{}),e.jsx("h4",{children:"Estados"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-2",children:[e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado de gestión"}),e.jsxs("div",{className:"btn-group mb-0",style:{width:"100%"},children:[e.jsxs("button",{className:"btn btn-light btn-sm dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{color:"#ffffff",backgroundColor:((es=t==null?void 0:t.status)==null?void 0:es.color)||"#6c757d"},children:[((ss=t==null?void 0:t.status)==null?void 0:ss.name)||"Sin estado"," ",e.jsx("i",{className:"mdi mdi-chevron-down"})]}),e.jsx("div",{className:"dropdown-menu",children:W.map((s,n)=>e.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>ye(t.id,s.id),children:s.name},`status-${n}`))})]})]}),e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado del lead"}),e.jsxs("div",{className:"btn-group mb-0",style:{width:"100%"},children:[e.jsxs("button",{className:"btn btn-light btn-sm dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{color:"#ffffff",backgroundColor:((ts=t==null?void 0:t.manage_status)==null?void 0:ts.color)||"#6c757d"},children:[((ns=t==null?void 0:t.manage_status)==null?void 0:ns.name)||"Sin estado"," ",e.jsx("i",{className:"mdi mdi-chevron-down"})]}),e.jsx("div",{className:"dropdown-menu",children:Ne.map((s,n)=>e.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>Ee(t,s),children:s.name},`status-${n}`))})]})]})]}),(t==null?void 0:t.assigned_to)&&e.jsxs(e.Fragment,{children:[e.jsx("b",{className:"d-block mb-1",children:"Atendido por:"}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("img",{className:"d-flex me-2 rounded-circle",src:`//${M.APP_DOMAIN}/api/profile/thumbnail/${(as=t==null?void 0:t.assigned)==null?void 0:as.relative_id}`,alt:(rs=t==null?void 0:t.assigned)==null?void 0:rs.name,height:"32"}),e.jsxs("div",{className:"w-100",children:[e.jsx("h5",{className:"m-0 font-14",children:(is=t==null?void 0:t.assigned)==null?void 0:is.name}),e.jsx("span",{className:"font-12 mb-0",children:(cs=t==null?void 0:t.assigned)==null?void 0:cs.email})]})]})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos del contacto"}),e.jsx("h5",{className:"font-600 mb-0",children:"Correo electronico"}),e.jsxs("p",{className:"mb-2 text-truncate",children:[" ",t==null?void 0:t.contact_email," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Tefono / Celular"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.contact_phone," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Mensaje"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.message," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Fecha de registro"}),e.jsxs("p",{className:"mb-2",children:[moment(t==null?void 0:t.created_at).format("LL"),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:moment(t==null?void 0:t.created_at).format("LTS")})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos de la empresa"}),e.jsx("h5",{className:"font-600 mb-0",children:"Nombre comercial"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.tradename)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"RUC"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.ruc)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"N° trabajadores"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.workers)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]})]}),e.jsx("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12",children:e.jsxs("div",{className:"card card-body",children:[e.jsxs("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto"},children:[e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active text-center",children:[e.jsx("i",{className:"mdi mdi-clock"})," Actividad"]})},"note-type-activity"),I.sort((s,n)=>s.order-n.order).map((s,n)=>{if(!(!(t!=null&&t.contact_email)&&s.name=="Correos"))return e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#note-type-${s.id}`,"data-name":s.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link text-center",children:[e.jsx("i",{className:s.icon})," ",s.name]})},`note-type-${n}`)})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"note-type-activity",children:te.sort((s,n)=>n.created_at>s.created_at?1:-1).map((s,n)=>e.jsx(us,{...s,onTaskChange:Je,showOptions:!1,session:B},`note-${n}`))},"tab-note-type-activity"),I.sort((s,n)=>s.order-n.order).map((s,n)=>{const m=s.id=="37b1e8e2-04c4-4246-a8c9-838baa7f8187"&&!Te;return e.jsxs("div",{className:"tab-pane",id:`note-type-${s.id}`,children:[!m&&e.jsxs("h4",{className:"header-title mb-2 d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:["Lista de ",s.name]}),s.id=="37b1e8e2-04c4-4246-a8c9-838baa7f8187"&&e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(H,{content:"Refrescar correos",children:e.jsx("button",{className:"btn btn-xs btn-white",type:"button",disabled:Ye,onClick:()=>re(l=>({...l,refresh:crypto.randomUUID()})),children:Ye?e.jsx("i",{className:"fa fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-redo"})})}),e.jsxs("button",{className:"btn btn-xs btn-success",type:"button",onClick:()=>{Xe(null),$(j.current).modal("show")},children:[e.jsx("i",{className:"mdi mdi-pen me-1"}),"Redactar"]})]})]}),e.jsx("input",{ref:fe[s.id],type:"hidden"}),e.jsxs("div",{className:"row",children:[m&&e.jsxs("div",{className:"col-12 text-center",children:[e.jsx("h1",{children:"¡Ups!"}),e.jsxs("p",{children:["Necesitamos tu permiso para acceder a tu correo electrónico. ",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"No te preocupes, tus datos están seguros con nosotros."})]}),e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center gap-1",children:[e.jsx("button",{className:"btn btn-sm btn-primary",type:"button",onClick:()=>qe(crypto.randomUUID()),children:"Ya he iniciado sesión"}),e.jsxs("button",{className:"btn btn-sm btn-white d-inline-flex align-items-center gap-1",type:"button",onClick:l=>{const r=window.open(_s,"_blank"),Y=F.Local.get("tokenUUID"),X=setInterval(()=>{const V=F.Local.get("tokenUUID");Y!=V&&(clearInterval(X),r.close(),qe())},[500])},children:[e.jsx("img",{src:ot,alt:"",style:{width:"14px",height:"14px",objectFit:"contain",objectPosition:"center"}}),e.jsx("span",{children:"Permitir acceso"})]})]})]}),s.id=="e20c7891-1ef8-4388-8150-4c1028cc4525"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{eRef:z,label:"Titulo de la tarea",col:"col-12",required:!0}),e.jsxs(pe,{eRef:J,label:"Tipo de tarea",col:"col-lg-4 col-md-12",required:!0,dropdownParent:`#note-type-${s.id}`,minimumResultsForSearch:1/0,children:[e.jsx("option",{value:"Llamada",children:"Llamada"}),e.jsx("option",{value:"Correo",children:"Correo"}),e.jsx("option",{value:"Por hacer",selected:!0,children:"Por hacer"})]}),e.jsxs(pe,{eRef:K,label:"Prioridad",col:"col-lg-3 col-md-12",required:!0,dropdownParent:`#note-type-${s.id}`,minimumResultsForSearch:1/0,children:[e.jsx("option",{value:"Baja",children:"Baja"}),e.jsx("option",{value:"Media",selected:!0,children:"Media"}),e.jsx("option",{value:"Alta",children:"Alta"}),e.jsx("option",{value:"Urgente",children:"Urgente"})]}),e.jsx(st,{eRef:Z,label:"Asignado a",col:"col-lg-5 col-md-12",dropdownParent:`#note-type-${s.id}`,searchAPI:"/api/users/paginate",searchBy:"fullname"}),e.jsx(ie,{eRef:L,label:"Fecha finalización",type:"date",col:"col-lg-6 col-md-12",required:!0}),e.jsx(ie,{eRef:N,label:"Hora finalización",type:"time",col:"col-lg-6 col-md-12",required:!0})]}),s.id=="8e895346-3d87-4a87-897a-4192b917c211"&&e.jsx(e.Fragment,{children:e.jsx(ie,{eRef:d,label:"Proceso",col:"col-12",parentClassName:"dropdown",className:"dropdown-toggle","data-bs-toggle":"dropdown",children:e.jsx("ul",{className:"dropdown-menu",style:{width:"100%"},children:q.map((l,r)=>e.jsxs("li",{className:"dropdown-item",onClick:()=>d.current.value=l.name,style:{cursor:"pointer"},children:[e.jsx("b",{className:"d-block",children:l.name}),l.description&&e.jsx("small",{className:"d-block text-truncate",children:l.description})]},r))})})}),e.jsxs("div",{className:"col-12 mb-2",hidden:s.id=="37b1e8e2-04c4-4246-a8c9-838baa7f8187",children:[e.jsx("label",{className:"mb-1",htmlFor:"",children:"Contenido"}),e.jsx("div",{ref:we[s.id],id:`editor-${s.id}`,style:{height:"162px",transition:"transform 0.3s ease, box-shadow 0.3s ease"}})]}),s.id=="8e895346-3d87-4a87-897a-4192b917c211"&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{eRef:v,label:"Estado de gestión",col:"col-sm-12 col-md-12 col-lg-6",dropdownParent:`#note-type-${s.id}`,minimumResultsForSearch:-1,children:W.map((l,r)=>e.jsx("option",{value:l.id,children:l.name},r))}),e.jsx(pe,{eRef:x,label:"Estado del lead",col:"col-lg-6 col-md-12",dropdownParent:`#note-type-${s.id}`,minimumResultsForSearch:-1,children:Ne.map((l,r)=>e.jsx("option",{value:l.id,children:l.name},r))})]}),s.id!="37b1e8e2-04c4-4246-a8c9-838baa7f8187"&&e.jsx("div",{className:"col-12",children:e.jsx("button",{className:"btn btn-sm btn-success",type:"button",value:s.id,onClick:As,children:"Guardar"})})]}),s.id!="37b1e8e2-04c4-4246-a8c9-838baa7f8187"&&e.jsx("hr",{}),s.id=="37b1e8e2-04c4-4246-a8c9-838baa7f8187"?Ae==null?void 0:Ae.map((l,r)=>{const Y=F.String(l.sender).replace(/\<(.*?)\>/g,'<span className="me-1">·</span><small style="font-weight: lighter">&lt;$1&gt;</small>'),X=new Date(l.date);return e.jsxs("div",{className:"card mb-2 border",children:[e.jsxs("div",{className:"card-header p-2",style:{cursor:"pointer"},onClick:async()=>{const V=await Ue.getDetails(l.id);V&&(Ps(V),$(u.current).modal("show"))},children:[e.jsxs("b",{className:"d-block",children:[l.type=="sent"?e.jsx("i",{className:"mdi mdi-send me-1"}):e.jsx("i",{className:"mdi mdi-inbox me-1"}),e.jsx(hs,{className:"d-inline",html:Y})]}),e.jsx("small",{className:"text-muted",children:moment(X).format("LLL")})]}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("small",{children:[e.jsx("b",{children:l.subject})," - ",l.snippet||"."]})})]},r)}):te.filter(l=>l.note_type_id==s.id).sort((l,r)=>r.created_at>l.created_at?1:-1).map((l,r)=>e.jsx(us,{...l,session:B,onDeleteNote:Es,onUpdateNote:Fs},`note-${r}`))]},`tab-note-type-${n}`)})]})]})}),e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-danger",children:e.jsx("h5",{className:"header-title my-0 text-white",children:"Tareas"})}),e.jsx("div",{className:"card-body",children:Oe.length>0?Oe.sort((s,n)=>s.ends_at>n.ends_at?1:-1).map((s,n)=>e.jsx(Ls,{...s,onChange:Je},`task-${n}`)):e.jsx("i",{className:"text-muted",children:"- No hay tareas pendientes -"})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-primary",children:[e.jsxs("div",{className:"float-end text-white",children:["S/. ",_e(Pe.reduce((s,n)=>s+Number(n.price),0))]}),e.jsx("h5",{className:"header-title my-0 text-white",children:"Productos"})]}),e.jsxs("div",{className:"card-body",children:[e.jsx(ys,{className:"d-block mx-auto btn btn-sm btn-white rounded-pill",title:"Agregar",icon:{icon:"fa fa-plus"},tippy:"Agregar producto al cliente",children:A.map((s,n)=>Pe.find(m=>m.id==s.id)?e.jsxs(Se,{className:"py-1",style:{cursor:"not-allowed",opacity:.5},tippy:"Ya ha sido agregado",children:[e.jsx("b",{className:"d-block text-truncate",children:s.name}),e.jsxs("small",{children:["S/. ",_e(s.price)]})]},n):e.jsxs(Se,{className:"py-1",onClick:()=>Is(s),children:[e.jsx("b",{className:"d-block text-truncate",children:s.name}),e.jsxs("small",{children:["S/. ",_e(s.price)]})]},n))}),e.jsx("div",{className:"mt-2 d-flex flex-column gap-2",children:Pe.map((s,n)=>e.jsx(lt,{...s,onDelete:Os,onChange:Bs},n))})]})]})]})]})}),e.jsx(xe,{modalRef:P,title:"Nuevo lead",btnSubmitText:"Guardar",onSubmit:Ms,zIndex:1060,children:e.jsxs("div",{className:"row mb-0",children:[e.jsx("input",{ref:f,type:"hidden"}),e.jsx(ie,{eRef:D,label:"Nombre completo"}),e.jsx(ie,{eRef:T,label:"Correo electronico",type:"email",col:"col-md-6"}),e.jsx(ie,{eRef:R,label:"Telefono",type:"tel",col:"col-md-6",required:!0,onBlur:()=>Ze()}),e.jsx(ie,{eRef:c,label:"Empresa / Marca",col:"col-md-6"}),e.jsx(ie,{eRef:g,label:"Link de WEB",col:"col-md-6"}),e.jsx(ws,{eRef:w,label:"Mensaje",placeholder:"Ingresa tu mensaje",rows:4})]})}),e.jsxs(xe,{modalRef:u,title:p==null?void 0:p.subject,size:"lg",zIndex:1055,hideHeader:!0,hideFooter:!0,children:[e.jsx("button",{type:"button",className:"btn-close float-end","data-bs-dismiss":"modal","aria-label":"Close"}),e.jsx("table",{style:{width:"max-content",maxWidth:"100%"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"py-0 px-1",style:{textAlign:"end"},children:"De:"}),e.jsx("td",{className:"py-0 px-1",children:p==null?void 0:p.sender})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"py-0 px-1",style:{textAlign:"end"},children:"Para:"}),e.jsx("td",{className:"py-0 px-1",children:p==null?void 0:p.to})]}),(p==null?void 0:p.cc)&&e.jsxs("tr",{children:[e.jsx("th",{className:"py-0 px-1",style:{textAlign:"end"},children:"Cc:"}),e.jsx("td",{className:"py-0 px-1",children:p==null?void 0:p.cc})]}),(p==null?void 0:p.bcc)&&e.jsxs("tr",{children:[e.jsx("th",{className:"py-0 px-1",style:{textAlign:"end"},children:"Bcc:"}),e.jsx("td",{className:"py-0 px-1",children:p==null?void 0:p.bcc})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"py-0 px-1",style:{textAlign:"end"},children:"Fecha:"}),e.jsx("td",{className:"py-0 px-1",children:moment(new Date(p==null?void 0:p.date)).format("LLL")})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"py-0 px-1",style:{textAlign:"end"},children:"Asunto:"}),e.jsx("td",{className:"py-0 px-1",children:p==null?void 0:p.subject})]})]})}),e.jsx("hr",{className:"my-2"}),e.jsx(hs,{html:p==null?void 0:p.bodyHtml,style:{minHeight:"360px"}}),e.jsx("hr",{className:"mt-2 mb-0"}),((ls=p==null?void 0:p.attachments)==null?void 0:ls.length)>0&&e.jsx("div",{className:"mt-2 d-flex flex-wrap gap-2",children:(os=p==null?void 0:p.attachments)==null?void 0:os.map(s=>e.jsxs("div",{className:"d-flex gap-1 border p-1",style:{width:"180px"},children:[e.jsx("i",{className:"mdi mdi-file"}),e.jsxs("div",{children:[e.jsx(H,{content:s.filename,children:e.jsx("span",{className:"d-block text-truncate",style:{width:"145px"},children:s.filename})}),e.jsxs("div",{className:"d-flex gap-1 align-items-center justify-content-between",children:[e.jsx("small",{className:"d-block",children:ut(s.size)}),e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(H,{content:"Abrir",children:e.jsx("a",{href:`/api/gmail/attachment/${p==null?void 0:p.id}/${s.attachmentId}/${s.filename}`,target:"_blank",className:"btn btn-xs btn-white",type:"button",children:e.jsx("i",{className:"fa fa-eye"})})}),e.jsx(H,{content:"Descargar",children:e.jsx("a",{href:`/api/gmail/attachment/${p==null?void 0:p.id}/${s.attachmentId}/${s.filename}`,target:"_blank",download:!0,className:"btn btn-xs btn-white",type:"button",children:e.jsx("i",{className:"fa fa-download"})})})]})]})]})]}))}),((ds=p==null?void 0:p.sender)==null?void 0:ds.includes(t==null?void 0:t.contact_email))&&e.jsx("div",{className:"mt-2",children:e.jsxs("button",{className:"btn btn-xs btn-white rounded-pill",type:"button",onClick:()=>{Xe(p),$(j.current).modal("show")},children:[e.jsx("i",{className:"fas fa-reply me-1"}),"Responder"]})})]}),e.jsx(mt,{modalRef:j,data:t,session:B,setSession:ae,inReplyTo:Ds,onSend:s=>{re(n=>({...n,refresh:crypto.randomUUID()})),ue(n=>[...n,s])},defaultMessages:_,signs:O}),e.jsx(gt,{offCanvasRef:S,dataLoaded:ze,setDataLoaded:De,defaultMessages:_,onOpenModal:be,onLeadClicked:ge,signs:O})]})};zs((h,a)=>{qs(h).render(e.jsx(Vs,{...a,title:"Leads",children:e.jsx(wt,{...a})}))});
