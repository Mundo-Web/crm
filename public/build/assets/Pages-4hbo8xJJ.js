var I=Object.defineProperty;var q=(i,r,a)=>r in i?I(i,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[r]=a;var N=(i,r,a)=>q(i,typeof r!="symbol"?r+"":r,a);import{r as o,j as t,C as U,c as z}from"./CreateReactScript-9UX3kXBD.js";import{R as y}from"./ReactAppend-DWdmYZa_.js";import{B as O,A as J,i as k}from"./Adminto-C35O1tcN.js";import{M as L}from"./Modal-D0pWPGeP.js";import{T as V}from"./Table-BWmQ0vwx.js";import{I as P}from"./InputFormGroup-DwkqbD4D.js";import{T as H}from"./TextareaFormGroup-CuCCAr9y.js";import{T as A}from"./TippyButton-tIyXXVNe.js";import{D as G}from"./DxPanelButton-CqUF4ewX.js";import{S as K}from"./sweetalert2.esm.all-CVcmmqxW.js";import{S as Q}from"./SelectFormGroup-BbQul68P.js";import{r as W}from"./server.browser-DF3AkXWG.js";import"./default-DBDxJu4M.js";import"./index-C8mjqcKE.js";class X extends O{constructor(){super(...arguments);N(this,"path","pages");N(this,"hasFiles",!0)}}const F=({id:i,col:r,label:a,eRef:n,required:d=!1,onChange:f=()=>{},aspect:g="21/9",fit:x="cover",width:h="100%",height:m,containerStyle:p,onError:u="/api/cover/thumbnail/null"})=>{i||(i=`ck-${crypto.randomUUID()}`),n||(n=o.useRef());const b=o.useRef(),R=async c=>{const v=c.target.files[0],w=await File.toURL(v);b.current.src=w,f(c)};return o.useEffect(()=>{n.image=b.current},[null]),t.jsxs("div",{className:`form-group ${r} mb-1`,style:p,children:[t.jsxs("label",{htmlFor:i,className:"d-block form-label",children:[a," ",d&&t.jsx("b",{className:"text-danger",children:"*"})]}),t.jsx("label",{className:"d-block",htmlFor:i,style:{width:"max-content"},children:t.jsx("img",{ref:b,className:"d-block",src:"",alt:"aspect-video",onError:c=>c.target.src=u,style:{width:h,height:m,borderRadius:"4px",cursor:"pointer",aspectRatio:g,objectFit:x,objectPosition:"center"}})}),t.jsx("input",{ref:n,id:i,type:"file",src:"",alt:"",hidden:!0,accept:"image/*",onChange:R})]})},S=new X,Y=({subdomains:i,subdomain:r,can:a})=>{const n=o.useRef(),d=o.useRef(),f=o.useRef(),g=o.useRef(),x=o.useRef(),h=o.useRef(),m=o.useRef(),p=o.useRef(),u=o.useRef(),[b,R]=o.useState(!1),c=e=>{e!=null&&e.id?R(!0):R(!1),f.current.value=(e==null?void 0:e.id)||null,x.current.value=(e==null?void 0:e.path)||"",g.current.value=(e==null?void 0:e.name)||"",h.current.value=(e==null?void 0:e.description)||"",m.image.src=`/api/pages/media/${e.img_desktop}`,p.image.src=`/api/pages/media/${e.img_tablet}`,u.image.src=`/api/pages/media/${e.img_mobile}`,m.current.value=null,p.current.value=null,u.current.value=null,$(d.current).modal("show")},v=async e=>{var E,_,B;e.preventDefault();const s={id:f.current.value||void 0,path:x.current.value,name:g.current.value,description:h.current.value??void 0},l=new FormData;for(const M in s)l.append(M,s[M]);const j=((E=m.current.files)==null?void 0:E[0])??null,T=((_=p.current.files)==null?void 0:_[0])??null,C=((B=u.current.files)==null?void 0:B[0])??null;j&&l.append("img_desktop",j),T&&l.append("img_tablet",T),C&&l.append("img_mobile",C),await S.save(l)&&($(n.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"))},w=async e=>{const{isConfirmed:s}=await K.fire({title:"Eliminar rol",text:"¿Está seguro de eliminar este rol?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!s||!await S.delete(e)||$(n.current).dxDataGrid("instance").refresh()},D=({id:e,text:s,element:l})=>{if(!e)return s;const j=$(l).data("option");return $(W(t.jsxs("div",{children:[t.jsxs("b",{className:"d-block",children:[s," ",t.jsx("code",{children:j.correlative})]}),t.jsx("small",{className:"d-block text-truncate w-100",children:j.description||"Sin descripción larga larguisima de todos modos larog"})]})))};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2",children:t.jsx(Q,{minimumResultsForSearch:-1,templateResult:D,templateSelection:D,onChange:e=>setSelectedMonth(e.target.value),children:i.map((e,s)=>t.jsx("option",{value:e.correlative,"data-option":JSON.stringify(e),children:e.name},s))})})}),t.jsx(V,{gridRef:n,title:`Páginas - ${r.name}`,rest:S,toolBar:e=>{e.unshift(G({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(n.current).dxDataGrid("instance").refresh()})),a("pages","all","create")&&e.unshift(G({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>c()}))},filterValue:["subdomain_id","=",r.id],columns:[{dataField:"subdomain_id",visible:!1},{dataField:"path",caption:"Ruta"},{dataField:"name",caption:"Nombre"},{dataField:"description",caption:"Descripcion"},{dataField:"images",caption:"Imagenes",allowFiltering:!1,width:"200px",cellTemplate:(e,{data:s})=>{y(e,t.jsxs("div",{className:"d-flex gap-1",children:[t.jsx(k,{content:"Desktop",children:t.jsx("img",{src:`/api/pages/media/${s.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:16/9,objectFit:"cover",objectPosition:"top center"}})}),t.jsx(k,{content:"Tablet",children:t.jsx("img",{src:`/api/pages/media/${s.img_tablet||s.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:4/3,objectFit:"cover",objectPosition:"top center"}})}),t.jsx(k,{content:"Mobile",children:t.jsx("img",{src:`/api/pages/media/${s.img_mobile||s.img_tablet||s.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:9/16,objectFit:"cover",objectPosition:"top center"}})})]}))}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.attr("style","display: flex; gap: 4px; overflow: unset; height: 51px"),y(e,t.jsx(A,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>c(s),children:t.jsx("i",{className:"fa fa-pen"})})),y(e,t.jsx(A,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>w(s.id),children:t.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(L,{modalRef:d,title:b?"Editar página":"Agregar página",onSubmit:v,size:"sm",children:[t.jsx("input",{ref:f,type:"hidden"}),t.jsx(P,{eRef:x,label:"Ruta",col:"col-12",required:!0}),t.jsx(P,{eRef:g,label:"Nombre",col:"col-12",required:!0}),t.jsx(H,{eRef:h,label:"Descripcion",col:"col-12",rows:2}),t.jsxs("div",{className:"d-flex flex-wrap justify-content-start gap-2",children:[t.jsx(F,{eRef:m,label:"Desktop",aspect:16/9,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"}),t.jsx(F,{eRef:p,label:"Tablet",aspect:4/3,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"}),t.jsx(F,{eRef:u,label:"Mobile",aspect:9/16,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"})]})]})]})};U((i,r)=>{z(i).render(t.jsx(J,{...r,title:"Páginas",children:t.jsx(Y,{...r})}))});
