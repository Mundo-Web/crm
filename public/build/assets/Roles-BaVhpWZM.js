var D=Object.defineProperty;var O=(n,t,s)=>t in n?D(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var p=(n,t,s)=>(O(n,typeof t!="symbol"?t+"":t,s),s);import{m as c,R as r,C as P,c as G,r as l}from"./CreateReactScript-vbGM1frk.js";import{R as g}from"./ReactAppend-gizQ1-AH.js";import{P as x}from"./PermissionsRest-Dz_zuP96.js";import{i as M,A as B}from"./Adminto-Cs4UHGDv.js";import{M as R}from"./Modal-eo6CSBkF.js";import{T as L,a as w}from"./Table-CoXI2WCl.js";import{I as _}from"./InputFormGroup-HYuIwuxN.js";import{T as j}from"./TextareaFormGroup-BpOjoQVu.js";class d{}p(d,"paginate",async t=>{const{result:s}=await c.Fetch("/api/roles/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});return s}),p(d,"byUser",async t=>{const{result:s}=await c.Fetch(`/api/roles/user/${t}`);return s.data??[]}),p(d,"save",async t=>{try{const{status:s,result:o}=await c.Fetch("/api/roles",{method:"POST",body:JSON.stringify(t)});if(!s)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(s){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}}),p(d,"status",async({id:t,status:s})=>{try{const{status:o,result:i}=await c.Fetch("/api/roles/status",{method:"PATCH",body:JSON.stringify({id:t,status:s})});if(!o)throw new Error((i==null?void 0:i.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:i.message,type:"success"}),!0}catch(o){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:o.message,type:"danger"}),!1}}),p(d,"delete",async t=>{try{const{status:s,result:o}=await c.Fetch(`/api/roles/${t}`,{method:"DELETE"});if(!s)throw new Error((o==null?void 0:o.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(s){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}});const q=({id:n,children:t,className:s})=>r.createElement("div",{id:n,className:`accordion custom-accordion ${s}`},t),I=({title:n,id:t,parent:s,children:o,className:i,isOpened:m})=>r.createElement("div",{className:"card mb-1"},r.createElement("div",{className:"card-header p-0",id:`heading-${t}`},r.createElement("h5",{className:"m-0"},r.createElement("a",{className:`d-block text-dark ${!m&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${t}`,"aria-expanded":"false"},n))),r.createElement("div",{id:t,className:`collapse ${m&&"show"}`,"aria-labelledby":`heading-${t}`,"data-bs-parent":`#${s}`},r.createElement("div",{className:`card-body p-2 ${i}`},o))),J=({title:n,label:t,id:s,name:o,value:i,checked:m,required:f,rounded:v=!1,style:h,className:y})=>r.createElement(M,{content:n,arrow:!0},r.createElement("div",{className:`form-check form-check-success ${y}`,style:{...h,cursor:"pointer"}},r.createElement("input",{className:`form-check-input ${v&&"rounded-circle"}`,type:"checkbox",value:i,name:o,id:s,defaultChecked:m,required:f,style:{cursor:"pointer"}}),r.createElement("label",{className:"form-check-label",htmlFor:s,style:{cursor:"pointer"}},t))),z=({permissions:n})=>{n=Object.values(n.map(e=>{const[a]=e.name.split(".");return{...e,origin:a}}).reduce((e,a)=>(e[a.origin]||(e[a.origin]=[]),e[a.origin].push(a),e),{}));const t=l.useRef(),s=l.useRef(),o=l.useRef();l.useRef();const i=l.useRef(),m=l.useRef(),f=l.useRef(),[v,h]=l.useState(!1),[y,k]=l.useState({}),N=e=>{e!=null&&e.id?h(!0):h(!1),i.current.value=(e==null?void 0:e.id)||null,m.current.value=(e==null?void 0:e.name)||null,f.current.value=(e==null?void 0:e.description)||null,$(s.current).modal("show")},F=async e=>{k(e);const a=await x.byRole(e.id);$("#permissions input").prop("checked",!1),a.forEach(({name:u})=>{$(`[name="${u}"]`).prop("checked",!0)}),$(o.current).modal("show")},C=async e=>{e.preventDefault();const a={id:i.current.value||void 0,name:m.current.value,description:f.current.value};await d.save(a)&&($(t.current).dxDataGrid("instance").refresh(),$(s.current).modal("hide"))},T=async e=>{e.preventDefault();const a=[...$("#permissions input:checked")].map(b=>b.value),u={role_id:y.id,permissions:a};await x.massiveByRole(u)&&($(o.current).modal("hide"),$(t.current).dxDataGrid("instance").refresh())},S=async e=>{await d.delete(e)&&$(t.current).dxDataGrid("instance").refresh()};return r.createElement(r.Fragment,null,r.createElement(L,{gridRef:t,title:"Roles",rest:d,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",hint:"Nuevo registro",onClick:()=>N()}})},columns:[{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",width:"150px",cellTemplate:(e,{data:a})=>{g(e,r.createElement("span",null,moment(a.created_at).format("LL")))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",width:"150px",cellTemplate:(e,{data:a})=>{g(e,r.createElement("span",null,moment(a.updated_at).format("LL")))}},{caption:"Acciones",cellTemplate:(e,{data:a})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),g(e,r.createElement(w,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>N(a)},r.createElement("i",{className:"fa fa-pen"}))),g(e,r.createElement(w,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>F(a),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>'},r.createElement("i",{className:"fas fa-th-list"}))),g(e,r.createElement(w,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(a.id)},r.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),r.createElement(R,{modalRef:s,title:v?"Editar rol":"Agregar rol",onSubmit:C},r.createElement("div",{className:"row"},r.createElement("input",{ref:i,type:"hidden"}),r.createElement(_,{eRef:m,label:"Rol",col:"col-12",required:!0}),r.createElement(j,{eRef:f,label:"Descripcion",col:"col-12"}))),r.createElement(R,{modalRef:o,title:`Permisos para ${y.name}`,btnSubmitText:"Guardar",onSubmit:T,size:"sm"},r.createElement(q,{id:"permissions"},n.map((e,a)=>{const u=e[0].origin;return r.createElement(I,{key:`accordion-${a}`,id:`permission-${u}`,title:u,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row"},e.map(({id:E,name:b,description:A})=>r.createElement(J,{key:`permission-${E}`,className:"mb-0",id:`permission-ck-${E}`,label:b.replace(`${u}.`,""),name:b,value:E,title:A,style:{width:"max-content"},rounded:!0})))}))))};P((n,t)=>{G(n).render(r.createElement(B,{...t,title:"Roles"},r.createElement(z,{...t})))});
