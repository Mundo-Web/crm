var u=Object.defineProperty;var x=(r,a,i)=>a in r?u(r,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[a]=i;var n=(r,a,i)=>x(r,typeof a!="symbol"?a+"":a,i);import{C as y,c as b,j as s,r as g,m as h}from"./CreateReactScript-CgEuCtoy.js";import{S as j}from"./sweetalert2.esm.all-DJ5rN5x4.js";import{N as v}from"./Number2Currency-e57Tgsuk.js";import{B as w,A as F}from"./Adminto-Cc3sH-IM.js";import{T}from"./Table-BnfAi9Dz.js";import{D as c}from"./DxButton-CsjWvhyj.js";import{D as l}from"./DxBox-BPBYZOVw.js";import{A as N,D,P as _}from"./DateRange-DZOMlwoa.js";import{D as R}from"./DxPanelButton-TL5fAOqj.js";import{R as C}from"./ReactAppend-XQOKTJts.js";import"./Logout-BrZdhYEK.js";import"./server.browser-DtYOuO13.js";import"./default-C8QyGrl1.js";import"./index-CC_HFtZZ.js";class A extends w{constructor(){super(...arguments);n(this,"path","projects/archived")}}const m=new A,S=({can:r})=>{const a=g.useRef(),i=async({id:e,status:t})=>{await _.status({id:e,status:t})&&$(a.current).dxDataGrid("instance").refresh()},d=async e=>{const{isConfirmed:t}=await j.fire({title:"¿Estás seguro de eliminar este proyecto?",text:"Esta accion es irreversible, se eliminara el proyecto por completo",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!t||!await m.delete(e)||$(a.current).dxDataGrid("instance").refresh()};return s.jsx(s.Fragment,{children:s.jsx(T,{gridRef:a,title:"Proyectos Archivados",rest:m,exportable:!0,toolBar:e=>{e.unshift(R({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}))},filterValue:void 0,columns:[{dataField:"client.tradename",caption:"Nombre comercial",filterValue:h.GET.client||void 0,fixed:!0,fixedPosition:"left"},{dataField:"type.name",caption:"Tipo",visible:!1},{dataField:"name",caption:"Proyecto"},{dataField:"users",caption:"Asignados",dataType:"string",cellTemplate:(e,{data:t})=>{const o=(t.users||"").split("|").filter(Boolean);e.append(l([N(o)]))},visible:!1,allowExporting:!1},r("projects","root","all","addpayment")&&{dataField:"cost",caption:"Costo total",dataType:"number",cellTemplate:(e,{data:t})=>{e.text(`S/. ${v(t.cost)}`)}},r("projects","root","all","addpayment")&&{dataField:"remaining_amount",caption:"Debe",dataType:"number",cellTemplate:(e,{data:t})=>{const o=(t.total_payments/t.cost*100).toFixed(2),p=Number(t.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),f=Number(t.cost-t.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2});e.append(l([s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"mb-0 d-flex justify-content-between",children:[s.jsxs("b",{className:"text-success",children:[s.jsx("i",{className:"fa fa-arrow-circle-up"})," S/. ",p]}),s.jsxs("b",{className:"float-end text-danger",children:[s.jsx("i",{className:"fa fa-arrow-circle-down"})," S/. ",f]})]}),s.jsx("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"},children:s.jsx("div",{className:"progress-bar bg-primary progress-animated wow animated animated animated",role:"progressbar","aria-valuenow":t.total_payments,"aria-valuemin":"0","aria-valuemax":t.cost,style:{width:`${o}%`,visibility:"visible",animationName:"animationProgress"}})})]})],!1))},allowExporting:!1},{dataField:"starts_at",caption:"Fecha inicio proyecto",dataType:"date",format:"yyyy-MM-dd",cellTemplate:(e,{data:t})=>{e.text(moment(t.starts_at).format("LL"))}},{dataField:"ends_at",caption:"Fecha fin proyecto",dataType:"date",format:"yyyy-MM-dd",cellTemplate:(e,{data:t})=>{e.append(l([{width:"200px",height:"30px",children:D(t.starts_at,t.ends_at)}]))},sortOrder:"asc"},{dataField:"last_payment_date",dataType:"datetime",visible:!1},{dataField:"last_payment.date",caption:"Fecha ultimo pago",dataType:"date",format:"yyyy-MM-dd",cellTemplate:(e,{data:t})=>{if(!(t!=null&&t.last_payment_date))return e.html('<i class="text-muted">- No hay pagos -</i>');e.text(moment(t==null?void 0:t.last_payment_date).format("LL"))}},r("projects","root","all","changestatus")?{dataField:"status.name",caption:"Estado del proyecto",dataType:"string",cellTemplate:(e,{data:t})=>{e.attr("style","overflow: visible"),C(e,s.jsxs("button",{className:"btn btn-xs btn-light rounded-pill",disabled:!0,children:[s.jsx("i",{class:"fa fa-circle me-1",style:{color:t.status.color}}),t.status.name]}))}}:null,{caption:"Acciones",cellTemplate:(e,{data:t})=>{r("projects","root","all","changestatus")&&e.append(c({className:"btn btn-xs btn-soft-dark",title:"Restaurar",icon:"fas fa-trash-restore",onClick:()=>i(t)})),r("projects","root","all","delete")&&e.append(c({className:"btn btn-xs btn-soft-danger",title:"Eliminar definitivamente",icon:"fas fa-trash",onClick:()=>d(t.id)}))},allowFiltering:!1,allowExporting:!1}]})})};y((r,a)=>{if(!a.can("projects","root","all","list"))return location.href="/";b(r).render(s.jsx(F,{...a,title:"Proyectos archivados",children:s.jsx(S,{...a})}))});
