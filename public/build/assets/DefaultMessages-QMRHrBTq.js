var B=Object.defineProperty;var k=(l,r,a)=>r in l?B(l,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[r]=a;var g=(l,r,a)=>k(l,typeof r!="symbol"?r+"":r,a);import{C as G,c as z,j as s,r as i}from"./CreateReactScript-DSh221L4.js";import{R as T}from"./ReactAppend-CCPXxX5R.js";import{B as I,A as P,S as W}from"./Adminto-CxkkDmWv.js";import{M as q}from"./Modal-BIUwwQCB.js";import{T as H,D as A}from"./DxPanelButton-B7q8MKlo.js";import{I as L}from"./InputFormGroup-DsuG1yrP.js";import{T as Q}from"./TextareaFormGroup-CVonM_0b.js";import{T as C}from"./TippyButton-BY7aP8sy.js";import{S as O}from"./SelectFormGroup-D827EBoU.js";import{r as S}from"./server.browser-DoheiHq8.js";import{Q as _}from"./QuillFormGroup-BM-TJ7M-.js";class J extends I{constructor(){super(...arguments);g(this,"path","default-messages");g(this,"hasFiles",!0)}}const b=new J,K=({title:l})=>{const r=i.useRef(),a=i.useRef(),u=i.useRef(),h=i.useRef(),m=i.useRef(),d=i.useRef(),o=i.useRef(),[v,R]=i.useState(!1),[n,y]=i.useState("whatsapp"),x=i.useRef(),[p,f]=i.useState([]),w=e=>{const t=Array.from(e.target.files);f(n==="whatsapp"?[t[0]]:c=>[...c,...t]),x.current.value=null},D=e=>{f(t=>t.filter((c,j)=>j!==e))},N=e=>{e!=null&&e.id?R(!0):R(!1),u.current.value=(e==null?void 0:e.id)||null,h.current.value=(e==null?void 0:e.name)||null,$(d.current).val((e==null?void 0:e.type)||"whatsapp").trigger("change.select2"),y((e==null?void 0:e.type)||"whatsapp"),(e==null?void 0:e.type)==="email"?(o.current.value=(e==null?void 0:e.description)||"",o.editor.root.innerHTML=(e==null?void 0:e.description)||""):m.current.value=(e==null?void 0:e.description)||null,f([]),$(a.current).modal("show")},E=async e=>{e.preventDefault();const t=new FormData;u.current.value&&t.append("id",u.current.value),t.append("name",h.current.value),t.append("type",d.current.value),t.append("description",n==="email"?o.current.value:m.current.value),n==="email"&&p.forEach(j=>{t.append("attachments[]",j)}),await b.save(t)&&($(r.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},F=e=>{const t=$(d.current).val();y(t),t==="email"?(m.current.value="",o.editor.root.innerHTML=""):(o.current.value="",m.current.value="")},M=async e=>{const{isConfirmed:t}=await W.fire({title:"Eliminar registro",text:"Â¿Desea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",reverseButtons:!0});!t||!await b.delete(e)||$(r.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(H,{gridRef:r,title:l,rest:b,toolBar:e=>{e.unshift(A({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(r.current).dxDataGrid("instance").refresh()})),e.unshift(A({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>N()}))},columns:[{dataField:"name",caption:"Alias"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{value:t})=>{e.html(S(s.jsx("span",{className:`badge bg-${t==="email"?"info":"success"}`,children:t==="email"?"Email":"WhatsApp"})))}},{dataField:"description",caption:"Descripcion",width:"60%",cellTemplate:(e,{value:t,data:c})=>{t?c.type==="email"?e.text($(`<div>${t}</div>`).text().trim()):e.text(t):e.html(S(s.jsx("i",{className:"text-muted",children:"- Sin descripcion -"})))}},{caption:"Acciones",width:"120px",cellTemplate:(e,{data:t})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),T(e,s.jsx(C,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>N(t),children:s.jsx("i",{className:"fa fa-pen"})})),T(e,s.jsx(C,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>M(t.id),children:s.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(q,{modalRef:a,title:v?"Editar mensaje predeterminado":"Agregar mensaje predeterminado",onSubmit:E,size:n=="email"?"lg":"md",children:s.jsxs("div",{className:"row",id:"default-messages-container",children:[s.jsx("input",{ref:u,type:"hidden"}),s.jsxs(O,{eRef:d,label:"Tipo mensaje",dropdownParent:"#default-messages-container",minimumResultsForSearch:-1,onChange:F,disabled:v,required:!0,children:[s.jsx("option",{value:"whatsapp",children:"WhatsApp"}),s.jsx("option",{value:"email",children:"Email"})]}),s.jsx(L,{eRef:h,label:"Alias",col:"col-12",required:!0}),s.jsx("div",{hidden:n==="email",children:s.jsx(Q,{eRef:m,label:"Mensaje",col:"col-12"})}),s.jsxs("div",{hidden:n==="whatsapp",children:[s.jsx(_,{eRef:o,label:"Mensaje",col:"col-12"}),s.jsxs("div",{className:"col-12",children:[s.jsx("input",{ref:x,type:"file",className:"d-none",multiple:n==="email",onChange:w}),s.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[s.jsxs("label",{className:"btn btn-sm btn-soft-primary mb-0",style:{cursor:"pointer"},children:[s.jsx("i",{className:"mdi mdi-paperclip me-1"}),"Adjuntar ",n==="whatsapp"?"archivo":"archivos",s.jsx("input",{type:"file",ref:x,className:"d-none",multiple:n==="email",onChange:w})]}),n==="whatsapp"&&p.length>0&&s.jsx("small",{className:"text-muted",children:"Solo se permite un archivo para WhatsApp"})]}),p.length>0&&s.jsxs("div",{className:"border rounded p-2 mb-3",children:[s.jsxs("div",{className:"d-flex align-items-center mb-2",children:[s.jsx("i",{className:"mdi mdi-paperclip me-1"}),s.jsx("small",{className:"text-muted",children:n==="whatsapp"?"Archivo adjunto":`Archivos adjuntos (${p.length})`})]}),s.jsx("div",{className:"d-flex flex-wrap gap-2",children:p.map((e,t)=>s.jsxs("div",{className:"border rounded p-1 d-flex align-items-center gap-2",style:{fontSize:"0.8rem"},children:[s.jsx("i",{className:"mdi mdi-file"}),s.jsx("span",{children:e.name}),s.jsx("button",{type:"button",className:"btn btn-xs btn-soft-danger py-0 px-1",onClick:()=>D(t),children:s.jsx("i",{className:"mdi mdi-close"})})]},t))})]})]})]})]})})]})};G((l,r)=>{r.title="Mensajes Predeterminados",z(l).render(s.jsx(P,{...r,children:s.jsx(K,{...r})}))});
