var U=Object.defineProperty;var z=(r,n,o)=>n in r?U(r,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[n]=o;var k=(r,n,o)=>(z(r,typeof n!="symbol"?n+"":n,o),o);import{C as O,c as I,R as e,r as i,G as V}from"./CreateReactScript-DiMSE74L.js";import{M as W}from"./Modal-DIHwUr7I.js";import{B as X,A as q,S as H}from"./Adminto-DDJrXyEx.js";import{C,T as J,a as K,b as Q}from"./ClientNotesCard-egRi8tAY.js";import{T as E}from"./TippyButton-BVoSO3IC.js";import{P as Y}from"./ProjectStatusDropdown-CTiWr1xu.js";import{R as _}from"./ReactAppend-BsJVsMpn.js";import{P as Z,A as j,D as L}from"./Assigneds-DqqFVzyP.js";import{T as ee,D as te}from"./DxPanelButton-6w4Akznr.js";import{N as ae}from"./Number2Currency-e57Tgsuk.js";import{D as se}from"./DxBox-DTge2tdv.js";import"./Dropdown-BnWkcEvN.js";import"./DropdownItem-E29r08GI.js";import"./server.browser-BzA2yPSr.js";class le extends X{constructor(){super(...arguments);k(this,"path","archived")}}const g=new le,ne=new K,re=new Q,ce=({projectStatuses:r,archived:n,products:o=[],can:u,session:v,defaultLeadStatus:D,noteTypes:y})=>{var x,w;const d=i.useRef(),p=i.useRef(),[a,b]=i.useState(null),[m,h]=i.useState([]),R=async({id:t,status:s})=>{await g.status({id:t,status:s})&&$(d.current).dxDataGrid("instance").refresh()},S=async t=>{const{isConfirmed:s}=await H.fire({title:"Estas seguro de eliminar a esta persona?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!s||!await g.delete(t)||$(d.current).dxDataGrid("instance").refresh()},A=async t=>{b(t),history.pushState(null,null,`/archived/${t.id}`),h([]),$(p.current).modal("show")};i.useEffect(()=>{T()},[a]);const T=async()=>{const t=await re.byClient(a==null?void 0:a.id);h(t??[])};i.useEffect(()=>{$(p.current).on("hidden.bs.modal",()=>{b(null),history.pushState(null,null,"/archived")}),n&&ne.get(n).then(t=>{t&&(b(t),h([]),$(p.current).modal("show"),GET.annotation&&$(`[data-name="${GET.annotation}"]`).click())})},[null]);const F=[];m==null||m.forEach(t=>F.push(...t.tasks));const N=[];return m==null||m.forEach(t=>N.push(...t.tasks.filter(s=>s.status!="Realizado"))),e.createElement(e.Fragment,null,e.createElement(ee,{gridRef:d,title:"Archivados",rest:g,toolBar:t=>{t.unshift(te({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}))},columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(t,{data:s})=>{t.attr("style","height: 48px; cursor: pointer"),t.on("click",()=>A(s)),t.html(s.status_id==D?`<b>${s.contact_name}</b>`:s.contact_name)},fixed:!0,fixedPosition:"left"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{caption:"Acciones",width:235,cellTemplate:(t,{data:s})=>{t.attr("style","display: flex; gap: 4px; overflow: visible"),u("clients","root","all","changestatus")&&_(t,e.createElement(E,{className:"btn btn-xs btn-light",title:"Restaurar",onClick:()=>R(s)},e.createElement("i",{className:"fas fa-trash-restore"}))),u("clients","root","all","delete")&&_(t,e.createElement(E,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>S(s.id)},e.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}],masterDetail:{enabled:!1,template:async(t,{data:s,component:c})=>{t.css("padding","10px"),t.css("overflow","visible"),t.css("background-color","#323a46");let{data:f}=await Z.paginate({filter:["client_id","=",s.id],isLoadingAll:!0});t.append(se([e.createElement(e.Fragment,null,e.createElement(E,{title:"Cerrar tabla",className:"btn btn-xs btn-soft-danger waves-effect mb-1",onClick:()=>c.collapseAll(-1)},e.createElement("i",{className:"fa fa-times"})),e.createElement("table",{className:"table table-dark table-sm table-bordered mb-0",style:{width:"100%"}},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{scope:"col"},"Tipo"),e.createElement("th",{scope:"col"},"Asignados"),e.createElement("th",{scope:"col"},"Costo"),e.createElement("th",{scope:"col"},"Pagos"),e.createElement("th",{scope:"col"},"Fecha de desarrollo"),e.createElement("th",{scope:"col"},"Estado del proyecto"),e.createElement("th",{scope:"col"},"Acciones"))),e.createElement("tbody",null,f.map(l=>{const P=(l.total_payments/l.cost*100).toFixed(2),B=Number(l.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),G=Number(l.cost-l.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),M=(l.users||"").split("|").filter(Boolean);return e.createElement("tr",{key:`project-${l.id}`},e.createElement("td",{valign:"middle"},l.type.name),e.createElement("td",{valign:"middle"},j(M)),e.createElement("td",{valign:"middle"},`S/. ${ae(l.cost)}`),e.createElement("td",{valign:"middle"},e.createElement("p",{className:"mb-0 d-flex justify-content-between"},e.createElement("b",{className:"text-success"},e.createElement("i",{className:"fa fa-arrow-circle-up"})," S/. ",B),e.createElement("b",{className:"float-end text-danger"},e.createElement("i",{className:"fa fa-arrow-circle-down"})," S/. ",G)),e.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"}},e.createElement("div",{className:"progress-bar bg-primary progress-animated wow animated",role:"progressbar","aria-valuenow":l.total_payments,"aria-valuemin":"0","aria-valuemax":l.cost,style:{width:`${P}%`,visibility:"visible",animationName:"animationProgress"}}))),e.createElement("td",{valign:"middle"},L(l.starts_at,l.ends_at)),e.createElement("td",{valign:"middle"},e.createElement(Y,{can:u,statuses:r,data:l,onChange:()=>{$(d.current).dxDataGrid("instance").refresh()}})),e.createElement("td",null,u("projects","root","all","assignUsers")&&e.createElement(E,{className:"btn btn-xs btn-soft-info me-1",title:"Asignar usuarios",icon:"fa fa-user-plus",onClick:()=>setProject2Assign(l)},e.createElement("i",{className:"fa fa-user-plus"})),u("projects","root","all","addpayment")&&e.createElement(E,{className:"btn btn-xs btn-soft-success",title:"Ver/Agregar pagos",icon:"fas fa-money-check-alt",onClick:()=>setProjectLoaded(l)},e.createElement("i",{className:"fas fa-money-check-alt"}))))}))))]))}}}),e.createElement(W,{modalRef:p,title:"Detalles del archivado",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:t=>t.preventDefault(),hideFooter:!0},e.createElement("div",{className:"row"},e.createElement("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"d-flex mb-3"},e.createElement("img",{className:"flex-shrink-0 me-3 rounded-circle avatar-md",alt:a==null?void 0:a.contact_name,src:`//${V.APP_DOMAIN}/api/profile/null`}),e.createElement("div",{className:"flex-grow-1"},e.createElement("h4",{className:"media-heading mt-0"},a==null?void 0:a.contact_name),e.createElement("span",{className:"badge bg-primary me-1"},(a==null?void 0:a.contact_position)||"Trabajador")," ",e.createElement("small",{className:"text-muted"},"desde ",e.createElement("b",null,a==null?void 0:a.origin)))),e.createElement("div",{className:"btn-group mb-0"},e.createElement("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((x=a==null?void 0:a.manage_status)==null?void 0:x.color)||"#6c757d"}},((w=a==null?void 0:a.manage_status)==null?void 0:w.name)||"Sin estado")),e.createElement("hr",null),e.createElement("h4",null,"Datos del contacto"),e.createElement("h5",{className:"font-600 mb-0"},"Correo electronico"),e.createElement("p",{className:"mb-2 text-truncate"}," ",a==null?void 0:a.contact_email," "),e.createElement("h5",{className:"font-600 mb-0"},"Tefono / Celular"),e.createElement("p",{className:"mb-2"}," ",a==null?void 0:a.contact_phone," "),e.createElement("h5",{className:"font-600 mb-0"},"Mensaje"),e.createElement("p",{className:"mb-2"}," ",a==null?void 0:a.message," "),e.createElement("h5",{className:"font-600 mb-0"},"Fecha de registro"),e.createElement("p",{className:"mb-2"},moment(a==null?void 0:a.created_at).format("LL"),e.createElement("br",null),e.createElement("small",{className:"text-muted"},moment(a==null?void 0:a.created_at).format("LTS"))),e.createElement("hr",null),e.createElement("h4",null,"Datos de la empresa"),e.createElement("h5",{className:"font-600 mb-0"},"Nombre comercial"),e.createElement("p",{className:"mb-2"}," ",(a==null?void 0:a.tradename)??e.createElement("i",{className:"text-muted"},"No especifica")," "),e.createElement("h5",{className:"font-600 mb-0"},"RUC"),e.createElement("p",{className:"mb-2"}," ",(a==null?void 0:a.ruc)??e.createElement("i",{className:"text-muted"},"No especifica")," "),e.createElement("h5",{className:"font-600 mb-0"},"NÂ° trabajadores"),e.createElement("p",{className:"mb-2"}," ",(a==null?void 0:a.workers)??e.createElement("i",{className:"text-muted"},"No especifica")," ")),e.createElement("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"card card-body"},e.createElement("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto"}},e.createElement("li",{key:"note-type-activity",className:"nav-item"},e.createElement("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active"},e.createElement("i",{className:"mdi mdi-clock"})," Actividad")),y.sort((t,s)=>t.order-s.order).map((t,s)=>{if(t.name!="Correos")return e.createElement("li",{key:`note-type-${s}`,className:"nav-item"},e.createElement("a",{href:`#note-type-${t.id}`,"data-name":t.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link"},e.createElement("i",{className:t.icon})," ",t.name))})),e.createElement("div",{className:"tab-content"},e.createElement("div",{key:"tab-note-type-activity",className:"tab-pane active",id:"note-type-activity"},m.sort((t,s)=>s.created_at>t.created_at?1:-1).map((t,s)=>e.createElement(C,{key:`note-${s}`,...t,showOptions:!1,session:v}))),y.sort((t,s)=>t.order-s.order).map((t,s)=>e.createElement("div",{key:`tab-note-type-${s}`,className:"tab-pane",id:`note-type-${t.id}`},e.createElement("h4",{className:"header-title mb-2"},"Lista de ",t.name),m.filter(c=>c.note_type_id==t.id).sort((c,f)=>f.created_at>c.created_at?1:-1).map((c,f)=>e.createElement(C,{key:`note-${f}`,...c,session:v}))))))),e.createElement("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body"},e.createElement("h5",{className:"header-title"},"Lista de tareas"),e.createElement("hr",null),N.length>0?N.sort((t,s)=>t.ends_at>s.ends_at?1:-1).map((t,s)=>e.createElement(J,{key:`task-${s}`,...t})):e.createElement("i",{className:"text-muted"},"- No hay tareas pendientes -")))))))};O((r,n)=>{if(!n.can("clients","root","all","list"))return location.href="/";I(r).render(e.createElement(q,{...n,title:"Archivados"},e.createElement(ce,{...n})))});
