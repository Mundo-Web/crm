var x=Object.defineProperty;var v=(r,t,n)=>t in r?x(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n;var d=(r,t,n)=>(v(r,typeof t!="symbol"?t+"":t,n),n);import{B as N,A as w,i as y,S as A}from"./Adminto-DTaYUp-d.js";import{C,c as D,R as e,r as R,G as _}from"./CreateReactScript-Cr76lECz.js";import{T as i}from"./TippyButton-BLnRwznp.js";import{P as k}from"./ProjectStatusDropdown-D593UwwA.js";import{R as o}from"./ReactAppend-BUdEshxq.js";import{P as S,A as F,N as P,D as B}from"./Assigneds-DnQIzw0F.js";import{T,D as G}from"./DxPanelButton-Clycaf3l.js";import{D as L}from"./DxBox-CyhaKWwR.js";import"./Dropdown-DIxYuucy.js";import"./DropdownItem-Dd6zonp_.js";import"./server.browser-Dt1gYAOJ.js";class U extends N{constructor(){super(...arguments);d(this,"path","archived")}}const m=new U,z=({projectStatuses:r,can:t})=>{const n=R.useRef(),u=async({id:a,status:l})=>{await m.status({id:a,status:l})&&$(n.current).dxDataGrid("instance").refresh()},f=async a=>{const{isConfirmed:l}=await A.fire({title:"Estas seguro de eliminar a esta persona?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!l||!await m.delete(a)||$(n.current).dxDataGrid("instance").refresh()};return e.createElement(e.Fragment,null,e.createElement(T,{gridRef:n,title:"Archivados",rest:m,toolBar:a=>{a.unshift(G({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}))},columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(a,{data:l})=>{o(a,e.createElement("div",{className:"d-flex align-items-center"},e.createElement("b",null,l.contact_name),l.assigned_to&&e.createElement(y,{content:`Atendido por ${l.assigned.name} ${l.assigned.lastname}`},e.createElement("img",{className:"avatar-xs rounded-circle ms-1",src:`//${_.APP_DOMAIN}/api/profile/thumbnail/${l.assigned.relative_id}`,alt:l.assigned.name}))))}},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{caption:"Acciones",width:235,cellTemplate:(a,{data:l})=>{a.attr("style","display: flex; gap: 4px; overflow: visible"),t("clients","root","all","changestatus")&&o(a,e.createElement(i,{className:"btn btn-xs btn-light",title:"Restaurar",onClick:()=>u(l)},e.createElement("i",{className:"fas fa-trash-restore"}))),t("clients","root","all","delete")&&o(a,e.createElement(i,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>f(l.id)},e.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}],masterDetail:{enabled:!1,template:async(a,{data:l,component:c})=>{a.css("padding","10px"),a.css("overflow","visible"),a.css("background-color","#323a46");let{data:p}=await S.paginate({filter:["client_id","=",l.id],isLoadingAll:!0});a.append(L([e.createElement(e.Fragment,null,e.createElement(i,{title:"Cerrar tabla",className:"btn btn-xs btn-soft-danger waves-effect mb-1",onClick:()=>c.collapseAll(-1)},e.createElement("i",{className:"fa fa-times"})),e.createElement("table",{className:"table table-dark table-sm table-bordered mb-0",style:{width:"100%"}},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{scope:"col"},"Tipo"),e.createElement("th",{scope:"col"},"Asignados"),e.createElement("th",{scope:"col"},"Costo"),e.createElement("th",{scope:"col"},"Pagos"),e.createElement("th",{scope:"col"},"Fecha de desarrollo"),e.createElement("th",{scope:"col"},"Estado del proyecto"),e.createElement("th",{scope:"col"},"Acciones"))),e.createElement("tbody",null,p.map(s=>{const g=(s.total_payments/s.cost*100).toFixed(2),b=Number(s.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),E=Number(s.cost-s.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),h=(s.users||"").split("|").filter(Boolean);return e.createElement("tr",{key:`project-${s.id}`},e.createElement("td",{valign:"middle"},s.type.name),e.createElement("td",{valign:"middle"},F(h)),e.createElement("td",{valign:"middle"},`S/. ${P(s.cost)}`),e.createElement("td",{valign:"middle"},e.createElement("p",{className:"mb-0 d-flex justify-content-between"},e.createElement("b",{className:"text-success"},e.createElement("i",{className:"fa fa-arrow-circle-up"})," S/. ",b),e.createElement("b",{className:"float-end text-danger"},e.createElement("i",{className:"fa fa-arrow-circle-down"})," S/. ",E)),e.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"}},e.createElement("div",{className:"progress-bar bg-primary progress-animated wow animated",role:"progressbar","aria-valuenow":s.total_payments,"aria-valuemin":"0","aria-valuemax":s.cost,style:{width:`${g}%`,visibility:"visible",animationName:"animationProgress"}}))),e.createElement("td",{valign:"middle"},B(s.starts_at,s.ends_at)),e.createElement("td",{valign:"middle"},e.createElement(k,{can:t,statuses:r,data:s,onChange:()=>{$(n.current).dxDataGrid("instance").refresh()}})),e.createElement("td",null,t("projects","root","all","assignUsers")&&e.createElement(i,{className:"btn btn-xs btn-soft-info me-1",title:"Asignar usuarios",icon:"fa fa-user-plus",onClick:()=>setProject2Assign(s)},e.createElement("i",{className:"fa fa-user-plus"})),t("projects","root","all","addpayment")&&e.createElement(i,{className:"btn btn-xs btn-soft-success",title:"Ver/Agregar pagos",icon:"fas fa-money-check-alt",onClick:()=>setProjectLoaded(s)},e.createElement("i",{className:"fas fa-money-check-alt"}))))}))))]))}}}))};C((r,t)=>{if(!t.can("clients","root","all","list"))return location.href="/";D(r).render(e.createElement(w,{...t,title:"Archivados"},e.createElement(z,{...t})))});
