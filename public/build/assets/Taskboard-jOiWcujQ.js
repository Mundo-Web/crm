import{C as f,c as y,j as e,r as h}from"./CreateReactScript-DEiMbi6B.js";import{A as j,i as g}from"./Adminto-CkRHJlcB.js";import{P as p,D as N,A as _}from"./DateRange-RDmr98s2.js";import"./Logout-DAQhHADr.js";import"./sweetalert2.esm.all-B5d0Dmk7.js";import"./server.browser-DAhx53FK.js";const w=({})=>{const[o,d]=h.useState([]),[x,b]=h.useState(!1),[l,i]=h.useState("all");h.useEffect(()=>{p.paginate({sort:[{selector:"ends_at",desc:!1}],requireTotalCount:!0,skip:0,take:100}).then(({data:s=[]})=>{d(s)})},[null]);const m=()=>{const s=moment(),t={delayed:[],thisMonth:[],future:{}};return o.forEach(r=>{const a=moment(r.ends_at);if(a.isSame(s,"month")&&a.isSame(s,"year"))t.thisMonth.push(r);else if(a.isBefore(s,"day"))t.delayed.push(r);else{const n=a.format("MMMM YYYY");t.future[n]||(t.future[n]=[]),t.future[n].push(r)}}),t},u=s=>{const t=s??l,r=moment();let a=o;switch(x&&(a=a.filter(n=>Number(n.remaining_amount)>0)),t){case"delayed":return a.filter(n=>moment(n.ends_at).isBefore(r,"day"));case"thisMonth":return a.filter(n=>{const c=moment(n.ends_at);return c.isSame(r,"month")&&c.isSame(r,"year")});default:if(t.startsWith("month_")){const n=t.replace("month_","");return a.filter(c=>moment(c.ends_at).format("MMMM YYYY")===n)}return a}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"dropdown float-end",children:e.jsx(g,{content:"Ver proyectos",arrow:!0,children:e.jsx("a",{href:"/projects",className:"arrow-none card-drop",children:e.jsx("i",{className:"mdi mdi-arrow-top-right"})})})}),e.jsx("h4",{className:"header-title mt-0 mb-0",children:"Proyectos pendientes"}),e.jsxs("div",{className:"mt-2 d-flex gap-1 flex-wrap",children:[m().delayed.length>0&&e.jsxs("button",{className:`btn btn-xs ${l==="delayed"?"btn-danger":"btn-soft-danger"}`,onClick:()=>i("delayed"),children:["Atrasados (",u("delayed").length,")"]}),m().thisMonth.length>0&&e.jsxs("button",{className:`btn btn-xs ${l==="thisMonth"?"btn-primary":"btn-soft-primary"}`,onClick:()=>i("thisMonth"),children:["Este mes (",u("thisMonth").length,")"]}),Object.entries(m().future).map(([s,t])=>e.jsxs("button",{className:`btn btn-xs ${l===`month_${s}`?"btn-success":"btn-soft-success"}`,onClick:()=>i(`month_${s}`),children:[s," (",t.length,")"]},s)),l!=="all"&&e.jsx("button",{className:"btn btn-xs btn-soft-secondary",onClick:()=>i("all"),children:"Mostrar todos"})]})]}),e.jsxs("div",{className:"card-body",style:{height:"calc(100vh - 250px)",overflow:"auto"},children:[e.jsxs("div",{className:"form-check form-switch mb-2 align-content-center",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"showDebtOnly",onChange:s=>b(s.target.checked),style:{cursor:"pointer"}}),e.jsx("label",{className:"form-check-label",htmlFor:"showDebtOnly",style:{cursor:"pointer"},children:"Solo mostrar proyectos con deuda"})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-bordered table-striped mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Fecha de desarrollo"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Debe"}),e.jsx("th",{children:"Asignado a"})]})}),e.jsx("tbody",{children:u().map((s,t)=>{const r=s.users.map(a=>a.relative_id);return e.jsxs("tr",{style:{backgroundColor:s.is_alert?"rgba(255,91,91,.18)":"unset"},children:[e.jsxs("td",{className:`${moment(s.ends_at).isBefore(moment())?"text-danger":""}`,style:{boxShadow:s.is_alert?"unset":""},children:[e.jsx("b",{className:"d-block",children:s.client.tradename}),e.jsx("small",{children:s.name})]}),e.jsx("td",{style:{boxShadow:s.is_alert?"unset":""},children:N(s.starts_at,s.ends_at)}),e.jsx("td",{style:{boxShadow:s.is_alert?"unset":""},children:e.jsx("span",{className:"badge",style:{backgroundColor:s.status.color},children:s.status.name})}),e.jsx("td",{style:{boxShadow:s.is_alert?"unset":""},children:s.remaining_amount>0?e.jsx("b",{className:"text-danger",children:"Debe"}):"No debe"}),e.jsx("td",{style:{boxShadow:s.is_alert?"unset":""},children:_(r)})]},`project-${t}`)})})]})})]})]})})})})};f((o,d)=>{y(o).render(e.jsx(j,{...d,title:"Cuadro de control",children:e.jsx(w,{...d})}))});
