var Y=Object.defineProperty;var B=(o,n,s)=>n in o?Y(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s;var p=(o,n,s)=>B(o,typeof n!="symbol"?n+"":n,s);import{m as V,C as K,c as j,R as e,r as c,G as h}from"./CreateReactScript-CiSpie-0.js";import{A as J}from"./Adminto-B_6p9P5E.js";import{S as O}from"./SelectFormGroup-Det6IJus.js";import{r as X}from"./server.browser-DwjXelOo.js";import{N as d}from"./Number2Currency-e57Tgsuk.js";class v{}p(v,"kpi",async n=>{const{result:s}=await V.Fetch(`/api/dashboard/leads/kpi/${n}`);return{data:(s==null?void 0:s.data)??[],summary:(s==null?void 0:s.summary)??{}}});const z=({months:o=[],currentMonth:n,currentYear:s,leadSources:r,originCounts:D})=>{const[u,N]=c.useState(`${s}-${n}`),[f,b]=c.useState([]),[y,x]=c.useState([]),[S,w]=c.useState(0),[C,_]=c.useState(0),[k,M]=c.useState(0),[A,P]=c.useState(0),[q,R]=c.useState(0),[I,F]=c.useState(0),[G,T]=c.useState(0),[W,L]=c.useState(0),E=({id:t,text:a,element:l})=>{if(!t)return a;const m=$(l).data("option");return $(X(e.createElement("div",null,e.createElement("b",{className:"d-block"},a),e.createElement("small",null,e.createElement("i",{className:"me-1 fa fa-users"}),m.quantity," entradas"))))};c.useEffect(()=>{v.kpi(u).then(({data:t,summary:a})=>{x(t),b(a.grouped??[]),w(a.totalCount??0),_(a.clientsCount??0),M(a.archivedCount??0),P(a.managingCount??0),R(a.totalSum??0),F(a.clientsSum??0),T(a.archivedSum??0),L(a.managingSum??0)})},[u]),c.useEffect(()=>{const t=document.getElementById("leadsStatusPie");let a;return t&&(window.leadsStatusChart&&window.leadsStatusChart.destroy(),a=new Chart(t,{type:"pie",data:{labels:[h.APP_NAME,"WhatsApp","IntegraciÃ³n"],datasets:[{data:[r.crm_count,r.whatsapp_count,r.integration_count],backgroundColor:["#f1556c","#1abc9c","#4a81d4"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),window.leadsStatusChart=a),()=>{window.leadsStatusChart&&window.leadsStatusChart.destroy()}},[null]),c.useEffect(()=>{$('[data-plugin="knob"]').knob({draw:function(){const t=this.$.attr("data-count");$(this.i).val(t)}})});const i=r.crm_count+r.whatsapp_count+r.integration_count;return e.createElement(e.Fragment,null,e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2"},e.createElement(O,{minimumResultsForSearch:-1,templateResult:E,templateSelection:E,onChange:t=>N(t.target.value)},o.map((t,a)=>{const l=moment({month:t.month-1,year:t.year});return e.createElement("option",{key:a,value:t.id,"data-option":JSON.stringify(t)},l.format("MMMM YYYY").toTitleCase())})))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-md-4"},e.createElement("div",{className:"card card-body"},e.createElement("div",{style:{height:"180px"}},e.createElement("canvas",{id:"leadsStatusPie",width:"100%",height:"100%"})),e.createElement("h4",{className:"mt-3 mb-2 text-center"},"Ingreso de leads"),e.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-evenly"},e.createElement("div",{className:"text-center"},e.createElement("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-fgcolor":"#f1556c","data-bgcolor":"#f1556c33",defaultValue:r.crm_count/i*100,"data-count":r.crm_count,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.createElement("small",{className:"text-muted d-block text-center"},h.APP_NAME)),e.createElement("div",{className:"text-center"},e.createElement("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-fgcolor":"#1abc9c","data-bgcolor":"#1abc9c33",defaultValue:r.whatsapp_count/i*100,"data-count":r.whatsapp_count,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.createElement("small",{className:"text-muted d-block text-center"},"WhatsApp")),e.createElement("div",{className:"text-center"},e.createElement("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-fgcolor":"#4a81d4","data-bgcolor":"#4a81d433",defaultValue:r.integration_count/i*100,"data-count":r.integration_count,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.createElement("small",{className:"text-muted d-block text-center"},"Integracion"))))),e.createElement("div",{className:"col-md-8"},e.createElement("div",{className:"row"},e.createElement("div",{className:"col-md-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h1",{className:"fw-normal text-info","data-plugin":"counterup"},S),e.createElement("h4",null,"Leads"),e.createElement("span",null,"S/. ",d(q)))))),e.createElement("div",{className:"col-md-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h1",{className:"fw-normal text-success","data-plugin":"counterup"},C),e.createElement("h4",null,"Convertidos"),e.createElement("span",null,"S/. ",d(I)))))),e.createElement("div",{className:"col-md-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h1",{className:"fw-normal text-danger","data-plugin":"counterup"},k),e.createElement("h4",null,"No convertidos"),e.createElement("span",null,"S/. ",d(G)))))),e.createElement("div",{className:"col-md-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h1",{className:"fw-normal text-primary","data-plugin":"counterup"},A),e.createElement("h4",null,"En gestion"),e.createElement("span",null,"S/. ",d(W))))))))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xl-9 col-md-12"},e.createElement("div",{className:"d-flex gap-3 mb-3",style:{overflowX:"auto"}},f.map((t,a)=>e.createElement("div",{key:a,className:"card",style:{minWidth:"270px",maxWidth:"270px"}},e.createElement("div",{className:"card-header"},e.createElement("div",{className:"float-end"},e.createElement("b",null,t.quantity)),e.createElement("h4",{className:"header-title my-0 text-truncate",style:{color:t.color}},t.name)),e.createElement("div",{className:"card-body"},e.createElement("div",{className:"d-flex gap-3 flex-column"},y.filter(({status_id:l})=>l==t.id).sort((l,m)=>m.quantity-l.quantity).map((l,m)=>{const g=(l.quantity/t.quantity*100).toFixed(2);return e.createElement("div",{key:m},e.createElement("h5",{className:"my-0"},l.manage_status_name," ",e.createElement("span",{className:"float-end",style:{color:l.manage_status_color}},l.quantity)),e.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0",style:{backgroundColor:`${l.manage_status_color}44`}},e.createElement("div",{className:"progress-bar progress-animated wow animated animated",role:"progressbar","aria-valuenow":g,"aria-valuemin":"0","aria-valuemax":"100",style:{width:`${g}%`,visibility:"visible",animationName:"animationProgress",backgroundColor:l.manage_status_color}})))})))))))))};K((o,n)=>{j(o).render(e.createElement(J,{...n,title:"KPI - Leads"},e.createElement(z,{...n})))});
