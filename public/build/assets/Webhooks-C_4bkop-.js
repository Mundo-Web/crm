var k=Object.defineProperty;var v=(a,s,i)=>s in a?k(a,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[s]=i;var b=(a,s,i)=>v(a,typeof s!="symbol"?s+"":s,i);import{C as f,c as C,j as e,r as u,G as d,m as _}from"./CreateReactScript-DSh221L4.js";import{B as w,A as R,S as c}from"./Adminto-DyaMsHFH.js";class A extends w{constructor(){super(...arguments);b(this,"path","integrations")}}const y=new A,x={messenger:"mdi-facebook-messenger",instagram:"mdi-instagram"},L=({apikey:a,auth_token:s,integrations:i})=>{const[p,N]=u.useState(i);u.useEffect(()=>{},[null]);const m=r=>{_.Clipboard.copy(r,()=>{c.fire({title:"Correcto!",text:"Se ha copiado el contenido al portapapeles",timer:2e3})},n=>{c.fire({title:"Ooops!",text:error,timer:2e3})})},g=async r=>{(await c.fire({title:`Ingrese el Token de ${r.meta_business_id}`,input:"text",inputLabel:"Access Token",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!c.isLoading(),preConfirm:async l=>{if(!l)return c.showValidationMessage("Debe ingresar un access token"),!1;try{const t=await y.save({id:r.id,meta_access_token:l});if(!t)throw new Error("No se pudo guardar el token");return N(h=>h.map(o=>o.id===t.id?t:o)),!0}catch(t){return c.showValidationMessage(t.message),!1}}})).isConfirmed&&await c.fire({title:"Éxito",text:"Token guardado correctamente",icon:"success",timer:2e3})},j=p.reduce((r,n)=>(r[n.meta_service]||(r[n.meta_service]=[]),r[n.meta_service].push(n),r),{});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-4 col-md-6 col-sm-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"header-title mb-0",children:"Conecta servicios de Meta con Atalaya"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"sub-header",children:"Aquí encontrarás las URLs de webhook necesarias para integrar tu aplicación con los servicios de Meta (Messenger e Instagram). Estas URLs te permitirán recibir actualizaciones en tiempo real."}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h5",{children:[e.jsx("i",{className:`mdi ${x.messenger} me-1`}),"Webhook Messenger:"]}),e.jsxs("div",{children:[e.jsxs("code",{className:"d-block mb-1",children:[d.APP_URL,"/meta/messenger/",a]}),e.jsxs("button",{className:"btn btn-xs btn-dark",onClick:()=>m(`${d.APP_URL}/meta/messenger/${a}`),children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar enlace"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h5",{children:[e.jsx("i",{className:`mdi ${x.instagram} me-1`}),"Webhook Instagram:"]}),e.jsxs("div",{children:[e.jsxs("code",{className:"d-block mb-1",children:[d.APP_URL,"/meta/instagram/",a]}),e.jsxs("button",{className:"btn btn-xs btn-dark",onClick:()=>m(`${d.APP_URL}/meta/instagram/${a}`),children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar enlace"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{children:"Token de Verificación:"}),e.jsxs("div",{children:[e.jsx("code",{className:"d-block mb-1",children:s}),e.jsxs("button",{className:"btn btn-xs btn-dark",onClick:()=>m(s),children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar token"]})]})]}),e.jsxs("p",{className:"sub-header",children:[e.jsx("b",{children:"Importante"}),": Mantén estas URLs y el token de verificación en un lugar seguro. No los compartas con personas no autorizadas para evitar accesos no deseados a tu sistema."]})]})]})}),e.jsx("div",{className:"col-lg-8 col-md-6 col-sm-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"header-title my-0",children:"Integraciones"})}),e.jsx("div",{className:"card-body",children:Object.keys(j).map((r,n)=>{const l=j[r];return console.log(l),e.jsxs(e.Fragment,{children:[e.jsxs("h5",{className:"header-title mt-0",children:[e.jsx("i",{className:`mdi ${x[r]} me-1`}),r.toTitleCase()]}),e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Cuenta"}),e.jsx("th",{children:"Leads"}),e.jsx("th",{children:"Estado"})]})}),e.jsx("tbody",{children:l.map((t,h)=>e.jsxs("tr",{children:[e.jsx("td",{className:"w-100",children:e.jsxs("div",{className:"d-flex gap-1 align-items-center",children:[e.jsx("img",{className:"avatar-sm rounded-circle",src:`/api/integrations/media/${t.meta_business_profile}`,alt:t.meta_business_name??"Desconocido",style:{objectFit:"cover",objectPosition:"center"},onError:o=>o.target.src=`//${d.APP_DOMAIN}/api/logo/thumbnail/null`}),e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:t.meta_business_name??"Desconocido"}),e.jsx("small",{className:"text-muted",children:t.meta_business_id})]})]})}),e.jsx("td",{children:t.meta_leads??0}),e.jsx("td",{children:t.meta_business_name?e.jsx("span",{children:"Activo"}):e.jsx("button",{className:"btn btn-xs btn-dark text-nowrap",onClick:()=>g(t),children:"Agregar Token"})})]},h))})]})]})})})]})})]})})};f((a,s)=>{C(a).render(e.jsx(R,{...s,title:"Webhooks",children:e.jsx(L,{...s})}))});
