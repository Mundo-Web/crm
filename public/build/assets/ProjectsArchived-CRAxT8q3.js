var d=Object.defineProperty;var p=(r,a,o)=>a in r?d(r,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[a]=o;var n=(r,a,o)=>p(r,typeof a!="symbol"?a+"":a,o);import{C as f,c as u,R as s,r as y,m as b}from"./CreateReactScript-Dcnwm1IN.js";import{B as g,A as x}from"./Adminto-BIdJUGeV.js";import{N as h}from"./Number2Currency-e57Tgsuk.js";import{T as F,D as v}from"./DxPanelButton-BUlFeEYR.js";import{D as E}from"./DxButton-CsjWvhyj.js";import{D as i}from"./DxBox-JwuIcuYO.js";import{D as T}from"./DateRange-B3LwLtuv.js";import{A as w,P as N}from"./Assigneds-TGLiKae2.js";import{R as _}from"./ReactAppend-CKDNlHXC.js";import"./server.browser-CSCYH58z.js";class D extends g{constructor(){super(...arguments);n(this,"path","projects/archived")}}const R=new D,A=({can:r})=>{const a=y.useRef(),o=async({id:t,status:e})=>{await N.status({id:t,status:e})&&$(a.current).dxDataGrid("instance").refresh()};return s.createElement(s.Fragment,null,s.createElement(F,{gridRef:a,title:"Proyectos Archivados",rest:R,exportable:!0,toolBar:t=>{t.unshift(v({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(a.current).dxDataGrid("instance").refresh()}))},filterValue:void 0,columns:[{dataField:"client.tradename",caption:"Nombre comercial",filterValue:b.GET.client||void 0,fixed:!0,fixedPosition:"left"},{dataField:"type.name",caption:"Tipo",visible:!1},{dataField:"name",caption:"Proyecto"},{dataField:"users",caption:"Asignados",dataType:"string",cellTemplate:(t,{data:e})=>{const l=(e.users||"").split("|").filter(Boolean);t.append(i([w(l)]))},visible:!1,allowExporting:!1},r("projects","root","all","addpayment")&&{dataField:"cost",caption:"Costo total",dataType:"number",cellTemplate:(t,{data:e})=>{t.text(`S/. ${h(e.cost)}`)}},r("projects","root","all","addpayment")&&{dataField:"remaining_amount",caption:"Debe",dataType:"number",cellTemplate:(t,{data:e})=>{const l=(e.total_payments/e.cost*100).toFixed(2),c=Number(e.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),m=Number(e.cost-e.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2});t.append(i([s.createElement(s.Fragment,null,s.createElement("p",{className:"mb-0 d-flex justify-content-between"},s.createElement("b",{className:"text-success"},s.createElement("i",{className:"fa fa-arrow-circle-up"})," S/. ",c),s.createElement("b",{className:"float-end text-danger"},s.createElement("i",{className:"fa fa-arrow-circle-down"})," S/. ",m)),s.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"}},s.createElement("div",{className:"progress-bar bg-primary progress-animated wow animated animated animated",role:"progressbar","aria-valuenow":e.total_payments,"aria-valuemin":"0","aria-valuemax":e.cost,style:{width:`${l}%`,visibility:"visible",animationName:"animationProgress"}})))],!1))},allowExporting:!1},{dataField:"starts_at",caption:"Fecha inicio proyecto",dataType:"date",format:"yyyy-MM-dd",cellTemplate:(t,{data:e})=>{t.text(moment(e.starts_at).format("LL"))}},{dataField:"ends_at",caption:"Fecha fin proyecto",dataType:"date",format:"yyyy-MM-dd",cellTemplate:(t,{data:e})=>{t.append(i([{width:"200px",height:"30px",children:T(e.starts_at,e.ends_at)}]))},sortOrder:"asc"},{dataField:"last_payment_date",caption:"Fecha ultimo pago",dataType:"datetime",format:"yyyy-MM-dd HH:mm:ss",cellTemplate:(t,{data:e})=>{if(!e.last_payment_date)return t.html('<i class="text-muted">- No hay pagos -</i>');t.text(moment(e.last_payment_date).format("LLL"))}},r("projects","root","all","changestatus")?{dataField:"status.name",caption:"Estado del proyecto",dataType:"string",cellTemplate:(t,{data:e})=>{t.attr("style","overflow: visible"),_(t,s.createElement("button",{className:"btn btn-xs btn-light rounded-pill",disabled:!0},s.createElement("i",{class:"fa fa-circle me-1",style:{color:e.status.color}}),e.status.name))}}:null,{caption:"Acciones",cellTemplate:(t,{data:e})=>{r("projects","root","all","delete")&&t.append(E({className:"btn btn-xs btn-soft-dark",title:"Restaurar",icon:"fas fa-trash-restore",onClick:()=>o(e)}))},allowFiltering:!1,allowExporting:!1}]}))};f((r,a)=>{if(!a.can("projects","root","all","list"))return location.href="/";u(r).render(s.createElement(x,{...a,title:"Proyectos archivados"},s.createElement(A,{...a})))});
