var T=Object.defineProperty;var U=(i,r,o)=>r in i?T(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o;var y=(i,r,o)=>U(i,typeof r!="symbol"?r+"":r,o);import{r as c,j as t,G as N,m}from"./CreateReactScript-9UX3kXBD.js";import{B as W,i as w}from"./Adminto-D2EAo1Ce.js";import{S as O}from"./sweetalert2.esm.all-CVcmmqxW.js";import{M as K}from"./Modal-B8D5VKtw.js";import{I as S}from"./InputFormGroup-DwkqbD4D.js";class X extends W{constructor(){super(...arguments);y(this,"path","repository");y(this,"hasFiles",!0)}}const p=new X,Z=100*1024*1024,H=i=>i.startsWith("image/")?"mdi-image":i.startsWith("video/")?"mdi-video":i.startsWith("audio/")?"mdi-music":i.includes("pdf")?"mdi-file-pdf":i.includes("word")?"mdi-file-word":i.includes("sheet")?"mdi-file-excel":"mdi-file",J=i=>{if(i===0)return"0 Bytes";const r=1024,o=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(i)/Math.log(r));return parseFloat((i/Math.pow(r,d)).toFixed(2))+" "+o[d]},ae=({files:i,height:r="calc(100vh - 240px)",selectable:o,multiple:d=!0,selectedFiles:M=[],setSelectedFiles:f=()=>{}})=>{const x=c.useRef(),h=c.useRef(),g=c.useRef(),j=c.useRef(),R=c.useRef(),[k,v]=c.useState(!1),[D,C]=c.useState(!1),[b,u]=c.useState(i||[]),E=e=>{e.preventDefault(),e.stopPropagation(),v(!0)},B=e=>{e.preventDefault(),e.stopPropagation(),v(!1)},_=async e=>{e.preventDefault(),e.stopPropagation(),v(!1);const s=Array.from(e.dataTransfer.files);F(s)},P=e=>{const s=Array.from(e.target.files);F(s),h.current.value=null},F=async e=>{C(!0);for(const s of e){if(s.size>Z){m.Notify.add({title:"Error",type:"danger",body:`El archivo ${s.name} excede el límite de 40MB`,icon:"/assets/img/icon.svg"});continue}const n=new FormData;n.append("name",s.name),n.append("file",s);try{const a=await p.save(n,!1);a&&(u(l=>[...l,a]),m.Notify.add({title:"Operación correcta",body:`Archivo ${s.name} subido correctamente`,icon:"/assets/img/icon.svg"}))}catch{m.Notify.add({title:"Error",type:"danger",body:`Error al subir ${s.name}`,icon:"/assets/img/icon.svg"})}}C(!1)},A=e=>{g.current.value=e.id,R.current.value=e.name,j.current.value=e.name,$(x.current).modal("show")},I=async e=>{e.preventDefault();const s=new FormData;s.append("id",g.current.value),s.append("name",j.current.value);const n=await p.save(s);n&&(u(a=>a.map(l=>l.id===n.id?n:l)),$(x.current).modal("hide"))},L=({name:e,file:s})=>{const n=`${N.APP_URL}/cloud/${s}`;m.Clipboard.copy(n,()=>{m.Notify.add({title:"Enlace copiado",body:`El enlace al archivo ${e} ha sido copiado al portapapeles`,icon:"/assets/img/icon.svg"})})},z=async e=>{const{isConfirmed:s}=await O.fire({title:"¿Estás seguro?",text:"¿Estás seguro de que deseas eliminar este archivo?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!s||!await p.delete(e)||u(a=>a.filter(l=>l.id!==e))},q=async()=>{const e=await p.paginate({isLoadingAll:!0});e&&u(e.data)};c.useEffect(()=>{b.length==0&&q()},[null]);const G=(e,s)=>{const n=e.target.checked;if(!d)return f([s]);f(n?a=>[...a,s]:a=>a.filter(l=>l.id!==s.id))};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`${k?"dragging":""}`,onDragEnter:E,onDragOver:E,onDragLeave:B,onDrop:_,children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("input",{type:"file",ref:h,className:"d-none",multiple:!0,onChange:P}),t.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>h.current.click(),disabled:D,type:"button",children:D?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Subiendo..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"mdi mdi-upload me-1"}),"Subir archivos"]})})]}),t.jsx("div",{className:"repository-dropzone",style:{height:r,userSelect:"none"},children:k?t.jsxs("div",{className:"drop-overlay",children:[t.jsx("i",{className:"mdi mdi-cloud-upload mdi-48px mb-2"}),t.jsx("h4",{children:"Suelta los archivos aquí"})]}):b.length>0?t.jsx("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-2",children:b.map((e,s)=>{const n=M.find(a=>a.id===e.id);return t.jsxs("div",{className:"card my-0",style:{width:"140px",height:"max-content",boxShadow:"5px 5px 10px rgba(0, 0, 0, 0.2)"},children:[t.jsxs("label",{href:`${N.APP_URL}/cloud/${e.file}`,className:"rounded position-relative w-100 bg-dark d-flex align-items-center justify-content-center text-white cursor-pointer",style:{aspectRatio:5/3},onClick:()=>{if(!o){const a=document.createElement("a");a.href=`${N.APP_URL}/cloud/${e.file}`,a.target="_blank",a.click(),a.remove()}},children:[o&&t.jsx("input",{name:"input-file-selectable",type:d?"checkbox":"radio",className:"position-absolute form-check-input m-0",style:{top:"6px",left:"6px"},checked:!!n,onChange:a=>G(a,e)}),e.file_mimetype.startsWith("image/")&&e.file_mimetype!=="image/svg+xml"?t.jsx("img",{className:"rounded img-fluid w-100 h-100",src:`/cloud/${e.file}`,alt:e.name,style:{objectFit:"cover",objectPosition:"center",aspectRatio:5/3}}):t.jsx("i",{className:`mdi ${H(e.file_mimetype)} mdi-36px`})]}),t.jsxs("div",{className:"card-body p-1",children:[t.jsx("small",{className:"d-block text-truncate w-100 my-0",title:e.name,children:t.jsx("b",{children:e.name})}),t.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center",children:[t.jsx("small",{className:"card-text",children:J(e.file_size)}),!o&&t.jsxs("div",{className:"d-flex gap-1",children:[t.jsx(w,{content:"Copiar enlace",children:t.jsx("i",{className:"mdi mdi-link cursor-pointer",onClick:()=>L(e)})}),t.jsx(w,{content:"Cambiar nombre",children:t.jsx("i",{className:"mdi mdi-pencil cursor-pointer",onClick:()=>A(e)})}),t.jsx(w,{content:"Eliminar",children:t.jsx("i",{className:"mdi mdi-delete cursor-pointer text-danger",onClick:()=>z(e.id)})})]})]})]})]},s)})}):t.jsxs("div",{className:"text-center p-5",children:[t.jsx("i",{className:"mdi mdi-folder-multiple-outline mdi-48px mb-2"}),t.jsx("h4",{children:"Arrastra archivos aquí o usa el botón de subir"}),t.jsx("small",{className:"text-muted",children:"Tamaño máximo por archivo: 40MB"})]})})]}),t.jsxs(K,{modalRef:x,title:"Modificar nombre",onSubmit:I,zIndex:1070,children:[t.jsx("input",{ref:g,type:"hidden"}),t.jsx(S,{eRef:R,label:"Nombre anterior",disabled:!0}),t.jsx(S,{eRef:j,label:"Nombre nuevo",required:!0})]})]})};export{ae as R,X as a};
