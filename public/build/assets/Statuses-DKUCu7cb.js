import{C as k,c as I,j as r,r as n}from"./CreateReactScript-BFvya1e4.js";import{a as _,S as A}from"./SetSelectValue-CkQP9EqG.js";import{S as F}from"./StatusesRest-DKPYm4pM.js";import{A as G}from"./Adminto-Be2idleq.js";import{M as T}from"./Modal-iCuGrA8v.js";import{I as v}from"./InputFormGroup-C8S7uBe5.js";import{T as B}from"./TextareaFormGroup-CyGfTpf_.js";import{S as M}from"./sweetalert2.esm.all-DdfLDKBM.js";import{C as z}from"./CheckboxFormGroup-C9IgRXCx.js";import"./Logout-DJpgKGyv.js";const y=new F,D=({statuses:c,tables:i})=>{const[N,u]=n.useState(c);n.useRef();const a=n.useRef(),d=n.useRef(),l=n.useRef(),m=n.useRef(),p=n.useRef(),f=n.useRef(),x=n.useRef(),w=n.useRef(),[S,R]=n.useState(!1),[h,g]=n.useState(!1),j=e=>{var o,s,t;e!=null&&e.id?R(!0):R(!1),d.current.value=(e==null?void 0:e.id)||null,A(l.current,(o=e==null?void 0:e.table)==null?void 0:o.id,(s=e==null?void 0:e.table)==null?void 0:s.name),(t=e==null?void 0:e.table)!=null&&t.id?$(l.current).parents(".form-group").hide():$(l.current).parents(".form-group").show(),m.current.value=(e==null?void 0:e.name)||null,p.current.value=(e==null?void 0:e.color)||"#343a40",f.current.value=(e==null?void 0:e.order)||"",x.current.value=(e==null?void 0:e.description)||null,g((e==null?void 0:e.require)||!1),$(a.current).modal("show")},C=async e=>{e.preventDefault();const o={id:d.current.value||void 0,table_id:l.current.value,name:m.current.value,color:p.current.value,order:f.current.value,description:x.current.value,require:h,action_required:h?"product":null},s=await y.save(o);s&&(N.find(t=>t.id==s.id)?u(t=>{const b=t.findIndex(E=>E.id==s.id);return t[b]=s,[...t]}):u(t=>[...t,s]),$(a.current).modal("hide"))},q=async e=>{const{isConfirmed:o}=await M.fire({title:"Estas seguro de eliminar este estado?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!o||!await y.delete(e)||u(t=>[...t.filter(b=>b.id!=e)])};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"container",children:[r.jsx("div",{className:"text-center",children:r.jsx("button",{className:"btn btn-primary mb-4 rounded-pill",onClick:()=>j(),children:"Nuevo Estado"})}),r.jsx("div",{className:"row align-items-start justify-content-center",children:i.map((e,o)=>r.jsx("div",{className:"col-md-6",children:r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[r.jsxs("h5",{className:"my-0 text-capitalize",children:["Estados de ",e.name]}),r.jsx("button",{className:"btn btn-xs btn-primary rounded-pill",onClick:()=>j({table:e}),children:"Nuevo estado"})]})}),r.jsx("div",{className:"card-body d-flex align-items-start justify-content-center gap-2",style:{flexWrap:"wrap",minHeight:"200px"},children:N.filter(s=>s.table_id===e.id).sort((s,t)=>s.order-t.order).map((s,t)=>r.jsxs("div",{className:"btn-group dropup col-auto",children:[r.jsxs("span",{type:"button",className:"btn btn-sm btn-white d-flex gap-2 align-items-center",style:{cursor:"default"},children:[r.jsx("h4",{className:"my-0",children:s.order}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{children:[r.jsx("i",{className:"mdi mdi-circle me-1",style:{color:s.color}}),s.name,s.require&&r.jsx("span",{className:"text-danger ms-1",children:"*"}),r.jsx("span",{className:"badge rounded-pill bg-secondary ms-1",children:s.children_count})]}),r.jsxs("small",{className:"text-muted",style:{fontSize:"10px"},children:["Ult. uso: ",s.last_used_at]})]})]}),r.jsx("button",{type:"button",className:"btn btn-sm btn-white dropdown-toggle","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:r.jsx("i",{className:"mdi mdi-dots-vertical"})}),r.jsxs("div",{className:"dropdown-menu",children:[r.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>j(s),children:"Editar"}),r.jsx("span",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>q(s.id),children:"Eliminar"})]})]},t))})]})},o))})]}),r.jsx(T,{modalRef:a,title:S?"Editar estado":"Agregar estado",onSubmit:C,size:"sm",children:r.jsxs("div",{className:"row",id:"status-crud-container",children:[r.jsx("input",{ref:d,type:"hidden"}),r.jsx(v,{eRef:m,label:"Nombre de estado",col:"col-12",required:!0}),r.jsx(_,{eRef:l,label:"Tabla",col:"col-12",dropdownParent:"#status-crud-container",searchAPI:"/api/tables/paginate",searchBy:"name",required:!0}),r.jsx(v,{eRef:p,type:"color",label:"Color",col:"col-6",required:!0}),r.jsx(v,{eRef:f,type:"number",label:"Orden",col:"col-6",required:!0}),r.jsx(B,{eRef:x,label:"Descripcion",col:"col-12"}),r.jsx("div",{className:"col-12",children:r.jsx(z,{eRef:w,label:"Â¿Requerir producto?",id:"require",title:"Obliga al usuario a escoger un producto antes de cambiar a este estado",checked:h,setChecked:g})})]})})]})};k((c,i)=>{if(!i.can("statuses","root","all","list"))return location.href="/";I(c).render(r.jsx(G,{...i,title:"Gestor de estados",children:r.jsx(D,{...i})}))});
