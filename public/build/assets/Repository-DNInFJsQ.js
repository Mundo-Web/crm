var A=Object.defineProperty;var _=(t,i,r)=>i in t?A(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r;var x=(t,i,r)=>_(t,typeof i!="symbol"?i+"":i,r);import{C as I,c as P,j as e,r as o,G as z,m}from"./CreateReactScript-DiT3hDbE.js";import{B as L,A as q,i as h,S as G}from"./Adminto-De12RiAo.js";import{M as T}from"./Modal-1RPhDEPU.js";import{I as D}from"./InputFormGroup-CbQnIdio.js";class W extends L{constructor(){super(...arguments);x(this,"path","repository");x(this,"hasFiles",!0)}}const g=new W,O=40*1024*1024,U=t=>t.startsWith("image/")?"mdi-image":t.startsWith("video/")?"mdi-video":t.startsWith("audio/")?"mdi-music":t.includes("pdf")?"mdi-file-pdf":t.includes("word")?"mdi-file-word":t.includes("sheet")?"mdi-file-excel":"mdi-file",K=t=>{if(t===0)return"0 Bytes";const i=1024,r=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(t)/Math.log(i));return parseFloat((t/Math.pow(i,c)).toFixed(2))+" "+r[c]},X=({files:t})=>{const i=o.useRef(),r=o.useRef(),c=o.useRef(),u=o.useRef(),j=o.useRef(),[v,p]=o.useState(!1),[b,y]=o.useState(!1),[N,f]=o.useState(t||[]),R=s=>{s.preventDefault(),s.stopPropagation(),p(!0)},F=s=>{s.preventDefault(),s.stopPropagation(),p(!1)},C=async s=>{s.preventDefault(),s.stopPropagation(),p(!1);const a=Array.from(s.dataTransfer.files);w(a)},E=s=>{const a=Array.from(s.target.files);w(a),r.current.value=null},w=async s=>{y(!0);for(const a of s){if(a.size>O){m.Notify.add({title:"Error",type:"danger",body:`El archivo ${a.name} excede el límite de 40MB`,icon:"/assets/img/icon.svg"});continue}const n=new FormData;n.append("name",a.name),n.append("file",a);try{const l=await g.save(n,!1);l&&(f(d=>[...d,l]),m.Notify.add({title:"Operación correcta",body:`Archivo ${a.name} subido correctamente`,icon:"/assets/img/icon.svg"}))}catch{m.Notify.add({title:"Error",type:"danger",body:`Error al subir ${a.name}`,icon:"/assets/img/icon.svg"})}}y(!1)},S=s=>{c.current.value=s.id,j.current.value=s.name,u.current.value=s.name,$(i.current).modal("show")},k=async s=>{s.preventDefault();const a=new FormData;a.append("id",c.current.value),a.append("name",u.current.value);const n=await g.save(a);n&&(f(l=>l.map(d=>d.id===n.id?n:d)),$(i.current).modal("hide"))},M=({name:s,file:a})=>{const n=`${z.APP_URL}/repository/${a}`;m.Clipboard.copy(n,()=>{m.Notify.add({title:"Enlace copiado",body:`El enlace al archivo ${s} ha sido copiado al portapapeles`,icon:"/assets/img/icon.svg"})})},B=async s=>{const{isConfirmed:a}=await G.fire({title:"¿Estás seguro?",text:"¿Estás seguro de que deseas eliminar este archivo?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!a||!await g.delete(s)||f(l=>l.filter(d=>d.id!==s))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`repository-container ${v?"dragging":""}`,onDragEnter:R,onDragOver:R,onDragLeave:F,onDrop:C,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"file",ref:r,className:"d-none",multiple:!0,onChange:E}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>r.current.click(),disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-loading mdi-spin me-1"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-upload me-1"}),"Subir archivos"]})})]}),e.jsx("div",{className:"repository-dropzone",children:v?e.jsxs("div",{className:"drop-overlay",children:[e.jsx("i",{className:"mdi mdi-cloud-upload mdi-48px mb-2"}),e.jsx("h4",{children:"Suelta los archivos aquí"})]}):N.length>0?e.jsx("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-2",children:N.map((s,a)=>e.jsxs("div",{className:"card my-0",style:{width:"140px",height:"max-content",boxShadow:"5px 5px 10px rgba(0, 0, 0, 0.2)"},children:[e.jsx("div",{className:"rounded w-100 bg-dark d-flex align-items-center justify-content-center",style:{aspectRatio:5/3},children:s.file_mimetype.startsWith("image/")&&s.file_mimetype!=="image/svg+xml"?e.jsx("img",{className:"rounded img-fluid w-100 h-100",src:`/repository/${s.file}`,alt:s.name,style:{objectFit:"cover",objectPosition:"center",aspectRatio:5/3}}):e.jsx("i",{className:`mdi ${U(s.file_mimetype)} mdi-36px`})}),e.jsxs("div",{className:"card-body p-1",children:[e.jsx("small",{className:"d-block text-truncate w-100 my-0",title:s.name,children:e.jsx("b",{children:s.name})}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center",children:[e.jsx("small",{className:"card-text",children:K(s.file_size)}),e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(h,{content:"Copiar enlace",children:e.jsx("i",{className:"mdi mdi-link cursor-pointer",onClick:()=>M(s)})}),e.jsx(h,{content:"Cambiar nombre",children:e.jsx("i",{className:"mdi mdi-pencil cursor-pointer",onClick:()=>S(s)})}),e.jsx(h,{content:"Eliminar",children:e.jsx("i",{className:"mdi mdi-delete cursor-pointer text-danger",onClick:()=>B(s.id)})})]})]})]})]},a))}):e.jsxs("div",{className:"text-center p-5",children:[e.jsx("i",{className:"mdi mdi-folder-multiple-outline mdi-48px mb-2"}),e.jsx("h4",{children:"Arrastra archivos aquí o usa el botón de subir"}),e.jsx("small",{className:"text-muted",children:"Tamaño máximo por archivo: 40MB"})]})})]}),e.jsxs(T,{modalRef:i,title:"Modificar nombre",onSubmit:k,children:[e.jsx("input",{ref:c,type:"hidden"}),e.jsx(D,{eRef:j,label:"Nombre anterior",disabled:!0}),e.jsx(D,{eRef:u,label:"Nombre nuevo",required:!0})]})]})};I((t,i)=>{P(t).render(e.jsx(q,{...i,title:"Repositorio",children:e.jsx(X,{...i})}))});
