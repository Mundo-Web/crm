var B=Object.defineProperty;var G=(r,l,n)=>l in r?B(r,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[l]=n;var p=(r,l,n)=>G(r,typeof l!="symbol"?l+"":l,n);import{m as I,C as L,c as W,R as e,r as c}from"./CreateReactScript-CUi_xX3t.js";import{A as K}from"./Adminto-B-6_ZrxZ.js";import{S as J}from"./SelectFormGroup-CF__6d6w.js";import{r as O}from"./server.browser-BtUM-KVc.js";import{N as o}from"./Number2Currency-e57Tgsuk.js";class N{}p(N,"kpi",async l=>{const{result:n}=await I.Fetch(`/api/dashboard/leads/kpi/${l}`);return{data:(n==null?void 0:n.data)??[],summary:(n==null?void 0:n.summary)??{}}});const X=({months:r=[],currentMonth:l,currentYear:n})=>{const[E,S]=c.useState(`${n}-${l}`),[h,y]=c.useState([]),[f,C]=c.useState([]),[b,x]=c.useState(0),[i,w]=c.useState(0),[d,M]=c.useState(0),[u,_]=c.useState(0),[q,R]=c.useState(0),[k,A]=c.useState(0),[F,P]=c.useState(0),[T,Y]=c.useState(0),g=({id:t,text:a,element:s})=>{if(!t)return a;const m=$(s).data("option");return $(O(e.createElement("div",null,e.createElement("b",{className:"d-block"},a),e.createElement("small",null,e.createElement("i",{className:"me-1 fa fa-users"}),m.quantity," entradas"))))};return c.useEffect(()=>{N.kpi(E).then(({data:t,summary:a})=>{C(t),y(a.grouped??[]),x(a.totalCount??0),w(a.clientsCount??0),M(a.archivedCount??0),_(a.managingCount??0),R(a.totalSum??0),A(a.clientsSum??0),P(a.archivedSum??0),Y(a.managingSum??0)})},[E]),c.useEffect(()=>{const t=document.getElementById("leadsStatusPie");let a;return t&&(window.leadsStatusChart&&window.leadsStatusChart.destroy(),a=new Chart(t,{type:"pie",data:{labels:["Convertidos","No convertidos","En gestiÃ³n"],datasets:[{data:[i,d,u],backgroundColor:["#1abc9c","#f1556c","#4a81d4"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),window.leadsStatusChart=a),()=>{window.leadsStatusChart&&window.leadsStatusChart.destroy()}},[i,d,u]),e.createElement(e.Fragment,null,e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2"},e.createElement(J,{minimumResultsForSearch:-1,templateResult:g,templateSelection:g,onChange:t=>S(t.target.value)},r.map((t,a)=>{const s=moment({month:t.month-1,year:t.year});return e.createElement("option",{key:a,value:t.id,"data-option":JSON.stringify(t)},s.format("MMMM YYYY").toTitleCase())})))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xl-3 col-md-6"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-info","data-plugin":"counterup"},b),e.createElement("h5",null,"Leads"),e.createElement("small",null,"S/. ",o(q)))))),e.createElement("div",{className:"col-xl-3 col-md-6"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-success","data-plugin":"counterup"},i),e.createElement("h5",null,"Convertidos"),e.createElement("small",null,"S/. ",o(k)))))),e.createElement("div",{className:"col-xl-3 col-md-6"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-danger","data-plugin":"counterup"},d),e.createElement("h5",null,"No convertidos"),e.createElement("small",null,"S/. ",o(F)))))),e.createElement("div",{className:"col-xl-3 col-md-6"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-primary","data-plugin":"counterup"},u),e.createElement("h5",null,"En gestion"),e.createElement("small",null,"S/. ",o(T))))))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xl-3 col-md-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body"},e.createElement("canvas",{id:"leadsStatusPie",width:"400",height:"400"})))),e.createElement("div",{className:"col-xl-9 col-md-12"},e.createElement("div",{className:"d-flex gap-1 mb-3",style:{overflowX:"auto"}},h.map((t,a)=>e.createElement("div",{key:a,className:"card",style:{minWidth:"270px",maxWidth:"270px"}},e.createElement("div",{className:"card-header"},e.createElement("div",{className:"float-end"},e.createElement("b",null,t.quantity)),e.createElement("h4",{className:"header-title my-0 text-truncate",style:{color:t.color}},t.name)),e.createElement("div",{className:"card-body"},e.createElement("div",{className:"d-flex gap-3 flex-column"},f.filter(({status_id:s})=>s==t.id).sort((s,m)=>m.quantity-s.quantity).map((s,m)=>{const v=(s.quantity/t.quantity*100).toFixed(2);return e.createElement("div",{key:m},e.createElement("h5",{className:"my-0"},s.manage_status_name," ",e.createElement("span",{className:"float-end",style:{color:s.manage_status_color}},s.quantity)),e.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0",style:{backgroundColor:`${s.manage_status_color}44`}},e.createElement("div",{className:"progress-bar progress-animated wow animated animated",role:"progressbar","aria-valuenow":v,"aria-valuemin":"0","aria-valuemax":"100",style:{width:`${v}%`,visibility:"visible",animationName:"animationProgress",backgroundColor:s.manage_status_color}})))})))))))))};L((r,l)=>{W(r).render(e.createElement(K,{...l,title:"KPI - Leads"},e.createElement(X,{...l})))});
