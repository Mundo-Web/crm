var _=Object.defineProperty;var k=(n,l,c)=>l in n?_(n,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[l]=c;var p=(n,l,c)=>(k(n,typeof l!="symbol"?l+"":l,c),c);import{B as C,A,i as L,S as D}from"./Adminto-CaOFK4Rm.js";import{C as R,c as S,R as e,r as T,G as b}from"./CreateReactScript-DiMSE74L.js";import{M as F}from"./Modal-DIHwUr7I.js";import{T as o}from"./TippyButton-DT6g_1ZR.js";import{P}from"./ProjectStatusDropdown-Dbd1cf3o.js";import{R as d}from"./ReactAppend-BsJVsMpn.js";import{P as B,A as G,N as M,D as U}from"./Assigneds-BAWdPkjS.js";import{T as O,D as z}from"./DxPanelButton-6w4Akznr.js";import{D as I}from"./DxBox-DTge2tdv.js";import{C as N,T as V}from"./ClientNotesCard-DlhWqoKy.js";import"./Dropdown-DHwPfvI7.js";import"./DropdownItem-DL6JiDl9.js";import"./server.browser-BzA2yPSr.js";class W extends C{constructor(){super(...arguments);p(this,"path","archived")}}const E=new W,X=({projectStatuses:n,can:l,noteTypes:c})=>{var u,f;const m=T.useRef(),g=async({id:t,status:a})=>{await E.status({id:t,status:a})&&$(m.current).dxDataGrid("instance").refresh()},h=async t=>{const{isConfirmed:a}=await D.fire({title:"Estas seguro de eliminar a esta persona?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!a||!await E.delete(t)||$(m.current).dxDataGrid("instance").refresh()};return e.createElement(e.Fragment,null,e.createElement(O,{gridRef:m,title:"Archivados",rest:E,toolBar:t=>{t.unshift(z({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}))},columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(t,{data:a})=>{d(t,e.createElement("div",{className:"d-flex align-items-center"},e.createElement("b",null,a.contact_name),a.assigned_to&&e.createElement(L,{content:`Atendido por ${a.assigned.name} ${a.assigned.lastname}`},e.createElement("img",{className:"avatar-xs rounded-circle ms-1",src:`//${b.APP_DOMAIN}/api/profile/thumbnail/${a.assigned.relative_id}`,alt:a.assigned.name}))))}},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{caption:"Acciones",width:235,cellTemplate:(t,{data:a})=>{t.attr("style","display: flex; gap: 4px; overflow: visible"),l("clients","root","all","changestatus")&&d(t,e.createElement(o,{className:"btn btn-xs btn-light",title:"Restaurar",onClick:()=>g(a)},e.createElement("i",{className:"fas fa-trash-restore"}))),l("clients","root","all","delete")&&d(t,e.createElement(o,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>h(a.id)},e.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}],masterDetail:{enabled:!1,template:async(t,{data:a,component:r})=>{t.css("padding","10px"),t.css("overflow","visible"),t.css("background-color","#323a46");let{data:i}=await B.paginate({filter:["client_id","=",a.id],isLoadingAll:!0});t.append(I([e.createElement(e.Fragment,null,e.createElement(o,{title:"Cerrar tabla",className:"btn btn-xs btn-soft-danger waves-effect mb-1",onClick:()=>r.collapseAll(-1)},e.createElement("i",{className:"fa fa-times"})),e.createElement("table",{className:"table table-dark table-sm table-bordered mb-0",style:{width:"100%"}},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{scope:"col"},"Tipo"),e.createElement("th",{scope:"col"},"Asignados"),e.createElement("th",{scope:"col"},"Costo"),e.createElement("th",{scope:"col"},"Pagos"),e.createElement("th",{scope:"col"},"Fecha de desarrollo"),e.createElement("th",{scope:"col"},"Estado del proyecto"),e.createElement("th",{scope:"col"},"Acciones"))),e.createElement("tbody",null,i.map(s=>{const v=(s.total_payments/s.cost*100).toFixed(2),x=Number(s.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),y=Number(s.cost-s.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),w=(s.users||"").split("|").filter(Boolean);return e.createElement("tr",{key:`project-${s.id}`},e.createElement("td",{valign:"middle"},s.type.name),e.createElement("td",{valign:"middle"},G(w)),e.createElement("td",{valign:"middle"},`S/. ${M(s.cost)}`),e.createElement("td",{valign:"middle"},e.createElement("p",{className:"mb-0 d-flex justify-content-between"},e.createElement("b",{className:"text-success"},e.createElement("i",{className:"fa fa-arrow-circle-up"})," S/. ",x),e.createElement("b",{className:"float-end text-danger"},e.createElement("i",{className:"fa fa-arrow-circle-down"})," S/. ",y)),e.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"}},e.createElement("div",{className:"progress-bar bg-primary progress-animated wow animated",role:"progressbar","aria-valuenow":s.total_payments,"aria-valuemin":"0","aria-valuemax":s.cost,style:{width:`${v}%`,visibility:"visible",animationName:"animationProgress"}}))),e.createElement("td",{valign:"middle"},U(s.starts_at,s.ends_at)),e.createElement("td",{valign:"middle"},e.createElement(P,{can:l,statuses:n,data:s,onChange:()=>{$(m.current).dxDataGrid("instance").refresh()}})),e.createElement("td",null,l("projects","root","all","assignUsers")&&e.createElement(o,{className:"btn btn-xs btn-soft-info me-1",title:"Asignar usuarios",icon:"fa fa-user-plus",onClick:()=>setProject2Assign(s)},e.createElement("i",{className:"fa fa-user-plus"})),l("projects","root","all","addpayment")&&e.createElement(o,{className:"btn btn-xs btn-soft-success",title:"Ver/Agregar pagos",icon:"fas fa-money-check-alt",onClick:()=>setProjectLoaded(s)},e.createElement("i",{className:"fas fa-money-check-alt"}))))}))))]))}}}),e.createElement(F,{modalRef:detailModalRef,title:"Detalles del cliente",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:t=>t.preventDefault(),hideFooter:!0},e.createElement("div",{className:"row"},e.createElement("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"d-flex mb-3"},e.createElement("img",{className:"flex-shrink-0 me-3 rounded-circle avatar-md",alt:detailLoaded==null?void 0:detailLoaded.contact_name,src:`//${b.APP_DOMAIN}/api/profile/null`}),e.createElement("div",{className:"flex-grow-1"},e.createElement("h4",{className:"media-heading mt-0"},detailLoaded==null?void 0:detailLoaded.contact_name),e.createElement("span",{className:"badge bg-primary me-1"},(detailLoaded==null?void 0:detailLoaded.contact_position)||"Trabajador")," ",e.createElement("small",{className:"text-muted"},"desde ",e.createElement("b",null,detailLoaded==null?void 0:detailLoaded.origin)))),e.createElement("div",{className:"btn-group mb-0"},e.createElement("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((u=detailLoaded==null?void 0:detailLoaded.manage_status)==null?void 0:u.color)||"#6c757d"}},((f=detailLoaded==null?void 0:detailLoaded.manage_status)==null?void 0:f.name)||"Sin estado")),e.createElement("hr",null),e.createElement("h4",null,"Datos del contacto"),e.createElement("h5",{className:"font-600 mb-0"},"Correo electronico"),e.createElement("p",{className:"mb-2 text-truncate"}," ",detailLoaded==null?void 0:detailLoaded.contact_email," "),e.createElement("h5",{className:"font-600 mb-0"},"Tefono / Celular"),e.createElement("p",{className:"mb-2"}," ",detailLoaded==null?void 0:detailLoaded.contact_phone," "),e.createElement("h5",{className:"font-600 mb-0"},"Mensaje"),e.createElement("p",{className:"mb-2"}," ",detailLoaded==null?void 0:detailLoaded.message," "),e.createElement("h5",{className:"font-600 mb-0"},"Fecha de registro"),e.createElement("p",{className:"mb-2"},moment(detailLoaded==null?void 0:detailLoaded.created_at).format("LL"),e.createElement("br",null),e.createElement("small",{className:"text-muted"},moment(detailLoaded==null?void 0:detailLoaded.created_at).format("LTS"))),e.createElement("hr",null),e.createElement("h4",null,"Datos de la empresa"),e.createElement("h5",{className:"font-600 mb-0"},"Nombre comercial"),e.createElement("p",{className:"mb-2"}," ",(detailLoaded==null?void 0:detailLoaded.tradename)??e.createElement("i",{className:"text-muted"},"No especifica")," "),e.createElement("h5",{className:"font-600 mb-0"},"RUC"),e.createElement("p",{className:"mb-2"}," ",(detailLoaded==null?void 0:detailLoaded.ruc)??e.createElement("i",{className:"text-muted"},"No especifica")," "),e.createElement("h5",{className:"font-600 mb-0"},"NÂ° trabajadores"),e.createElement("p",{className:"mb-2"}," ",(detailLoaded==null?void 0:detailLoaded.workers)??e.createElement("i",{className:"text-muted"},"No especifica")," ")),e.createElement("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"card card-body"},e.createElement("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto"}},e.createElement("li",{key:"note-type-activity",className:"nav-item"},e.createElement("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active"},e.createElement("i",{className:"mdi mdi-clock"})," Actividad")),c.sort((t,a)=>t.order-a.order).map((t,a)=>{if(t.name!="Correos")return e.createElement("li",{key:`note-type-${a}`,className:"nav-item"},e.createElement("a",{href:`#note-type-${t.id}`,"data-name":t.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link"},e.createElement("i",{className:t.icon})," ",t.name))})),e.createElement("div",{className:"tab-content"},e.createElement("div",{key:"tab-note-type-activity",className:"tab-pane active",id:"note-type-activity"},notes.sort((t,a)=>a.created_at>t.created_at?1:-1).map((t,a)=>e.createElement(N,{key:`note-${a}`,...t,showOptions:!1,session}))),c.sort((t,a)=>t.order-a.order).map((t,a)=>e.createElement("div",{key:`tab-note-type-${a}`,className:"tab-pane",id:`note-type-${t.id}`},e.createElement("h4",{className:"header-title mb-2"},"Lista de ",t.name),notes.filter(r=>r.note_type_id==t.id).sort((r,i)=>i.created_at>r.created_at?1:-1).map((r,i)=>e.createElement(N,{key:`note-${i}`,...r,session}))))))),e.createElement("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body"},e.createElement("h5",{className:"header-title"},"Lista de tareas"),e.createElement("hr",null),pendingTasks.length>0?pendingTasks.sort((t,a)=>t.ends_at>a.ends_at?1:-1).map((t,a)=>e.createElement(V,{key:`task-${a}`,...t})):e.createElement("i",{className:"text-muted"},"- No hay tareas pendientes -")))))))};R((n,l)=>{if(!l.can("clients","root","all","list"))return location.href="/";S(n).render(e.createElement(A,{...l,title:"Archivados"},e.createElement(X,{...l})))});
