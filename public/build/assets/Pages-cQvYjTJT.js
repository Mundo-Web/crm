var I=Object.defineProperty;var q=(i,r,o)=>r in i?I(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o;var N=(i,r,o)=>q(i,typeof r!="symbol"?r+"":r,o);import{r as n,j as t,C as U,c as z}from"./CreateReactScript-DzUQzfGT.js";import{R as y}from"./ReactAppend-asa-oFSv.js";import{B as O,A as J,i as k,S as L}from"./Adminto-gT2hg0MO.js";import{M as V}from"./Modal-C-8pRjtx.js";import{T as H,D as P}from"./DxPanelButton-CpOYnvBD.js";import{I as A}from"./InputFormGroup-BKEuQBMN.js";import{T as K}from"./TextareaFormGroup-BR-quq0y.js";import{T as G}from"./TippyButton-Dun35lf2.js";import{S as Q}from"./SelectFormGroup-DH4h48Cm.js";import{r as W}from"./server.browser-BwVmVyxX.js";class X extends O{constructor(){super(...arguments);N(this,"path","pages");N(this,"hasFiles",!0)}}const F=({id:i,col:r,label:o,eRef:a,required:d=!1,onChange:f=()=>{},aspect:g="21/9",fit:x="cover",width:h="100%",height:m,containerStyle:p,onError:u="/api/cover/thumbnail/null"})=>{i||(i=`ck-${crypto.randomUUID()}`),a||(a=n.useRef());const b=n.useRef(),R=async c=>{const v=c.target.files[0],w=await File.toURL(v);b.current.src=w,f(c)};return n.useEffect(()=>{a.image=b.current},[null]),t.jsxs("div",{className:`form-group ${r} mb-1`,style:p,children:[t.jsxs("label",{htmlFor:i,className:"d-block form-label",children:[o," ",d&&t.jsx("b",{className:"text-danger",children:"*"})]}),t.jsx("label",{className:"d-block",htmlFor:i,style:{width:"max-content"},children:t.jsx("img",{ref:b,className:"d-block",src:"",alt:"aspect-video",onError:c=>c.target.src=u,style:{width:h,height:m,borderRadius:"4px",cursor:"pointer",aspectRatio:g,objectFit:x,objectPosition:"center"}})}),t.jsx("input",{ref:a,id:i,type:"file",src:"",alt:"",hidden:!0,accept:"image/*",onChange:R})]})},S=new X,Y=({subdomains:i,subdomain:r,can:o})=>{const a=n.useRef(),d=n.useRef(),f=n.useRef(),g=n.useRef(),x=n.useRef(),h=n.useRef(),m=n.useRef(),p=n.useRef(),u=n.useRef(),[b,R]=n.useState(!1),c=e=>{e!=null&&e.id?R(!0):R(!1),f.current.value=(e==null?void 0:e.id)||null,x.current.value=(e==null?void 0:e.path)||"",g.current.value=(e==null?void 0:e.name)||"",h.current.value=(e==null?void 0:e.description)||"",m.image.src=`/api/pages/media/${e.img_desktop}`,p.image.src=`/api/pages/media/${e.img_tablet}`,u.image.src=`/api/pages/media/${e.img_mobile}`,m.current.value=null,p.current.value=null,u.current.value=null,$(d.current).modal("show")},v=async e=>{var E,_,B;e.preventDefault();const s={id:f.current.value||void 0,path:x.current.value,name:g.current.value,description:h.current.value??void 0},l=new FormData;for(const M in s)l.append(M,s[M]);const j=((E=m.current.files)==null?void 0:E[0])??null,T=((_=p.current.files)==null?void 0:_[0])??null,C=((B=u.current.files)==null?void 0:B[0])??null;j&&l.append("img_desktop",j),T&&l.append("img_tablet",T),C&&l.append("img_mobile",C),await S.save(l)&&($(a.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"))},w=async e=>{const{isConfirmed:s}=await L.fire({title:"Eliminar rol",text:"¿Está seguro de eliminar este rol?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!s||!await S.delete(e)||$(a.current).dxDataGrid("instance").refresh()},D=({id:e,text:s,element:l})=>{if(!e)return s;const j=$(l).data("option");return $(W(t.jsxs("div",{children:[t.jsxs("b",{className:"d-block",children:[s," ",t.jsx("code",{children:j.correlative})]}),t.jsx("small",{className:"d-block text-truncate w-100",children:j.description||"Sin descripción larga larguisima de todos modos larog"})]})))};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2",children:t.jsx(Q,{minimumResultsForSearch:-1,templateResult:D,templateSelection:D,onChange:e=>setSelectedMonth(e.target.value),children:i.map((e,s)=>t.jsx("option",{value:e.correlative,"data-option":JSON.stringify(e),children:e.name},s))})})}),t.jsx(H,{gridRef:a,title:`Páginas - ${r.name}`,rest:S,toolBar:e=>{e.unshift(P({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(a.current).dxDataGrid("instance").refresh()})),o("pages","all","create")&&e.unshift(P({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>c()}))},filterValue:["subdomain_id","=",r.id],columns:[{dataField:"subdomain_id",visible:!1},{dataField:"path",caption:"Ruta"},{dataField:"name",caption:"Nombre"},{dataField:"description",caption:"Descripcion"},{dataField:"images",caption:"Imagenes",allowFiltering:!1,width:"200px",cellTemplate:(e,{data:s})=>{y(e,t.jsxs("div",{className:"d-flex gap-1",children:[t.jsx(k,{content:"Desktop",children:t.jsx("img",{src:`/api/pages/media/${s.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:16/9,objectFit:"cover",objectPosition:"top center"}})}),t.jsx(k,{content:"Tablet",children:t.jsx("img",{src:`/api/pages/media/${s.img_tablet||s.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:4/3,objectFit:"cover",objectPosition:"top center"}})}),t.jsx(k,{content:"Mobile",children:t.jsx("img",{src:`/api/pages/media/${s.img_mobile||s.img_tablet||s.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:9/16,objectFit:"cover",objectPosition:"top center"}})})]}))}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.attr("style","display: flex; gap: 4px; overflow: unset; height: 51px"),y(e,t.jsx(G,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>c(s),children:t.jsx("i",{className:"fa fa-pen"})})),y(e,t.jsx(G,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>w(s.id),children:t.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(V,{modalRef:d,title:b?"Editar página":"Agregar página",onSubmit:v,size:"sm",children:[t.jsx("input",{ref:f,type:"hidden"}),t.jsx(A,{eRef:x,label:"Ruta",col:"col-12",required:!0}),t.jsx(A,{eRef:g,label:"Nombre",col:"col-12",required:!0}),t.jsx(K,{eRef:h,label:"Descripcion",col:"col-12",rows:2}),t.jsxs("div",{className:"d-flex flex-wrap justify-content-start gap-2",children:[t.jsx(F,{eRef:m,label:"Desktop",aspect:16/9,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"}),t.jsx(F,{eRef:p,label:"Tablet",aspect:4/3,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"}),t.jsx(F,{eRef:u,label:"Mobile",aspect:9/16,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"})]})]})]})};U((i,r)=>{z(i).render(t.jsx(J,{...r,title:"Páginas",children:t.jsx(Y,{...r})}))});
