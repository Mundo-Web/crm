var Q=Object.defineProperty;var U=(l,n,r)=>n in l?Q(l,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[n]=r;var A=(l,n,r)=>U(l,typeof n!="symbol"?n+"":n,r);import{B as W,A as X,i as q,S as H}from"./Adminto-DuoVWNzw.js";import{C as J,c as K,R as e,r as o,G as V}from"./CreateReactScript-BzwrR0sZ.js";import{R as D}from"./ReactAppend-CoTY4G2g.js";import{C as Y,P as Z,a as L,b as P,T as ee}from"./ProductsByClientsRest-Bxthq12P.js";import{M as te}from"./Modal-ChNOGOpW.js";import{T as ae,D as se}from"./DxPanelButton-B0o8aYX1.js";import{r as ne}from"./server.browser-CLYKlTOS.js";import{N as B}from"./Number2Currency-e57Tgsuk.js";import{T as F}from"./TippyButton-CZs5jfdH.js";class le extends W{constructor(){super(...arguments);A(this,"path","archived")}}const p=new le,ce=new L,re=new Y,me=new Z,oe=({projectStatuses:l,finishedProjectStatus:n,archived:r,can:g,session:v,noteTypes:x})=>{var y,C,w,k,_,R,S,T;const i=o.useRef(),u=o.useRef(),[t,f]=o.useState(null),[c,E]=o.useState([]),[N,b]=o.useState([]),G=async({id:a,status:s})=>{await p.status({id:a,status:s})&&$(i.current).dxDataGrid("instance").refresh()},j=async a=>{const{isConfirmed:s}=await H.fire({title:"Estas seguro de eliminar a esta persona?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!s||!await p.delete(a)||$(i.current).dxDataGrid("instance").refresh()},M=async a=>{f(a),history.pushState(null,null,`/archived/${a.id}`),E([]),b([]),$(u.current).modal("show")};o.useEffect(()=>{z(),O()},[t]);const z=async()=>{const a=await re.byClient(t==null?void 0:t.id);E(a??[])},O=async()=>{const a=await me.byClient(t==null?void 0:t.id);b(a)};o.useEffect(()=>{$(u.current).on("hidden.bs.modal",()=>{f(null),history.pushState(null,null,"/archived")}),r&&ce.get(r).then(a=>{a&&(f(a),E([]),b([]),$(u.current).modal("show"),GET.annotation&&$(`[data-name="${GET.annotation}"]`).click())})},[null]);const I=[];c==null||c.forEach(a=>I.push(...a.tasks));const h=[];return c==null||c.forEach(a=>h.push(...a.tasks.filter(s=>s.status!="Realizado"))),e.createElement(e.Fragment,null,e.createElement(ae,{gridRef:i,title:"Archivados",rest:p,toolBar:a=>{a.unshift(se({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(i.current).dxDataGrid("instance").refresh()}))},columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(a,{data:s})=>{a.attr("style","height: 48px; cursor: pointer"),a.on("click",()=>M(s)),a.html(ne(e.createElement("b",null,s.contact_name)))},fixed:!0,fixedPosition:"left"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{caption:"Acciones",width:235,cellTemplate:(a,{data:s})=>{a.attr("style","display: flex; gap: 4px; overflow: visible"),g("clients","root","all","changestatus")&&D(a,e.createElement(F,{className:"btn btn-xs btn-light",title:"Restaurar",onClick:()=>G(s)},e.createElement("i",{className:"fas fa-trash-restore"}))),g("clients","root","all","delete")&&D(a,e.createElement(F,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>j(s.id)},e.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),e.createElement(te,{modalRef:u,title:"Detalles del archivado",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:a=>a.preventDefault(),hideFooter:!0},e.createElement("div",{className:"row"},e.createElement("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"d-flex mb-3"},e.createElement("div",{className:"flex-grow-1"},e.createElement("h4",{className:"media-heading mt-0"},t==null?void 0:t.contact_name),e.createElement("span",{className:"badge bg-primary me-1"},(t==null?void 0:t.contact_position)||"Trabajador"),e.createElement("small",{className:"text-muted"},"desde ",e.createElement("b",null,t==null?void 0:t.origin)))),e.createElement("hr",null),e.createElement("h4",null,"Estados"),e.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-2"},e.createElement("div",null,e.createElement("b",{className:"d-block"},"Estado de gestión"),e.createElement("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((y=t==null?void 0:t.status)==null?void 0:y.color)||"#6c757d"}},((C=t==null?void 0:t.status)==null?void 0:C.name)||"Sin estado")),e.createElement("div",null,e.createElement("b",{className:"d-block"},"Estado del lead"),e.createElement("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((w=t==null?void 0:t.manage_status)==null?void 0:w.color)||"#6c757d"}},((k=t==null?void 0:t.manage_status)==null?void 0:k.name)||"Sin estado"))),(t==null?void 0:t.assigned_to)&&e.createElement(e.Fragment,null,e.createElement("b",{className:"d-block mb-1"},"Atendido por:"),e.createElement("div",{className:"d-flex align-items-start"},e.createElement("img",{className:"d-flex me-2 rounded-circle",src:`//${V.APP_DOMAIN}/api/profile/thumbnail/${(_=t==null?void 0:t.assigned)==null?void 0:_.relative_id}`,alt:(R=t==null?void 0:t.assigned)==null?void 0:R.name,height:"32"}),e.createElement("div",{className:"w-100"},e.createElement("h5",{className:"m-0 font-14"},(S=t==null?void 0:t.assigned)==null?void 0:S.name),e.createElement("span",{className:"font-12 mb-0"},(T=t==null?void 0:t.assigned)==null?void 0:T.email)))),e.createElement("hr",null),e.createElement("h4",null,"Datos del contacto"),e.createElement("h5",{className:"font-600 mb-0"},"Correo electronico"),e.createElement("p",{className:"mb-2 text-truncate"}," ",t==null?void 0:t.contact_email," "),e.createElement("h5",{className:"font-600 mb-0"},"Tefono / Celular"),e.createElement("p",{className:"mb-2"}," ",t==null?void 0:t.contact_phone," "),e.createElement("h5",{className:"font-600 mb-0"},"Mensaje"),e.createElement("p",{className:"mb-2"}," ",t==null?void 0:t.message," "),e.createElement("h5",{className:"font-600 mb-0"},"Fecha de registro"),e.createElement("p",{className:"mb-2"},moment(t==null?void 0:t.created_at).format("LL"),e.createElement("br",null),e.createElement("small",{className:"text-muted"},moment(t==null?void 0:t.created_at).format("LTS"))),e.createElement("hr",null),e.createElement("h4",null,"Datos de la empresa"),e.createElement("h5",{className:"font-600 mb-0"},"Nombre comercial"),e.createElement("p",{className:"mb-2"}," ",(t==null?void 0:t.tradename)??e.createElement("i",{className:"text-muted"},"No especifica")," "),e.createElement("h5",{className:"font-600 mb-0"},"RUC"),e.createElement("p",{className:"mb-2"}," ",(t==null?void 0:t.ruc)??e.createElement("i",{className:"text-muted"},"No especifica")," "),e.createElement("h5",{className:"font-600 mb-0"},"N° trabajadores"),e.createElement("p",{className:"mb-2"}," ",(t==null?void 0:t.workers)??e.createElement("i",{className:"text-muted"},"No especifica")," ")),e.createElement("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"card card-body"},e.createElement("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto"}},e.createElement("li",{key:"note-type-activity",className:"nav-item"},e.createElement("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active"},e.createElement("i",{className:"mdi mdi-clock"})," Actividad")),x.sort((a,s)=>a.order-s.order).map((a,s)=>{if(a.name!="Correos")return e.createElement("li",{key:`note-type-${s}`,className:"nav-item"},e.createElement("a",{href:`#note-type-${a.id}`,"data-name":a.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link"},e.createElement("i",{className:a.icon})," ",a.name))})),e.createElement("div",{className:"tab-content"},e.createElement("div",{key:"tab-note-type-activity",className:"tab-pane active",id:"note-type-activity"},c.sort((a,s)=>s.created_at>a.created_at?1:-1).map((a,s)=>e.createElement(P,{key:`note-${s}`,...a,showOptions:!1,session:v}))),x.sort((a,s)=>a.order-s.order).map((a,s)=>e.createElement("div",{key:`tab-note-type-${s}`,className:"tab-pane",id:`note-type-${a.id}`},e.createElement("h4",{className:"header-title mb-2"},"Lista de ",a.name),c.filter(m=>m.note_type_id==a.id).sort((m,d)=>d.created_at>m.created_at?1:-1).map((m,d)=>e.createElement(P,{key:`note-${d}`,...m,session:v}))))))),e.createElement("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-header bg-danger"},e.createElement("h5",{className:"header-title my-0 text-white"},"Tareas")),e.createElement("div",{className:"card-body"},h.length>0?h.sort((a,s)=>a.ends_at>s.ends_at?1:-1).map((a,s)=>e.createElement(ee,{key:`task-${s}`,...a})):e.createElement("i",{className:"text-muted"},"- No hay tareas pendientes -"))),e.createElement("div",{className:"card"},e.createElement("div",{className:"card-header bg-primary"},e.createElement("div",{className:"float-end text-white"},"S/. ",B(N.reduce((a,s)=>a+Number(s.price),0))),e.createElement("h5",{className:"header-title my-0 text-white"},"Productos")),e.createElement("div",{className:"card-body"},N.length>0?e.createElement("div",{className:"mt-2 d-flex flex-column gap-2"},N.map((a,s)=>e.createElement("div",{className:"card mb-0",key:s,style:{border:`1px solid ${a.color}44`,backgroundColor:`${a.color}11`}},e.createElement("div",{className:"card-body p-2"},e.createElement("div",{className:"float-end"},e.createElement(q,{content:"Quitar producto"},e.createElement("i",{className:"fa fa-times",onClick:()=>deleteClientProduct(a),style:{cursor:"pointer"}}))),e.createElement("h5",{className:"header-title mt-0 mb-1",style:{fontSize:"14.4px",color:a.color}},a.name),e.createElement("small",null,"S/. ",B(a.price)))))):e.createElement("i",{className:"text-muted"},"- Sin productos -")))))))};J((l,n)=>{if(!n.can("clients","root","all","list"))return location.href="/";K(l).render(e.createElement(X,{...n,title:"Archivados"},e.createElement(oe,{...n})))});
