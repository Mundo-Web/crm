var k=Object.defineProperty;var z=(n,i,l)=>i in n?k(n,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[i]=l;var y=(n,i,l)=>z(n,typeof i!="symbol"?i+"":i,l);import{C as G,c as I,j as s,r}from"./CreateReactScript-CgEuCtoy.js";import{R as C}from"./ReactAppend-XQOKTJts.js";import{B as q,A as L}from"./Adminto-Bq_D65az.js";import{M as A}from"./Modal-Dp_0-Qk7.js";import{T as P}from"./Table-CDxl9RFC.js";import{I as W}from"./InputFormGroup-CWxYSLYW.js";import{T as S}from"./TippyButton-Dy2QWUZf.js";import{D as T}from"./DxPanelButton-TL5fAOqj.js";import{S as Q}from"./sweetalert2.esm.all-DJ5rN5x4.js";import{S as H}from"./SelectFormGroup-BPJFFxZL.js";import{r as E}from"./server.browser-DtYOuO13.js";import{Q as O}from"./QuillFormGroup-DhfMJapB.js";import{R as J}from"./RepositoryDropzone-DtedUTlO.js";import"./default-C8QyGrl1.js";import"./index-CC_HFtZZ.js";class K extends q{constructor(){super(...arguments);y(this,"path","default-messages")}}const g=new K,U=({title:n,clientFields:i})=>{const l=r.useRef(),u=r.useRef(),j=r.useRef(),f=r.useRef(),h=r.useRef(),x=r.useRef(),d=r.useRef(),[b,w]=r.useState(!1),[a,R]=r.useState("whatsapp"),v=r.useRef(),[o,m]=r.useState([]),F=e=>{const t=Array.from(e.target.files);m(a==="whatsapp"?[t[0]]:c=>[...c,...t]),v.current.value=null},D=e=>{m(t=>t.filter(c=>c.id!==e))},N=e=>{e!=null&&e.id?w(!0):w(!1),f.current.value=(e==null?void 0:e.id)||null,h.current.value=(e==null?void 0:e.name)||null,$(x.current).val((e==null?void 0:e.type)||"whatsapp").trigger("change.select2"),R((e==null?void 0:e.type)||"whatsapp"),d.current.value=(e==null?void 0:e.description)||"",d.editor.root.innerHTML=(e==null?void 0:e.description)||"",m((e==null?void 0:e.attachments)||[]),$(u.current).modal("show")},M=async e=>{e.preventDefault();const t={id:f.current.value,name:h.current.value,type:x.current.value,description:d.current.value,attachments:o};await g.save(t)&&($(l.current).dxDataGrid("instance").refresh(),$(u.current).modal("hide"))},B=async e=>{const{isConfirmed:t}=await Q.fire({title:"Eliminar registro",text:"Â¿Desea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",reverseButtons:!0});!t||!await g.delete(e)||$(l.current).dxDataGrid("instance").refresh()};return r.useEffect(()=>{a==="whatsapp"&&o.length>1&&m([o[0]])},[a]),s.jsxs(s.Fragment,{children:[s.jsx(P,{gridRef:l,title:n,rest:g,toolBar:e=>{e.unshift(T({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(l.current).dxDataGrid("instance").refresh()})),e.unshift(T({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>N()}))},columns:[{dataField:"name",caption:"Alias"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{value:t})=>{e.html(E(s.jsxs("span",{className:`badge bg-${t==="email"?"info":"success"}`,children:[t==="email"?s.jsx("i",{className:"mdi mdi-email"}):s.jsx("i",{className:"mdi mdi-whatsapp"}),s.jsx("span",{className:"ms-1",children:t==="email"?"Email":"WhatsApp"})]})))}},{dataField:"description",caption:"Contenido",width:"60%",cellTemplate:(e,{value:t,data:c})=>{t||e.html(E(s.jsx("i",{className:"text-muted",children:"- Sin descripcion -"}))),e.text($(`<div>${t}</div>`).text().trim())}},{caption:"Acciones",width:"120px",cellTemplate:(e,{data:t})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),C(e,s.jsx(S,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>N(t),children:s.jsx("i",{className:"fa fa-pen"})})),C(e,s.jsx(S,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>B(t.id),children:s.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(A,{modalRef:u,title:b?"Editar mensaje predeterminado":"Agregar mensaje predeterminado",onSubmit:M,size:a=="email"?"lg":"md",children:s.jsxs("div",{className:"row",id:"default-messages-container",children:[s.jsx("input",{ref:f,type:"hidden"}),s.jsxs(H,{eRef:x,label:"Tipo mensaje",dropdownParent:"#default-messages-container",minimumResultsForSearch:-1,onChange:e=>R(e.target.value),disabled:b,required:!0,children:[s.jsx("option",{value:"whatsapp",children:"WhatsApp"}),s.jsx("option",{value:"email",children:"Email"})]}),s.jsx(W,{eRef:h,label:a==="whatsapp"?"Alias":"Asunto",col:"col-12",required:!0}),s.jsx(O,{eRef:d,label:"Mensaje",col:"col-12",mention:!0,mentionDenotationChars:["#"],mentionSource:(e,t,c)=>{t(i.filter(p=>p.name.toLowerCase().includes(e.toLowerCase())).map(p=>({id:p.field,label:p.field,value:`${p.name}`})))},information:"Nota: puedes agregar variables usando # (Ej. #Nombre)"}),s.jsxs("div",{className:"col-12",children:[s.jsx("input",{ref:v,type:"file",className:"d-none",multiple:a==="email",onChange:F}),s.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[s.jsxs("button",{className:"btn btn-sm btn-soft-primary mb-0",style:{cursor:"pointer"},onClick:()=>$(j.current).modal("show"),type:"button",children:[s.jsx("i",{className:"mdi mdi-paperclip me-1"}),"Adjuntar ",a==="whatsapp"?"archivo":"archivos"]}),a==="whatsapp"&&o.length>0&&s.jsx("small",{className:"text-muted",children:"Solo se permite un archivo para WhatsApp"})]}),o.length>0&&s.jsxs("div",{className:"border rounded p-2",children:[s.jsxs("div",{className:"d-flex align-items-center mb-2",children:[s.jsx("i",{className:"mdi mdi-paperclip me-1"}),s.jsx("small",{className:"text-muted",children:a==="whatsapp"?"Archivo adjunto":`Archivos adjuntos (${o.length})`})]}),s.jsx("div",{className:"d-flex flex-wrap gap-2",children:o.map((e,t)=>s.jsxs("div",{className:"border rounded p-1 d-flex align-items-center gap-2",style:{fontSize:"0.8rem"},children:[s.jsx("i",{className:"mdi mdi-file"}),s.jsx("span",{children:e.name}),s.jsx("button",{type:"button",className:"btn btn-xs btn-soft-danger py-0 px-1",onClick:()=>D(e.id),children:s.jsx("i",{className:"mdi mdi-close"})})]},t))})]})]})]})}),s.jsx(A,{modalRef:j,title:"Repositorio",size:"full-width",hideFooter:!0,zIndex:1060,children:s.jsx(J,{height:"calc(100vh - 300px)",multiple:a!=="whatsapp",selectedFiles:o,setSelectedFiles:m,selectable:!0})})]})};G((n,i)=>{i.title="Mensajes Predeterminados",I(n).render(s.jsx(L,{...i,children:s.jsx(U,{...i})}))});
