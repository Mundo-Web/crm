var z=Object.defineProperty;var I=(l,i,a)=>i in l?z(l,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[i]=a;var C=(l,i,a)=>I(l,typeof i!="symbol"?i+"":i,a);import{C as L,c as q,j as s,r as n}from"./CreateReactScript-DiT3hDbE.js";import{R as A}from"./ReactAppend-BXtQNJ7e.js";import{B as P,A as W,S as H}from"./Adminto-De12RiAo.js";import{M as T}from"./Modal-Zb77CfSz.js";import{T as Q,D as S}from"./DxPanelButton-DPSOyTFz.js";import{I as O}from"./InputFormGroup-CbQnIdio.js";import{T as J}from"./TextareaFormGroup-BDSgQCfr.js";import{T as F}from"./TippyButton-klStmm8x.js";import{S as K}from"./SelectFormGroup-CbSCTI9E.js";import{r as M}from"./server.browser-DOmhYhu7.js";import{Q as U}from"./QuillFormGroup-C34wdKZN.js";import{R as V}from"./RepositoryDropzone-BvtM05Nw.js";class X extends P{constructor(){super(...arguments);C(this,"path","default-messages")}}const g=new X,Y=({title:l,clientFields:i})=>{const a=n.useRef(),h=n.useRef(),b=n.useRef(),x=n.useRef(),j=n.useRef(),u=n.useRef(),f=n.useRef(),m=n.useRef(),[v,R]=n.useState(!1),[r,w]=n.useState("whatsapp"),y=n.useRef(),[o,p]=n.useState([]),D=e=>{const t=Array.from(e.target.files);p(r==="whatsapp"?[t[0]]:c=>[...c,...t]),y.current.value=null},E=e=>{p(t=>t.filter(c=>c.id!==e))},N=e=>{e!=null&&e.id?R(!0):R(!1),x.current.value=(e==null?void 0:e.id)||null,j.current.value=(e==null?void 0:e.name)||null,$(f.current).val((e==null?void 0:e.type)||"whatsapp").trigger("change.select2"),w((e==null?void 0:e.type)||"whatsapp"),(e==null?void 0:e.type)==="email"?(m.current.value=(e==null?void 0:e.description)||"",m.editor.root.innerHTML=(e==null?void 0:e.description)||""):u.current.value=(e==null?void 0:e.description)||null,p((e==null?void 0:e.attachments)||[]),$(h.current).modal("show")},B=async e=>{e.preventDefault();const t={id:x.current.value,name:j.current.value,type:f.current.value,description:r==="email"?m.current.value:u.current.value,attachments:o};await g.save(t)&&($(a.current).dxDataGrid("instance").refresh(),$(h.current).modal("hide"))},k=e=>{const t=$(f.current).val();w(t),t==="email"?(u.current.value="",m.editor.root.innerHTML=""):(m.current.value="",u.current.value="")},G=async e=>{const{isConfirmed:t}=await H.fire({title:"Eliminar registro",text:"Â¿Desea eliminar el registro?",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",reverseButtons:!0});!t||!await g.delete(e)||$(a.current).dxDataGrid("instance").refresh()};return n.useEffect(()=>{r==="whatsapp"&&o.length>1&&p([o[0]])},[r]),s.jsxs(s.Fragment,{children:[s.jsx(Q,{gridRef:a,title:l,rest:g,toolBar:e=>{e.unshift(S({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(a.current).dxDataGrid("instance").refresh()})),e.unshift(S({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>N()}))},columns:[{dataField:"name",caption:"Alias"},{dataField:"type",caption:"Tipo",width:"100px",cellTemplate:(e,{value:t})=>{e.html(M(s.jsxs("span",{className:`badge bg-${t==="email"?"info":"success"}`,children:[t==="email"?s.jsx("i",{className:"mdi mdi-email"}):s.jsx("i",{className:"mdi mdi-whatsapp"}),s.jsx("span",{className:"ms-1",children:t==="email"?"Email":"WhatsApp"})]})))}},{dataField:"description",caption:"Descripcion",width:"60%",cellTemplate:(e,{value:t,data:c})=>{t?c.type==="email"?e.text($(`<div>${t}</div>`).text().trim()):e.text(t):e.html(M(s.jsx("i",{className:"text-muted",children:"- Sin descripcion -"})))}},{caption:"Acciones",width:"120px",cellTemplate:(e,{data:t})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),A(e,s.jsx(F,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>N(t),children:s.jsx("i",{className:"fa fa-pen"})})),A(e,s.jsx(F,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>G(t.id),children:s.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(T,{modalRef:h,title:v?"Editar mensaje predeterminado":"Agregar mensaje predeterminado",onSubmit:B,size:r=="email"?"lg":"md",children:s.jsxs("div",{className:"row",id:"default-messages-container",children:[s.jsx("input",{ref:x,type:"hidden"}),s.jsxs(K,{eRef:f,label:"Tipo mensaje",dropdownParent:"#default-messages-container",minimumResultsForSearch:-1,onChange:k,disabled:v,required:!0,children:[s.jsx("option",{value:"whatsapp",children:"WhatsApp"}),s.jsx("option",{value:"email",children:"Email"})]}),s.jsx(O,{eRef:j,label:r==="whatsapp"?"Alias":"Asunto",col:"col-12",required:!0}),s.jsx("div",{hidden:r==="email",children:s.jsx(J,{eRef:u,label:"Mensaje",col:"col-12"})}),s.jsx("div",{hidden:r==="whatsapp",children:s.jsx(U,{eRef:m,label:"Mensaje",col:"col-12",mention:!0,mentionDenotationChars:["#"],mentionSource:(e,t,c)=>{t(i.filter(d=>d.name.toLowerCase().includes(e.toLowerCase())).map(d=>({id:d.field,label:d.field,value:`${d.name}`})))}})}),s.jsxs("div",{className:"col-12",children:[s.jsx("input",{ref:y,type:"file",className:"d-none",multiple:r==="email",onChange:D}),s.jsxs("div",{className:"d-flex align-items-center gap-2 mb-2",children:[s.jsxs("button",{className:"btn btn-sm btn-soft-primary mb-0",style:{cursor:"pointer"},onClick:()=>$(b.current).modal("show"),type:"button",children:[s.jsx("i",{className:"mdi mdi-paperclip me-1"}),"Adjuntar ",r==="whatsapp"?"archivo":"archivos"]}),r==="whatsapp"&&o.length>0&&s.jsx("small",{className:"text-muted",children:"Solo se permite un archivo para WhatsApp"})]}),o.length>0&&s.jsxs("div",{className:"border rounded p-2",children:[s.jsxs("div",{className:"d-flex align-items-center mb-2",children:[s.jsx("i",{className:"mdi mdi-paperclip me-1"}),s.jsx("small",{className:"text-muted",children:r==="whatsapp"?"Archivo adjunto":`Archivos adjuntos (${o.length})`})]}),s.jsx("div",{className:"d-flex flex-wrap gap-2",children:o.map((e,t)=>s.jsxs("div",{className:"border rounded p-1 d-flex align-items-center gap-2",style:{fontSize:"0.8rem"},children:[s.jsx("i",{className:"mdi mdi-file"}),s.jsx("span",{children:e.name}),s.jsx("button",{type:"button",className:"btn btn-xs btn-soft-danger py-0 px-1",onClick:()=>E(e.id),children:s.jsx("i",{className:"mdi mdi-close"})})]},t))})]})]})]})}),s.jsx(T,{modalRef:b,title:"Repositorio",size:"full-width",hideFooter:!0,zIndex:1060,children:s.jsx(V,{height:"calc(100vh - 300px)",multiple:r!=="whatsapp",selectedFiles:o,setSelectedFiles:p,selectable:!0})})]})};L((l,i)=>{i.title="Mensajes Predeterminados",q(l).render(s.jsx(W,{...i,children:s.jsx(Y,{...i})}))});
