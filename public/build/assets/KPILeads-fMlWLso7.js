var K=Object.defineProperty;var O=(i,d,l)=>d in i?K(i,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[d]=l;var v=(i,d,l)=>O(i,typeof d!="symbol"?d+"":d,l);import{m as H,C as J,c as V,j as e,r as n,G as N}from"./CreateReactScript-DSh221L4.js";import{A as X}from"./Adminto-CxkkDmWv.js";import{S as z}from"./SelectFormGroup-D827EBoU.js";import{r as D}from"./server.browser-DoheiHq8.js";import{N as m}from"./Number2Currency-e57Tgsuk.js";class f{}v(f,"kpi",async d=>{const{result:l}=await H.Fetch(`/api/dashboard/leads/kpi/${d}`);return{data:(l==null?void 0:l.data)??[],summary:(l==null?void 0:l.summary)??{}}});const Q=({months:i=[],currentMonth:d,currentYear:l})=>{const[h,b]=n.useState(`${l}-${d}`),[S,y]=n.useState([]),[w,C]=n.useState([]),[_,k]=n.useState(0),[M,A]=n.useState(0),[E,P]=n.useState(0),[q,I]=n.useState(0),[L,R]=n.useState(0),[F,G]=n.useState(0),[T,W]=n.useState(0),[Y,B]=n.useState(0),[c,x]=n.useState({}),[g,j]=n.useState([]),p=({id:a,text:t,element:s})=>{if(!a)return t;const r=$(s).data("option");return $(D(e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:t}),e.jsxs("small",{children:[e.jsx("i",{className:"me-1 fa fa-users"}),r.quantity," entradas"]})]})))};n.useEffect(()=>{x({}),j([]),f.kpi(h).then(({data:a,summary:t})=>{C(a),y(t.grouped??[]),k(t.totalCount??0),A(t.clientsCount??0),P(t.archivedCount??0),I(t.managingCount??0),R(t.totalSum??0),G(t.clientsSum??0),W(t.archivedSum??0),B(t.managingSum??0),x(t.leadSources??{}),j(t.originCounts??[])})},[h]),n.useEffect(()=>{const a=document.getElementById("leadsStatusPie");let t;return a&&(window.leadsStatusChart&&window.leadsStatusChart.destroy(),t=new Chart(a,{type:"pie",data:{labels:[N.APP_NAME,"WhatsApp","Integración"],datasets:[{data:[c.crm_count,c.whatsapp_count,c.integration_count],backgroundColor:["#f1556c","#1abc9c","#4a81d4"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),window.leadsStatusChart=t),()=>{window.leadsStatusChart&&window.leadsStatusChart.destroy()}},[c]),n.useEffect(()=>($('[data-plugin="knob"]').knob({draw:function(){const a=this.i.attr("data-count");$(this.i).val(a)}}),()=>{$('[data-plugin="knob"]').trigger("change")}),[c,g]);const u=c.crm_count+c.whatsapp_count+c.integration_count;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2",children:e.jsx(z,{minimumResultsForSearch:-1,templateResult:p,templateSelection:p,onChange:a=>b(a.target.value),children:i.map((a,t)=>{const s=moment({month:a.month-1,year:a.year});return e.jsx("option",{value:a.id,"data-option":JSON.stringify(a),children:s.format("MMMM YYYY").toTitleCase()},t)})})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("h4",{className:"mt-0 mb-2",children:"Vista general de leads"})})}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card card-body",children:[e.jsx("div",{style:{height:"250px"},children:e.jsx("canvas",{id:"leadsStatusPie",width:"100%",height:"100%"})}),e.jsx("h4",{className:"mt-3 mb-2 text-center",children:"Ingreso de leads"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-evenly",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#f1556c","data-bgcolor":"#f1556c33",value:c.crm_count/u*100||0,"data-count":c.crm_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center",children:N.APP_NAME})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#1abc9c","data-bgcolor":"#1abc9c33",value:c.whatsapp_count/u*100||0,"data-count":c.whatsapp_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center",children:"WhatsApp"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#4a81d4","data-bgcolor":"#4a81d433",value:c.integration_count/u*100||0,"data-count":c.integration_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center",children:"Integracion"})]})]})]})}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-info","data-plugin":"counterup",children:_}),e.jsx("h5",{children:"Leads"}),e.jsxs("small",{children:["S/. ",m(L)]})]})})})}),e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-success","data-plugin":"counterup",children:M}),e.jsx("h5",{children:"Convertidos"}),e.jsxs("small",{children:["S/. ",m(F)]})]})})})}),e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-danger","data-plugin":"counterup",children:E}),e.jsx("h5",{children:"No convertidos"}),e.jsxs("small",{children:["S/. ",m(T)]})]})})})}),e.jsx("div",{className:"col-md-3 col-sm-6 col-xs-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"fw-normal text-primary","data-plugin":"counterup",children:q}),e.jsx("h5",{children:"En gestion"}),e.jsxs("small",{children:["S/. ",m(Y)]})]})})})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"header-title text-center my-0",children:"Ingreso de Leads por Integración"})}),e.jsx("div",{className:" card-body",style:{minHeight:"160px"},children:e.jsx("div",{className:"d-flex flex-wrap gap-2 justify-content-evenly",children:g.map((a,t)=>{const s=a.count||0,r=s/c.integration_count*100,o=`${s.origin}-${s.count}-${t}`;return e.jsxs("div",{id:o,className:"text-center",children:[e.jsx("input",{"data-plugin":"knob","data-width":"100","data-height":"100","data-fgcolor":"#4a81d4","data-bgcolor":"#4a81d433",value:r,"data-count":s,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.jsx("small",{className:"text-muted d-block text-center mt-1",children:a.origin})]},o)})})})]})})})]})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"d-flex gap-3 mb-3",style:{overflowX:"auto"},children:S.map((a,t)=>e.jsxs("div",{className:"card",style:{minWidth:"270px",maxWidth:"270px"},children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"float-end",children:e.jsx("b",{children:a.quantity})}),e.jsx("h4",{className:"header-title my-0 text-truncate",style:{color:a.color},children:a.name})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"d-flex gap-3 flex-column",children:w.filter(({status_id:s})=>s==a.id).sort((s,r)=>r.quantity-s.quantity).map((s,r)=>{const o=(s.quantity/a.quantity*100).toFixed(2);return e.jsxs("div",{children:[e.jsxs("h5",{className:"my-0",children:[s.manage_status_name," ",e.jsx("span",{className:"float-end",style:{color:s.manage_status_color},children:s.quantity})]}),e.jsx("div",{className:"progress progress-bar-alt-primary progress-sm mt-0",style:{backgroundColor:`${s.manage_status_color}44`},children:e.jsx("div",{className:"progress-bar progress-animated wow animated animated",role:"progressbar","aria-valuenow":o,"aria-valuemin":"0","aria-valuemax":"100",style:{width:`${o}%`,visibility:"visible",animationName:"animationProgress",backgroundColor:s.manage_status_color}})})]},r)})})})]},t))})})})]})};J((i,d)=>{V(i).render(e.jsx(X,{...d,title:"KPI - Leads",children:e.jsx(Q,{...d})}))});
