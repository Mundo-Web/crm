var O=Object.defineProperty;var P=(i,t,r)=>t in i?O(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var p=(i,t,r)=>P(i,typeof t!="symbol"?t+"":t,r);import{m as c,j as s,C as B,c as G,r as d}from"./CreateReactScript-CgEuCtoy.js";import{R as g}from"./ReactAppend-XQOKTJts.js";import{P as R}from"./PermissionsRest-DIs7XO1F.js";import{i as M,A as L}from"./Adminto-D1MVey_P.js";import{M as k}from"./Modal-Dp_0-Qk7.js";import{T as _}from"./Table-CDxl9RFC.js";import{I as q}from"./InputFormGroup-CWxYSLYW.js";import{T as z}from"./TextareaFormGroup-rQZ0nV4r.js";import{T as v}from"./TippyButton-Cm1-xxj0.js";import{D as C}from"./DxPanelButton-TL5fAOqj.js";import{S as I}from"./sweetalert2.esm.all-DJ5rN5x4.js";import"./server.browser-DtYOuO13.js";import"./default-C8QyGrl1.js";import"./index-CC_HFtZZ.js";class u{}p(u,"paginate",async t=>{const{result:r}=await c.Fetch("/api/roles/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});return r}),p(u,"byUser",async t=>{const{result:r}=await c.Fetch(`/api/roles/user/${t}`);return r.data??[]}),p(u,"save",async t=>{try{const{status:r,result:o}=await c.Fetch("/api/roles",{method:"POST",body:JSON.stringify(t)});if(!r)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),p(u,"status",async({id:t,status:r})=>{try{const{status:o,result:n}=await c.Fetch("/api/roles/status",{method:"PATCH",body:JSON.stringify({id:t,status:r})});if(!o)throw new Error((n==null?void 0:n.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:n.message,type:"success"}),!0}catch(o){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:o.message,type:"danger"}),!1}}),p(u,"delete",async t=>{try{const{status:r,result:o}=await c.Fetch(`/api/roles/${t}`,{method:"DELETE"});if(!r)throw new Error((o==null?void 0:o.message)??"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}});const J=({title:i,id:t,parent:r,children:o,className:n,isOpened:m})=>s.jsxs("div",{className:"card mb-1 border",children:[s.jsx("div",{className:"card-header p-0",id:`heading-${t}`,children:s.jsx("h5",{className:"m-0",children:s.jsx("a",{className:`d-block text-dark ${!m&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${t}`,"aria-expanded":"false",children:i})})}),s.jsx("div",{id:t,className:`collapse ${m&&"show"}`,"aria-labelledby":`heading-${t}`,"data-bs-parent":`#${r}`,children:s.jsx("div",{className:`card-body p-2 ${n}`,children:o})})]}),H=({title:i,label:t,id:r,name:o,value:n,checked:m,required:f,rounded:h=!1,style:j,className:x})=>s.jsx(M,{content:i,arrow:!0,children:s.jsxs("div",{className:`form-check form-check-success ${x}`,style:{...j,cursor:"pointer"},children:[s.jsx("input",{className:`form-check-input ${h&&"rounded-circle"}`,type:"checkbox",value:n,name:o,id:r,defaultChecked:m,required:f,style:{cursor:"pointer"}}),s.jsx("label",{className:"form-check-label",htmlFor:r,style:{cursor:"pointer"},children:t})]})}),U=({permissions:i,can:t})=>{i=Object.values(i.map(e=>{const[a]=e.name.split(".");return{...e,origin:a}}).reduce((e,a)=>(e[a.origin]||(e[a.origin]=[]),e[a.origin].push(a),e),{}));const r=d.useRef(),o=d.useRef(),n=d.useRef();d.useRef();const m=d.useRef(),f=d.useRef(),h=d.useRef(),[j,x]=d.useState(!1),[w,E]=d.useState({}),N=e=>{e!=null&&e.id?x(!0):x(!1),m.current.value=(e==null?void 0:e.id)||null,f.current.value=(e==null?void 0:e.name)||null,h.current.value=(e==null?void 0:e.description)||null,$(o.current).modal("show")},T=async e=>{E(e);const a=await R.byRole(e.id);$("#permissions input").prop("checked",!1),a.forEach(({name:l})=>{$(`[name="${l}"]`).prop("checked",!0)}),$(n.current).modal("show")},S=async e=>{e.preventDefault();const a={id:m.current.value||void 0,name:f.current.value,description:h.current.value};await u.save(a)&&($(r.current).dxDataGrid("instance").refresh(),$(o.current).modal("hide"))},F=async e=>{e.preventDefault();const a=[...$("#permissions input:checked")].map(b=>b.value),l={role_id:w.id,permissions:a};await R.massiveByRole(l)&&($(n.current).modal("hide"),$(r.current).dxDataGrid("instance").refresh())},A=async e=>{const{isConfirmed:a}=await I.fire({title:"Eliminar rol",text:"¿Está seguro de eliminar este rol?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!a||!await u.delete(e)||$(r.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(_,{gridRef:r,title:"Roles",rest:u,toolBar:e=>{e.unshift(C({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(r.current).dxDataGrid("instance").refresh()})),t("roles","all","create")&&e.unshift(C({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>N()}))},columns:[{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",width:"150px",cellTemplate:(e,{data:a})=>{g(e,s.jsx("span",{children:moment(a.created_at).format("LL")}))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",width:"150px",cellTemplate:(e,{data:a})=>{g(e,s.jsx("span",{children:moment(a.updated_at).format("LL")}))}},{caption:"Acciones",cellTemplate:(e,{data:a})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),g(e,s.jsx(v,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>N(a),children:s.jsx("i",{className:"fa fa-pen"})})),g(e,s.jsx(v,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>T(a),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>',children:s.jsx("i",{className:"fas fa-th-list"})})),g(e,s.jsx(v,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>A(a.id),children:s.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(k,{modalRef:o,title:j?"Editar rol":"Agregar rol",onSubmit:S,children:s.jsxs("div",{className:"row",children:[s.jsx("input",{ref:m,type:"hidden"}),s.jsx(q,{eRef:f,label:"Rol",col:"col-12",required:!0}),s.jsx(z,{eRef:h,label:"Descripcion",col:"col-12"})]})}),s.jsx(k,{modalRef:n,title:`Permisos para ${w.name}`,btnSubmitText:"Guardar",onSubmit:F,size:"lg",children:s.jsx("div",{id:"permissions",className:"row",children:i.map((e,a)=>{const l=e[0].origin;return s.jsx("div",{className:"col-lg-4 col-md-6 col-sm-12",children:s.jsx(J,{id:`permission-${l}`,title:l,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row",isOpened:!0,children:e.map(({id:y,name:b,description:D})=>s.jsx(H,{className:"mb-0",id:`permission-ck-${y}`,label:b.replace(`${l}.`,""),name:b,value:y,title:D,style:{width:"max-content"},rounded:!0},`permission-${y}`))},`accordion-${a}`)})})})})]})};B((i,t)=>{G(i).render(s.jsx(L,{...t,title:"Roles",children:s.jsx(U,{...t})}))});
