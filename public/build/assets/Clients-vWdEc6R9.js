import{r,j as e,G as F,C as Se,c as Ae,m as ue}from"./CreateReactScript-FT9riFD6.js";import{A as Ee,i as D}from"./Adminto-TN_zr-G5.js";import{M as q}from"./Modal-CvgTmxtu.js";import{S as he}from"./sweetalert2.esm.all-BLfQoUmi.js";import{C as G,a as xe,T as Te}from"./ClientNotesRest-DlIkykw6.js";import{I as g}from"./InputFormGroup-2ffCkRLw.js";import{T as L}from"./TextareaFormGroup-xGDLKjaY.js";import{S as K,a as Pe}from"./SetSelectValue-B1xfi813.js";import{D as ee}from"./DropdownItem-Dz3eh4_7.js";import{D as Fe}from"./DropdownEnd-DmnORX6M.js";import{P as Ge,a as Me,A as Be}from"./AssignUsersModal-CmzGF8Wv.js";import{R as N}from"./ReactAppend-tqk_6ZWW.js";import{C as Ie,P as qe}from"./ProductsByClientsRest-D8swl1lq.js";import{P as ze,A as Ue,D as Oe}from"./DateRange-CjGULshc.js";import{T as Ve}from"./Table-NatUwn5O.js";import{T as h}from"./TippyButton-Bl5d7IZM.js";import{N as Z}from"./Number2Currency-e57Tgsuk.js";import{D as We}from"./DxBox-BImTkMYb.js";import{D as He}from"./Dropdown-DT7LMwqs.js";import{L as Ye}from"./LeadsRest-BWQmghDo.js";import{D as Qe}from"./DxPanelButton-vjKGXTwi.js";import{r as Xe}from"./server.browser-B7ekY6O5.js";import"./Logout-Djwh9QSR.js";import"./default-BIT8_V-f.js";import"./index-BdYZYpiQ.js";import"./ArrayJoin-2k6ba35P.js";const Je=({can:v,client:l,setClient:z,grid2refresh:U,page:M})=>{const y=r.useRef(),o=r.useRef(),f=r.useRef(),w=r.useRef(),p=r.useRef(),d=r.useRef(),[k,j]=r.useState([]),[C,R]=r.useState(!1);r.useEffect(()=>{l.id&&S(),$(y.current).on("hidden.bs.modal",()=>{z({}),j([]),R(!1),f.current.value=null,K(w.current,null,null),p.current.value=null,d.current.value=null})},[l]);const S=async()=>{const n=await G.byClient(l==null?void 0:l.id);j(n),$(y.current).modal("show")},A=async n=>{n.preventDefault();const u={id:f.current.value||void 0,type_id:w.current.value,client_id:l.id,name:p.current.value,description:d.current.value};await G.save(u)&&($(o.current).modal("hide"),f.current.value=null,K(w.current,null,null),p.current.value=null,d.current.value=null,await _(),$(U.current).dxDataGrid("instance").refresh())},_=async()=>{const n=await G.byClient(l.id);j(n)},E=async n=>{f.current.value=n.id,K(w.current,n.type.id,n.type.name),p.current.value=n.name,d.current.value=n.description,$(o.current).modal("show"),R(!0)},T=async n=>{const{isConfirmed:u}=await he.fire({title:"Estas seguro de eliminar esta nota?",text:"No podras revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!u||!await G.delete(n)||(await _(),$(U.current).dxDataGrid("instance").refresh())};return e.jsxs(e.Fragment,{children:[e.jsx(q,{modalRef:y,title:`Notas de ${(l==null?void 0:l.tradename)||(l==null?void 0:l.name)||(l==null?void 0:l.contact_name)}`,size:"full-width",isStatic:!0,hideFooter:!0,children:e.jsxs("div",{style:{height:"calc(100vh - 180px)",overflowY:"auto"},children:[e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn btn-primary",type:"button",onClick:()=>$(o.current).modal("show"),children:"Agregar nota"})}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-wrap flex-row justify-content-center gap-2",children:k.sort((n,u)=>new Date(u.created_at)-new Date(n.created_at)).map((n,u)=>{const x=moment(n.created_at),V=moment().diff(x,"hours")>12?x.format("lll"):x.fromNow();return e.jsx("div",{className:"card text-white bg-purple mb-0",style:{width:"100%",maxWidth:"300px",height:"max-content"},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex align-items-center border-bottom border-white pb-1 mb-1",children:[e.jsx("div",{className:"avatar-sm me-2 mb-1",children:e.jsx("img",{src:`/api/profile/thumbnail/${n.user.relative_id}?v=${new Date(n.user.updated_at).getTime()}`,onError:B=>{B.target.src=`//${F.APP_DOMAIN}/assets/img/user-404.svg`},className:"img-fluid rounded-circle",alt:"user"})}),e.jsxs("div",{className:"flex-grow-1 overflow-hidden",children:[e.jsxs("h5",{className:"text-white m-0",children:[n.user.name," ",n.user.lastname]}),e.jsx("p",{className:"text-white-50 m-0 font-13 text-truncate",children:V})]}),v(M,"root","all","editnotes","deletenotes")&&e.jsxs(Fe,{children:[v(M,"root","all","editnotes")&&e.jsx(ee,{onClick:()=>E(n),children:"Editar"}),v(M,"root","all","deletenotes")&&e.jsx(ee,{onClick:()=>T(n.id),children:"Eliminar"})]})]}),e.jsxs("blockquote",{className:"card-bodyquote mb-0",children:[n.name&&e.jsx("b",{children:n.name}),e.jsx("p",{className:"mb-1",children:n.description})]})]})},`note-${u}`)})})]})}),e.jsx(q,{modalRef:o,title:C?"Editar nota":"Agregar nota",size:"sm",onSubmit:A,children:e.jsxs("div",{id:"note-crud-container",children:[e.jsx("input",{ref:f,type:"hidden"}),e.jsx(Pe,{eRef:w,label:"Tipo de nota",col:"col-12",dropdownParent:"#note-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",filter:["table_id","=","c81ad4fb-a895-4f4c-b4b3-5989a7a66a85"],required:!0}),e.jsx(g,{eRef:p,label:"Titulo de la nota"}),e.jsx(L,{eRef:d,label:"Descripcion de la nota",required:!0})]})})]})},P=new Ie,Ke=new Ye,Ze=new G,Le=new qe,es=({projectStatuses:v,finishedProjectStatus:l,clientStatuses:z,products:U=[],manageStatuses:M,session:y,can:o,noteTypes:f,defaultClientStatus:w,client:p})=>{var re,ne,le,ce,ie,oe,de,me;const d=r.useRef(),k=r.useRef(),j=r.useRef(),C=r.useRef(),R=r.useRef(),S=r.useRef(),A=r.useRef(),_=r.useRef(),E=r.useRef(),T=r.useRef(),n=r.useRef(),u=r.useRef(),x=r.useRef(),[se,O]=r.useState(!1),[V,B]=r.useState({}),[fe,te]=r.useState({}),[pe,ss]=r.useState({}),[je,be]=r.useState({}),[ts,as]=r.useState([]),[t,W]=r.useState({}),[b,H]=r.useState([]),[Y,Q]=r.useState([]),Ne=s=>{s!=null&&s.id?O(!0):O(!1),$('[href="#client-data"]').addClass("active"),$('[href="#contact-data"]').removeClass("active"),$("#client-data").addClass("active"),$("#contact-data").removeClass("active"),C.current.value=(s==null?void 0:s.id)||null,R.current.value=(s==null?void 0:s.ruc)||null,S.current.value=(s==null?void 0:s.name)||null,A.current.value=(s==null?void 0:s.tradename)||null,_.current.value=(s==null?void 0:s.web_url)||null,E.current.value=(s==null?void 0:s.message)||"Cliente creado desde Atalaya",T.current.value=(s==null?void 0:s.contact_name)||null,n.current.value=(s==null?void 0:s.contact_phone)||null,u.current.value=(s==null?void 0:s.contact_email)||null,x.current.value=(s==null?void 0:s.contact_address)||null,$(k.current).modal("show")},ge=async s=>{s.preventDefault();const a={id:C.current.value||void 0,ruc:R.current.value,name:S.current.value,tradename:A.current.value,web_url:_.current.value,message:E.current.value??"Cliente creado desde Atalaya",contact_name:T.current.value??"",contact_phone:n.current.value??"",contact_email:u.current.value??"",contact_address:x.current.value??"",status_id:C.current.value?void 0:w};await P.save(a)&&($(d.current).dxDataGrid("instance").refresh(),$(k.current).modal("hide"))},ve=async s=>{const{isConfirmed:a}=await he.fire({title:"Estas seguro de eliminar este lead?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!a||!await P.delete(s)||$(d.current).dxDataGrid("instance").refresh()},ae=async(s,a)=>{await P.assign(s,a)&&$(d.current).dxDataGrid("instance").refresh()},ye=async(s,a)=>{await Ke.leadStatus({lead:s,status:a}),$(d.current).dxDataGrid("instance").refresh()},I=async s=>{W(s),history.pushState(null,null,`/clients/${s.id}`),H([]),Q([]),$(j.current).modal("show")};r.useEffect(()=>{we(),Ce()},[t]);const we=async()=>{const s=await Ze.byClient(t==null?void 0:t.id);H(s??[])},Ce=async()=>{const s=await Le.byClient(t==null?void 0:t.id);Q(s)};r.useEffect(()=>{$(j.current).on("hidden.bs.modal",()=>{W(null),history.pushState(null,null,"/clients")}),p&&P.get(p).then(s=>{s&&(W(s),H([]),Q([]),$(j.current).modal("show"),ue.GET.annotation&&$(`[data-name="${ue.GET.annotation}"]`).click())})},[null]);const Re=[];b==null||b.forEach(s=>Re.push(...s.tasks));const X=[];return b==null||b.forEach(s=>X.push(...s.tasks.filter(a=>a.status!="Realizado"))),e.jsxs(e.Fragment,{children:[e.jsx(Ve,{gridRef:d,title:"Clientes",rest:P,toolBar:s=>{s.unshift(Qe({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(d.current).dxDataGrid("instance").refresh()}))},columns:[o("projects","root","all","list")?{dataField:"id",caption:"ID",dataType:"number",cellTemplate:(s,{data:a,value:i,...m})=>{N(s,e.jsxs(h,{className:"btn btn-xs btn-white",title:`Ver ${a.projects_count} proyectos`,onClick:()=>{m.component.collapseAll(-1),m.component.expandRow(m.row.data)},children:[e.jsx("i",{className:"fas fa-shapes"})," ",a.projects_count]}))},sortOrder:"desc"}:null,{dataField:"ruc",caption:"RUC",cellTemplate:(s,{data:a})=>{s.attr("style","height: 48px; cursor: pointer"),s.on("click",()=>I(a)),s.html(a.ruc||'<i class="text-muted">- Sin RUC -</i>')}},{dataField:"tradename",caption:"Nombre comercial",width:250,cellTemplate:(s,{data:a})=>{s.attr("style","height: 48px; cursor: pointer"),s.on("click",()=>I(a)),N(s,e.jsxs("div",{className:"d-flex align-items-center",children:[a.assigned_to&&e.jsx(D,{content:`Atendido por ${a.assigned.name} ${a.assigned.lastname}`,children:e.jsx("img",{className:"avatar-xs rounded-circle me-1",src:`//${F.APP_DOMAIN}/api/profile/thumbnail/${a.assigned.relative_id}`,onError:i=>{i.target.src=`//${F.APP_DOMAIN}/assets/img/user-404.svg`},alt:a.assigned.name})}),e.jsx("div",{children:a.tradename||e.jsx("i",{className:"text-muted",children:"- Sin nombre -"})})]}))}},{dataField:"name",caption:"Razon social",visible:!1},{dataField:"contact_name",caption:"Nombre de contacto",width:250,cellTemplate:(s,{data:a})=>{s.attr("style","height: 48px; cursor: pointer"),s.on("click",()=>I(a)),s.html(Xe(e.jsx("b",{children:a.contact_name})))}},{dataField:"contact_phone",caption:"Telefono"},{dataField:"contact_email",caption:"Correo"},o("clients","root","all","changestatus")?{dataField:"status.name",caption:"Estado del cliente",dataType:"string",cellTemplate:(s,{data:a})=>{s.attr("style","overflow: visible"),N(s,e.jsx(He,{className:"btn btn-xs btn-white rounded-pill",title:a.status.name,icon:{icon:"fa fa-circle",color:a.status.color},tippy:"Actualizar estado",children:z.map(({id:i,name:m,color:c})=>e.jsxs(ee,{onClick:()=>ye(a.id,i),children:[e.jsx("i",{className:"fa fa-circle",style:{color:c}})," ",m]},i))}))}}:null,o("clients","root","all","list","update","changestatus","delete")?{caption:"Acciones",width:235,cellTemplate:(s,{data:a})=>{s.attr("style","display: flex; gap: 4px; overflow: visible"),N(s,e.jsx(h,{className:"btn btn-xs btn-soft-primary",title:"Ver detalles",onClick:()=>I(a),children:e.jsx("i",{className:"fa fa-eye"})})),o("clients","root","all","update")&&N(s,e.jsx(h,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>Ne(a),children:e.jsx("i",{className:"fa fa-pen"})})),a.assigned_to?a.assigned_to==y.id&&N(s,e.jsx(h,{className:"btn btn-xs btn-soft-danger",title:"Dejar de atender",onClick:()=>ae(a.id,!1),children:e.jsx("i",{className:"fas fa-hands-wash"})})):N(s,e.jsx(h,{className:"btn btn-xs btn-soft-dark",title:"Atender lead",onClick:()=>ae(a.id,!0),children:e.jsx("i",{className:"fas fa-hands-helping"})})),o("clients","root","all","delete")&&N(s,e.jsx(h,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>ve(a.id),children:e.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}:null],masterDetail:{enabled:!1,template:async(s,{data:a,component:i})=>{s.css("padding","10px"),s.css("overflow","visible"),s.css("background-color","#323a46");let{data:m}=await ze.paginate({filter:["client_id","=",a.id],isLoadingAll:!0});s.append(We([e.jsxs(e.Fragment,{children:[e.jsx(h,{title:"Cerrar tabla",className:"btn btn-xs btn-soft-danger waves-effect mb-1",onClick:()=>i.collapseAll(-1),children:e.jsx("i",{className:"fa fa-times"})}),e.jsxs("table",{className:"table table-dark table-sm table-bordered mb-0",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Tipo"}),e.jsx("th",{scope:"col",children:"Asignados"}),e.jsx("th",{scope:"col",children:"Costo"}),e.jsx("th",{scope:"col",children:"Pagos"}),e.jsx("th",{scope:"col",children:"Fecha de desarrollo"}),e.jsx("th",{scope:"col",children:"Estado del proyecto"}),e.jsx("th",{scope:"col",children:"Acciones"})]})}),e.jsx("tbody",{children:m==null?void 0:m.sort((c,J)=>J.project_status==null?-1:1).map(c=>{const J=(c.total_payments/c.cost*100).toFixed(2),_e=Number(c.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),De=Number(c.cost-c.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),$e=c.users.map(ke=>ke.relative_id);return e.jsxs("tr",{children:[e.jsxs("td",{valign:"middle",children:[c.status_id==l?e.jsx(D,{content:"Este proyecto esta terminado",children:e.jsx("i",{className:"mdi mdi-18px mdi-check me-1 text-success"})}):"",c.project_status==null?e.jsx(D,{content:"Este proyecto esta archivado",children:e.jsx("i",{className:"mdi mdi-18px mdi-archive me-1 text-danger"})}):"",c.type.name]}),e.jsx("td",{valign:"middle",children:Ue($e)}),e.jsx("td",{valign:"middle",children:`S/. ${Z(c.cost)}`}),e.jsxs("td",{valign:"middle",children:[e.jsxs("p",{className:"mb-0 d-flex justify-content-between",children:[e.jsxs("b",{className:"text-success",children:[e.jsx("i",{className:"fa fa-arrow-circle-up"})," S/. ",_e]}),e.jsxs("b",{className:"float-end text-danger",children:[e.jsx("i",{className:"fa fa-arrow-circle-down"})," S/. ",De]})]}),e.jsx("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"},children:e.jsx("div",{className:"progress-bar bg-primary progress-animated wow animated",role:"progressbar","aria-valuenow":c.total_payments,"aria-valuemin":"0","aria-valuemax":c.cost,style:{width:`${J}%`,visibility:"visible",animationName:"animationProgress"}})})]}),e.jsx("td",{valign:"middle",children:Oe(c.starts_at,c.ends_at)}),e.jsx("td",{valign:"middle",children:e.jsx(Ge,{can:o,statuses:v,finishedProjectStatus:l,data:c,onChange:()=>{$(d.current).dxDataGrid("instance").refresh()}})}),e.jsxs("td",{children:[o("projects","root","all","assignUsers")&&e.jsx(h,{className:"btn btn-xs btn-soft-info me-1",title:"Asignar usuarios",icon:"fa fa-user-plus",onClick:()=>te(c),children:e.jsx("i",{className:"fa fa-user-plus"})}),o("projects","root","all","addpayment")&&e.jsx(h,{className:"btn btn-xs btn-soft-success",title:"Ver/Agregar pagos",icon:"fas fa-money-check-alt",onClick:()=>B(c),children:e.jsx("i",{className:"fas fa-money-check-alt"})})]})]},`project-${c.id}`)})})]})]})]))}}}),e.jsx(q,{modalRef:j,title:"Detalles del cliente",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:s=>s.preventDefault(),hideFooter:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsx("div",{className:"d-flex mb-3",children:e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h4",{className:"media-heading mt-0",children:t==null?void 0:t.contact_name}),e.jsx("span",{className:"badge bg-primary me-1",children:(t==null?void 0:t.contact_position)||"Trabajador"}),e.jsxs("small",{className:"text-muted",children:["desde ",e.jsx("b",{children:t==null?void 0:t.origin})]})]})}),e.jsx("hr",{}),e.jsx("h4",{children:"Estados"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-2",children:[e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado de gestión"}),e.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((re=t==null?void 0:t.status)==null?void 0:re.color)||"#6c757d"},children:((ne=t==null?void 0:t.status)==null?void 0:ne.name)||"Sin estado"})]}),e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado del lead"}),e.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((le=t==null?void 0:t.manage_status)==null?void 0:le.color)||"#6c757d"},children:((ce=t==null?void 0:t.manage_status)==null?void 0:ce.name)||"Sin estado"})]})]}),(t==null?void 0:t.assigned_to)&&e.jsxs(e.Fragment,{children:[e.jsx("b",{className:"d-block mb-1",children:"Atendido por:"}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("img",{className:"d-flex me-2 rounded-circle",src:`//${F.APP_DOMAIN}/api/profile/thumbnail/${(ie=t==null?void 0:t.assigned)==null?void 0:ie.relative_id}`,onError:s=>{s.target.src=`//${F.APP_DOMAIN}/assets/img/user-404.svg`},alt:(oe=t==null?void 0:t.assigned)==null?void 0:oe.name,height:"32"}),e.jsxs("div",{className:"w-100",children:[e.jsx("h5",{className:"m-0 font-14",children:(de=t==null?void 0:t.assigned)==null?void 0:de.name}),e.jsx("span",{className:"font-12 mb-0",children:(me=t==null?void 0:t.assigned)==null?void 0:me.email})]})]})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos del contacto"}),e.jsx("h5",{className:"font-600 mb-0",children:"Correo electronico"}),e.jsxs("p",{className:"mb-2 text-truncate",children:[" ",t==null?void 0:t.contact_email," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Tefono / Celular"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.contact_phone," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Mensaje"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.message," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Fecha de registro"}),e.jsxs("p",{className:"mb-2",children:[moment(t==null?void 0:t.created_at).format("LL"),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:moment(t==null?void 0:t.created_at).format("LTS")})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos de la empresa"}),e.jsx("h5",{className:"font-600 mb-0",children:"Nombre comercial"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.tradename)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"RUC"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.ruc)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"N° trabajadores"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.workers)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]})]}),e.jsx("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12",children:e.jsxs("div",{className:"card card-body",children:[e.jsxs("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:[e.jsx("i",{className:"mdi mdi-clock"})," Actividad"]})},"note-type-activity"),f.sort((s,a)=>s.order-a.order).map((s,a)=>{if(s.name!="Correos")return e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#note-type-${s.id}`,"data-name":s.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link",children:[e.jsx("i",{className:s.icon})," ",s.name]})},`note-type-${a}`)})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"note-type-activity",children:b.sort((s,a)=>a.created_at>s.created_at?1:-1).map((s,a)=>e.jsx(xe,{...s,showOptions:!1,session:y},`note-${a}`))},"tab-note-type-activity"),f.sort((s,a)=>s.order-a.order).map((s,a)=>e.jsxs("div",{className:"tab-pane",id:`note-type-${s.id}`,children:[e.jsxs("h4",{className:"header-title mb-2",children:["Lista de ",s.name]}),b.filter(i=>i.note_type_id==s.id).sort((i,m)=>m.created_at>i.created_at?1:-1).map((i,m)=>e.jsx(xe,{...i,session:y},`note-${m}`))]},`tab-note-type-${a}`))]})]})}),e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-danger",children:e.jsx("h5",{className:"header-title my-0 text-white",children:"Tareas"})}),e.jsx("div",{className:"card-body",children:X.length>0?X.sort((s,a)=>s.ends_at>a.ends_at?1:-1).map((s,a)=>e.jsx(Te,{...s},`task-${a}`)):e.jsx("i",{className:"text-muted",children:"- No hay tareas pendientes -"})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-primary",children:[e.jsxs("div",{className:"float-end text-white",children:["S/. ",Z(Y.reduce((s,a)=>s+Number(a.price),0))]}),e.jsx("h5",{className:"header-title my-0 text-white",children:"Productos"})]}),e.jsx("div",{className:"card-body",children:Y.length>0?e.jsx("div",{className:"mt-2 d-flex flex-column gap-2",children:Y.map((s,a)=>e.jsx("div",{className:"card mb-0",style:{border:`1px solid ${s.color}44`,backgroundColor:`${s.color}11`},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("div",{className:"float-end",children:e.jsx(D,{content:"Quitar producto",children:e.jsx("i",{className:"fa fa-times",onClick:()=>deleteClientProduct(s),style:{cursor:"pointer"}})})}),e.jsx("h5",{className:"header-title mt-0 mb-1",style:{fontSize:"14.4px",color:s.color},children:s.name}),e.jsxs("small",{children:["S/. ",Z(s.price)]})]})},a))}):e.jsx("i",{className:"text-muted",children:"- Sin productos -"})})]})]})]})}),e.jsxs(q,{modalRef:k,title:se?"Editar cliente":"Agregar cliente",onSubmit:ge,size:"md",children:[e.jsx("input",{ref:C,type:"hidden"}),e.jsxs("ul",{className:"nav nav-pills navtab-bg nav-justified",children:[e.jsx("li",{className:"nav-item",children:e.jsx(D,{content:"Datos del negocio",children:e.jsx("a",{href:"#client-data","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:"Negocio"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(D,{content:"Datos de contacto",children:e.jsx("a",{href:"#contact-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Contacto"})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"client-data",children:e.jsxs("div",{className:"row",children:[e.jsx(g,{eRef:R,label:"RUC",col:"col-4",required:!0}),e.jsx(g,{eRef:A,label:"Nombre comercial",col:"col-8",required:!0}),e.jsx(g,{eRef:S,label:"Razon social",col:"col-md-6",required:!0}),e.jsx(g,{eRef:_,label:"URL Web",col:"col-md-6"}),e.jsx(L,{eRef:E,label:"Mensaje",col:"col-12",required:!0})]})}),e.jsx("div",{className:"tab-pane show",id:"contact-data",children:e.jsxs("div",{className:"row",children:[e.jsx(g,{eRef:T,label:"Nombre de contacto",col:"col-6"}),e.jsx(g,{eRef:n,label:"Celular de contacto",type:"tel",col:"col-6"}),e.jsx(g,{eRef:u,label:"Email de contacto",col:"col-12",type:"email"}),e.jsx(L,{eRef:x,label:"Direccion de contacto",col:"col-12"})]})})]})]}),e.jsx(Me,{can:o,dataLoaded:V,setDataLoaded:B,grid2refresh:pe}),e.jsx(Je,{can:o,client:je,setClient:be,grid2refresh:d,page:"clients"}),e.jsx(Be,{dataLoaded:fe,setDataLoaded:te,grid2refresh:$(d.current).dxDataGrid("instance")})]})};Se((v,l)=>{if(!l.can("clients","root","all","list"))return location.href="/";Ae(v).render(e.jsx(Ee,{...l,title:"Clientes",children:e.jsx(es,{...l})}))});
