var U=Object.defineProperty;var W=(c,r,l)=>r in c?U(c,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[r]=l;var E=(c,r,l)=>W(c,typeof r!="symbol"?r+"":r,l);import{C as X,c as Y,j as s,r as o,G as P}from"./CreateReactScript-CdFATXLL.js";import{B as q,A as H,i as J}from"./Adminto-B_ZcJn3o.js";import{S as K}from"./sweetalert2.esm.all-BuvcKzCS.js";import{R as D}from"./ReactAppend-CjjPEe2D.js";import{C as V,P as L}from"./ProductsByClientsRest-BM1DlOjH.js";import{M as ss}from"./Modal-BJsTSCqc.js";import{T as es}from"./Table-B4SmTMhW.js";import{r as N}from"./server.browser-Bo-BiJWX.js";import{D as ts}from"./DxPanelButton-C55OhXoe.js";import{C as as,a as F,T as rs}from"./ClientNotesRest-DjyfLxRq.js";import{N as B}from"./Number2Currency-e57Tgsuk.js";import{T as G}from"./TippyButton-CVak2u-A.js";import"./Logout-Dfbya5P9.js";import"./default-CIFIzJWl.js";import"./index-kunFbdsj.js";import"./ArrayJoin-2k6ba35P.js";class cs extends q{constructor(){super(...arguments);E(this,"path","archived")}}const b=new cs,ns=new V,ls=new as,is=new L,os=({projectStatuses:c,finishedProjectStatus:r,archived:l,can:g,session:v,noteTypes:y})=>{var C,w,_,k,S,T,R,A;const m=o.useRef(),d=o.useRef(),[e,h]=o.useState(null),[n,x]=o.useState([]),[f,u]=o.useState([]),z=async({id:t,status:a})=>{await b.status({id:t,status:a})&&$(m.current).dxDataGrid("instance").refresh()},M=async t=>{const{isConfirmed:a}=await K.fire({title:"Estas seguro de eliminar a esta persona?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!a||!await b.delete(t)||$(m.current).dxDataGrid("instance").refresh()},O=async t=>{h(t),history.pushState(null,null,`/archived/${t.id}`),x([]),u([]),$(d.current).modal("show")};o.useEffect(()=>{I(),Z()},[e]);const I=async()=>{const t=await ls.byClient(e==null?void 0:e.id);x(t??[])},Z=async()=>{const t=await is.byClient(e==null?void 0:e.id);u(t)};o.useEffect(()=>{$(d.current).on("hidden.bs.modal",()=>{h(null),history.pushState(null,null,"/archived")}),l&&ns.get(l).then(t=>{t&&(h(t),x([]),u([]),$(d.current).modal("show"),GET.annotation&&$(`[data-name="${GET.annotation}"]`).click())})},[null]);const Q=[];n==null||n.forEach(t=>Q.push(...t.tasks));const j=[];return n==null||n.forEach(t=>j.push(...t.tasks.filter(a=>a.status!="Realizado"))),s.jsxs(s.Fragment,{children:[s.jsx(es,{gridRef:m,title:"Archivados",rest:b,toolBar:t=>{t.unshift(ts({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}))},pageSize:10,columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(t,{data:a})=>{t.attr("style","height: 48px; cursor: pointer"),t.on("click",()=>O(a)),t.html(N(s.jsx("b",{children:a.contact_name})))},fixed:!0,fixedPosition:"left"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(t,{data:a})=>{t.html(N(s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"mdi mdi-calendar-blank text-blue me-1"}),moment(a.created_at.replace("Z","+05:00")).format("lll")]})))},sortOrder:"desc"},{dataField:"updated_at",caption:"Fecha actualización",dataType:"date",cellTemplate:(t,{data:a})=>{t.html(N(s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"mdi mdi-calendar-blank text-blue me-1"}),moment(a.updated_at.replace("Z","+05:00")).format("lll")]})))}},{caption:"Acciones",width:235,cellTemplate:(t,{data:a})=>{t.attr("style","display: flex; gap: 4px; overflow: visible"),g("clients","root","all","changestatus")&&D(t,s.jsx(G,{className:"btn btn-xs btn-light",title:"Restaurar",onClick:()=>z(a),children:s.jsx("i",{className:"fas fa-trash-restore"})})),g("clients","root","all","delete")&&D(t,s.jsx(G,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>M(a.id),children:s.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(ss,{modalRef:d,title:"Detalles del archivado",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:t=>t.preventDefault(),hideFooter:!0,children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[s.jsx("div",{className:"d-flex mb-3",children:s.jsxs("div",{className:"flex-grow-1",children:[s.jsx("h4",{className:"media-heading mt-0",children:e==null?void 0:e.contact_name}),s.jsx("span",{className:"badge bg-primary me-1",children:(e==null?void 0:e.contact_position)||"Trabajador"}),s.jsxs("small",{className:"text-muted",children:["desde ",s.jsx("b",{children:e==null?void 0:e.origin})]})]})}),s.jsx("hr",{}),s.jsx("h4",{children:"Estados"}),s.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-2",children:[s.jsxs("div",{children:[s.jsx("b",{className:"d-block",children:"Estado de gestión"}),s.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((C=e==null?void 0:e.status)==null?void 0:C.color)||"#6c757d"},children:((w=e==null?void 0:e.status)==null?void 0:w.name)||"Sin estado"})]}),s.jsxs("div",{children:[s.jsx("b",{className:"d-block",children:"Estado del lead"}),s.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((_=e==null?void 0:e.manage_status)==null?void 0:_.color)||"#6c757d"},children:((k=e==null?void 0:e.manage_status)==null?void 0:k.name)||"Sin estado"})]})]}),(e==null?void 0:e.assigned_to)&&s.jsxs(s.Fragment,{children:[s.jsx("b",{className:"d-block mb-1",children:"Atendido por:"}),s.jsxs("div",{className:"d-flex align-items-start",children:[s.jsx("img",{className:"d-flex me-2 rounded-circle",src:`//${P.APP_DOMAIN}/api/profile/thumbnail/${(S=e==null?void 0:e.assigned)==null?void 0:S.relative_id}`,onError:t=>{t.target.src=`//${P.APP_DOMAIN}/assets/img/user-404.svg`},alt:(T=e==null?void 0:e.assigned)==null?void 0:T.name,height:"32"}),s.jsxs("div",{className:"w-100",children:[s.jsx("h5",{className:"m-0 font-14",children:(R=e==null?void 0:e.assigned)==null?void 0:R.name}),s.jsx("span",{className:"font-12 mb-0",children:(A=e==null?void 0:e.assigned)==null?void 0:A.email})]})]})]}),s.jsx("hr",{}),s.jsx("h4",{children:"Datos del contacto"}),s.jsx("h5",{className:"font-600 mb-0",children:"Correo electronico"}),s.jsxs("p",{className:"mb-2 text-truncate",children:[" ",e==null?void 0:e.contact_email," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"Tefono / Celular"}),s.jsxs("p",{className:"mb-2",children:[" ",e==null?void 0:e.contact_phone," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"Mensaje"}),s.jsxs("p",{className:"mb-2",children:[" ",e==null?void 0:e.message," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"Fecha de registro"}),s.jsxs("p",{className:"mb-2",children:[moment(e==null?void 0:e.created_at).format("LL"),s.jsx("br",{}),s.jsx("small",{className:"text-muted",children:moment(e==null?void 0:e.created_at).format("LTS")})]}),s.jsx("hr",{}),s.jsx("h4",{children:"Datos de la empresa"}),s.jsx("h5",{className:"font-600 mb-0",children:"Nombre comercial"}),s.jsxs("p",{className:"mb-2",children:[" ",(e==null?void 0:e.tradename)??s.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"RUC"}),s.jsxs("p",{className:"mb-2",children:[" ",(e==null?void 0:e.ruc)??s.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"N° trabajadores"}),s.jsxs("p",{className:"mb-2",children:[" ",(e==null?void 0:e.workers)??s.jsx("i",{className:"text-muted",children:"No especifica"})," "]})]}),s.jsx("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12",children:s.jsxs("div",{className:"card card-body",children:[s.jsxs("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto",overflowY:"hidden"},children:[s.jsx("li",{className:"nav-item",children:s.jsxs("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:[s.jsx("i",{className:"mdi mdi-clock"})," Actividad"]})},"note-type-activity"),y.sort((t,a)=>t.order-a.order).map((t,a)=>{if(t.name!="Correos")return s.jsx("li",{className:"nav-item",children:s.jsxs("a",{href:`#note-type-${t.id}`,"data-name":t.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link",children:[s.jsx("i",{className:t.icon})," ",t.name]})},`note-type-${a}`)})]}),s.jsxs("div",{className:"tab-content",children:[s.jsx("div",{className:"tab-pane active",id:"note-type-activity",children:n.sort((t,a)=>a.created_at>t.created_at?1:-1).map((t,a)=>s.jsx(F,{...t,showOptions:!1,session:v},`note-${a}`))},"tab-note-type-activity"),y.sort((t,a)=>t.order-a.order).map((t,a)=>s.jsxs("div",{className:"tab-pane",id:`note-type-${t.id}`,children:[s.jsxs("h4",{className:"header-title mb-2",children:["Lista de ",t.name]}),n.filter(i=>i.note_type_id==t.id).sort((i,p)=>p.created_at>i.created_at?1:-1).map((i,p)=>s.jsx(F,{...i,session:v},`note-${p}`))]},`tab-note-type-${a}`))]})]})}),s.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header bg-danger",children:s.jsx("h5",{className:"header-title my-0 text-white",children:"Tareas"})}),s.jsx("div",{className:"card-body",children:j.length>0?j.sort((t,a)=>t.ends_at>a.ends_at?1:-1).map((t,a)=>s.jsx(rs,{...t},`task-${a}`)):s.jsx("i",{className:"text-muted",children:"- No hay tareas pendientes -"})})]}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"card-header bg-primary",children:[s.jsxs("div",{className:"float-end text-white",children:["S/. ",B(f.reduce((t,a)=>t+Number(a.price),0))]}),s.jsx("h5",{className:"header-title my-0 text-white",children:"Productos"})]}),s.jsx("div",{className:"card-body",children:f.length>0?s.jsx("div",{className:"mt-2 d-flex flex-column gap-2",children:f.map((t,a)=>s.jsx("div",{className:"card mb-0",style:{border:`1px solid ${t.color}44`,backgroundColor:`${t.color}11`},children:s.jsxs("div",{className:"card-body p-2",children:[s.jsx("div",{className:"float-end",children:s.jsx(J,{content:"Quitar producto",children:s.jsx("i",{className:"fa fa-times",onClick:()=>deleteClientProduct(t),style:{cursor:"pointer"}})})}),s.jsx("h5",{className:"header-title mt-0 mb-1",style:{fontSize:"14.4px",color:t.color},children:t.name}),s.jsxs("small",{children:["S/. ",B(t.price)]})]})},a))}):s.jsx("i",{className:"text-muted",children:"- Sin productos -"})})]})]})]})})]})};X((c,r)=>{if(!r.can("clients","root","all","list"))return location.href="/";Y(c).render(s.jsx(H,{...r,title:"Archivados",children:s.jsx(os,{...r})}))});
