import{C as E,c as f,R as e,r as d}from"./CreateReactScript-Dcnwm1IN.js";import{A as y,i as p}from"./Adminto-D9rZW2Bq.js";import"./auto-tSUxE9xa.js";import{P as g,D as N,A as k}from"./DateRange-c-N2MWqq.js";import"./server.browser-CSCYH58z.js";const M=()=>{const[o,c]=d.useState([]),[u,h]=d.useState(!1),[l,m]=d.useState("all");d.useEffect(()=>{g.paginate({sort:[{selector:"ends_at",desc:!1}],requireTotalCount:!0,skip:0,take:100}).then(({data:t=[]})=>{c(t)})},[null]);const r=()=>{const t=moment(),a={delayed:[],thisMonth:[],future:{}};return o.forEach(n=>{const s=moment(n.ends_at);if(s.isBefore(t,"day"))a.delayed.push(n);else if(s.isSame(t,"month")&&s.isSame(t,"year"))a.thisMonth.push(n);else{const i=s.format("MMMM YYYY");a.future[i]||(a.future[i]=[]),a.future[i].push(n)}}),a},b=()=>{const t=moment();let a=o;switch(u&&(a=a.filter(n=>Number(n.remaining_amount)>0)),l){case"delayed":return a.filter(n=>moment(n.ends_at).isBefore(t,"day"));case"thisMonth":return a.filter(n=>{const s=moment(n.ends_at);return s.isSame(t,"month")&&s.isSame(t,"year")&&!s.isBefore(t,"day")});default:if(l.startsWith("month_")){const n=l.replace("month_","");return a.filter(s=>moment(s.ends_at).format("MMMM YYYY")===n)}return a}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"row"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-header"},e.createElement("div",{className:"dropdown float-end"},e.createElement(p,{content:"Ver proyectos",arrow:!0},e.createElement("a",{href:"/projects",className:"arrow-none card-drop"},e.createElement("i",{className:"mdi mdi-arrow-top-right"})))),e.createElement("h4",{className:"header-title mt-0 mb-0"},"Proyectos pendientes"),e.createElement("div",{className:"mt-2 d-flex gap-1 flex-wrap"},r().delayed.length>0&&e.createElement("button",{className:`btn btn-xs ${l==="delayed"?"btn-danger":"btn-soft-danger"}`,onClick:()=>m("delayed")},"Atrasados (",r().delayed.length,")"),r().thisMonth.length>0&&e.createElement("button",{className:`btn btn-xs ${l==="thisMonth"?"btn-primary":"btn-soft-primary"}`,onClick:()=>m("thisMonth")},"Este mes (",r().thisMonth.length,")"),Object.entries(r().future).map(([t,a])=>e.createElement("button",{key:t,className:`btn btn-xs ${l===`month_${t}`?"btn-success":"btn-soft-success"}`,onClick:()=>m(`month_${t}`)},t," (",a.length,")")),l!=="all"&&e.createElement("button",{className:"btn btn-xs btn-soft-secondary",onClick:()=>m("all")},"Mostrar todos"))),e.createElement("div",{className:"card-body",style:{height:"calc(100vh - 250px)",overflow:"auto"}},e.createElement("div",{className:"form-check form-switch mb-2 align-content-center"},e.createElement("input",{className:"form-check-input",type:"checkbox",id:"showDebtOnly",onChange:t=>h(t.target.checked),style:{cursor:"pointer"}}),e.createElement("label",{className:"form-check-label",htmlFor:"showDebtOnly",style:{cursor:"pointer"}},"Solo mostrar proyectos con deuda")),e.createElement("div",{className:"table-responsive"},e.createElement("table",{className:"table table-sm table-bordered table-striped mb-0"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Cliente"),e.createElement("th",null,"Fecha de desarrollo"),e.createElement("th",null,"Estado"),e.createElement("th",null,"Debe"),e.createElement("th",null,"Asignado a"))),e.createElement("tbody",null,b().map((t,a)=>{const n=t.users.map(s=>s.relative_id);return e.createElement("tr",{key:`project-${a}`},e.createElement("td",{className:`${moment(t.ends_at).isBefore(moment())?"text-danger":""}`},e.createElement("b",{className:"d-block"},t.client.tradename),e.createElement("small",null,t.name)),e.createElement("td",null,N(t.starts_at,t.ends_at)),e.createElement("td",null,e.createElement("span",{className:"badge",style:{backgroundColor:t.status.color}},t.status.name)),e.createElement("td",null,t.remaining_amount>0?e.createElement("b",{className:"text-danger"},"Debe"):"No debe"),e.createElement("td",null,k(n)))})))))))))};E((o,c)=>{f(o).render(e.createElement(y,{...c,title:"Cuadro de control"},e.createElement(M,{...c})))});
