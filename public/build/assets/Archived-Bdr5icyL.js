var Q=Object.defineProperty;var U=(c,r,l)=>r in c?Q(c,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[r]=l;var E=(c,r,l)=>U(c,typeof r!="symbol"?r+"":r,l);import{C as W,c as X,j as s,r as o,G as q}from"./CreateReactScript-CgEuCtoy.js";import{B as H,A as J,i as K}from"./Adminto-BFEzicnL.js";import{S as V}from"./index-D6qUN1Ro.js";import{R as A}from"./ReactAppend-XQOKTJts.js";import{C as Y,a as Z,P as L,b as D,T as ss}from"./ProductsByClientsRest-CADjH1b6.js";import{M as es}from"./Modal-Dp_0-Qk7.js";import{T as ts}from"./Table-DjJN6wkY.js";import{r as as}from"./server.browser-DtYOuO13.js";import{D as rs}from"./DxPanelButton-TL5fAOqj.js";import{N as P}from"./Number2Currency-e57Tgsuk.js";import{T as B}from"./TippyButton-CIJ3gXjz.js";import"./default-C8QyGrl1.js";import"./index-CC_HFtZZ.js";class cs extends H{constructor(){super(...arguments);E(this,"path","archived")}}const b=new cs,ns=new Y,ls=new Z,is=new L,os=({projectStatuses:c,finishedProjectStatus:r,archived:l,can:p,session:g,noteTypes:v})=>{var y,C,w,k,_,S,R,T;const m=o.useRef(),h=o.useRef(),[e,d]=o.useState(null),[n,x]=o.useState([]),[f,u]=o.useState([]),F=async({id:t,status:a})=>{await b.status({id:t,status:a})&&$(m.current).dxDataGrid("instance").refresh()},G=async t=>{const{isConfirmed:a}=await V.fire({title:"Estas seguro de eliminar a esta persona?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!a||!await b.delete(t)||$(m.current).dxDataGrid("instance").refresh()},M=async t=>{d(t),history.pushState(null,null,`/archived/${t.id}`),x([]),u([]),$(h.current).modal("show")};o.useEffect(()=>{z(),O()},[e]);const z=async()=>{const t=await ls.byClient(e==null?void 0:e.id);x(t??[])},O=async()=>{const t=await is.byClient(e==null?void 0:e.id);u(t)};o.useEffect(()=>{$(h.current).on("hidden.bs.modal",()=>{d(null),history.pushState(null,null,"/archived")}),l&&ns.get(l).then(t=>{t&&(d(t),x([]),u([]),$(h.current).modal("show"),GET.annotation&&$(`[data-name="${GET.annotation}"]`).click())})},[null]);const I=[];n==null||n.forEach(t=>I.push(...t.tasks));const j=[];return n==null||n.forEach(t=>j.push(...t.tasks.filter(a=>a.status!="Realizado"))),s.jsxs(s.Fragment,{children:[s.jsx(ts,{gridRef:m,title:"Archivados",rest:b,toolBar:t=>{t.unshift(rs({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}))},columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(t,{data:a})=>{t.attr("style","height: 48px; cursor: pointer"),t.on("click",()=>M(a)),t.html(as(s.jsx("b",{children:a.contact_name})))},fixed:!0,fixedPosition:"left"},{dataField:"contact_email",caption:"Correo"},{dataField:"contact_phone",caption:"Telefono"},{caption:"Acciones",width:235,cellTemplate:(t,{data:a})=>{t.attr("style","display: flex; gap: 4px; overflow: visible"),p("clients","root","all","changestatus")&&A(t,s.jsx(B,{className:"btn btn-xs btn-light",title:"Restaurar",onClick:()=>F(a),children:s.jsx("i",{className:"fas fa-trash-restore"})})),p("clients","root","all","delete")&&A(t,s.jsx(B,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>G(a.id),children:s.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),s.jsx(es,{modalRef:h,title:"Detalles del archivado",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:t=>t.preventDefault(),hideFooter:!0,children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[s.jsx("div",{className:"d-flex mb-3",children:s.jsxs("div",{className:"flex-grow-1",children:[s.jsx("h4",{className:"media-heading mt-0",children:e==null?void 0:e.contact_name}),s.jsx("span",{className:"badge bg-primary me-1",children:(e==null?void 0:e.contact_position)||"Trabajador"}),s.jsxs("small",{className:"text-muted",children:["desde ",s.jsx("b",{children:e==null?void 0:e.origin})]})]})}),s.jsx("hr",{}),s.jsx("h4",{children:"Estados"}),s.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-2",children:[s.jsxs("div",{children:[s.jsx("b",{className:"d-block",children:"Estado de gestión"}),s.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((y=e==null?void 0:e.status)==null?void 0:y.color)||"#6c757d"},children:((C=e==null?void 0:e.status)==null?void 0:C.name)||"Sin estado"})]}),s.jsxs("div",{children:[s.jsx("b",{className:"d-block",children:"Estado del lead"}),s.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((w=e==null?void 0:e.manage_status)==null?void 0:w.color)||"#6c757d"},children:((k=e==null?void 0:e.manage_status)==null?void 0:k.name)||"Sin estado"})]})]}),(e==null?void 0:e.assigned_to)&&s.jsxs(s.Fragment,{children:[s.jsx("b",{className:"d-block mb-1",children:"Atendido por:"}),s.jsxs("div",{className:"d-flex align-items-start",children:[s.jsx("img",{className:"d-flex me-2 rounded-circle",src:`//${q.APP_DOMAIN}/api/profile/thumbnail/${(_=e==null?void 0:e.assigned)==null?void 0:_.relative_id}`,alt:(S=e==null?void 0:e.assigned)==null?void 0:S.name,height:"32"}),s.jsxs("div",{className:"w-100",children:[s.jsx("h5",{className:"m-0 font-14",children:(R=e==null?void 0:e.assigned)==null?void 0:R.name}),s.jsx("span",{className:"font-12 mb-0",children:(T=e==null?void 0:e.assigned)==null?void 0:T.email})]})]})]}),s.jsx("hr",{}),s.jsx("h4",{children:"Datos del contacto"}),s.jsx("h5",{className:"font-600 mb-0",children:"Correo electronico"}),s.jsxs("p",{className:"mb-2 text-truncate",children:[" ",e==null?void 0:e.contact_email," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"Tefono / Celular"}),s.jsxs("p",{className:"mb-2",children:[" ",e==null?void 0:e.contact_phone," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"Mensaje"}),s.jsxs("p",{className:"mb-2",children:[" ",e==null?void 0:e.message," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"Fecha de registro"}),s.jsxs("p",{className:"mb-2",children:[moment(e==null?void 0:e.created_at).format("LL"),s.jsx("br",{}),s.jsx("small",{className:"text-muted",children:moment(e==null?void 0:e.created_at).format("LTS")})]}),s.jsx("hr",{}),s.jsx("h4",{children:"Datos de la empresa"}),s.jsx("h5",{className:"font-600 mb-0",children:"Nombre comercial"}),s.jsxs("p",{className:"mb-2",children:[" ",(e==null?void 0:e.tradename)??s.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"RUC"}),s.jsxs("p",{className:"mb-2",children:[" ",(e==null?void 0:e.ruc)??s.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),s.jsx("h5",{className:"font-600 mb-0",children:"N° trabajadores"}),s.jsxs("p",{className:"mb-2",children:[" ",(e==null?void 0:e.workers)??s.jsx("i",{className:"text-muted",children:"No especifica"})," "]})]}),s.jsx("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12",children:s.jsxs("div",{className:"card card-body",children:[s.jsxs("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto"},children:[s.jsx("li",{className:"nav-item",children:s.jsxs("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:[s.jsx("i",{className:"mdi mdi-clock"})," Actividad"]})},"note-type-activity"),v.sort((t,a)=>t.order-a.order).map((t,a)=>{if(t.name!="Correos")return s.jsx("li",{className:"nav-item",children:s.jsxs("a",{href:`#note-type-${t.id}`,"data-name":t.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link",children:[s.jsx("i",{className:t.icon})," ",t.name]})},`note-type-${a}`)})]}),s.jsxs("div",{className:"tab-content",children:[s.jsx("div",{className:"tab-pane active",id:"note-type-activity",children:n.sort((t,a)=>a.created_at>t.created_at?1:-1).map((t,a)=>s.jsx(D,{...t,showOptions:!1,session:g},`note-${a}`))},"tab-note-type-activity"),v.sort((t,a)=>t.order-a.order).map((t,a)=>s.jsxs("div",{className:"tab-pane",id:`note-type-${t.id}`,children:[s.jsxs("h4",{className:"header-title mb-2",children:["Lista de ",t.name]}),n.filter(i=>i.note_type_id==t.id).sort((i,N)=>N.created_at>i.created_at?1:-1).map((i,N)=>s.jsx(D,{...i,session:g},`note-${N}`))]},`tab-note-type-${a}`))]})]})}),s.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header bg-danger",children:s.jsx("h5",{className:"header-title my-0 text-white",children:"Tareas"})}),s.jsx("div",{className:"card-body",children:j.length>0?j.sort((t,a)=>t.ends_at>a.ends_at?1:-1).map((t,a)=>s.jsx(ss,{...t},`task-${a}`)):s.jsx("i",{className:"text-muted",children:"- No hay tareas pendientes -"})})]}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"card-header bg-primary",children:[s.jsxs("div",{className:"float-end text-white",children:["S/. ",P(f.reduce((t,a)=>t+Number(a.price),0))]}),s.jsx("h5",{className:"header-title my-0 text-white",children:"Productos"})]}),s.jsx("div",{className:"card-body",children:f.length>0?s.jsx("div",{className:"mt-2 d-flex flex-column gap-2",children:f.map((t,a)=>s.jsx("div",{className:"card mb-0",style:{border:`1px solid ${t.color}44`,backgroundColor:`${t.color}11`},children:s.jsxs("div",{className:"card-body p-2",children:[s.jsx("div",{className:"float-end",children:s.jsx(K,{content:"Quitar producto",children:s.jsx("i",{className:"fa fa-times",onClick:()=>deleteClientProduct(t),style:{cursor:"pointer"}})})}),s.jsx("h5",{className:"header-title mt-0 mb-1",style:{fontSize:"14.4px",color:t.color},children:t.name}),s.jsxs("small",{children:["S/. ",P(t.price)]})]})},a))}):s.jsx("i",{className:"text-muted",children:"- Sin productos -"})})]})]})]})})]})};W((c,r)=>{if(!r.can("clients","root","all","list"))return location.href="/";X(c).render(s.jsx(J,{...r,title:"Archivados",children:s.jsx(os,{...r})}))});
