var j=Object.defineProperty;var O=(o,s,r)=>s in o?j(o,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[s]=r;var N=(o,s,r)=>O(o,typeof s!="symbol"?s+"":s,r);import{m as H,C as J,c as V,R as e,r as l,G as f}from"./CreateReactScript-BslIeGzv.js";import{A as X}from"./Adminto-DbE-C8dB.js";import{S as z}from"./SelectFormGroup-C5LCWsMh.js";import{r as D}from"./server.browser-D7r-ug2n.js";import{N as i}from"./Number2Currency-e57Tgsuk.js";class b{}N(b,"kpi",async s=>{const{result:r}=await H.Fetch(`/api/dashboard/leads/kpi/${s}`);return{data:(r==null?void 0:r.data)??[],summary:(r==null?void 0:r.summary)??{}}});const Q=({months:o=[],currentMonth:s,currentYear:r})=>{const[g,S]=l.useState(`${r}-${s}`),[y,x]=l.useState([]),[w,C]=l.useState([]),[k,_]=l.useState(0),[M,A]=l.useState(0),[P,q]=l.useState(0),[I,R]=l.useState(0),[L,F]=l.useState(0),[G,T]=l.useState(0),[W,Y]=l.useState(0),[B,K]=l.useState(0),[c,E]=l.useState({}),[p,h]=l.useState([]),v=({id:t,text:a,element:n})=>{if(!t)return a;const m=$(n).data("option");return $(D(e.createElement("div",null,e.createElement("b",{className:"d-block"},a),e.createElement("small",null,e.createElement("i",{className:"me-1 fa fa-users"}),m.quantity," entradas"))))};l.useEffect(()=>{E({}),h([]),b.kpi(g).then(({data:t,summary:a})=>{C(t),x(a.grouped??[]),_(a.totalCount??0),A(a.clientsCount??0),q(a.archivedCount??0),R(a.managingCount??0),F(a.totalSum??0),T(a.clientsSum??0),Y(a.archivedSum??0),K(a.managingSum??0),E(a.leadSources??{}),h(a.originCounts??[])})},[g]),l.useEffect(()=>{const t=document.getElementById("leadsStatusPie");let a;return t&&(window.leadsStatusChart&&window.leadsStatusChart.destroy(),a=new Chart(t,{type:"pie",data:{labels:[f.APP_NAME,"WhatsApp","Integración"],datasets:[{data:[c.crm_count,c.whatsapp_count,c.integration_count],backgroundColor:["#f1556c","#1abc9c","#4a81d4"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),window.leadsStatusChart=a),()=>{window.leadsStatusChart&&window.leadsStatusChart.destroy()}},[c]),l.useEffect(()=>($('[data-plugin="knob"]').knob({draw:function(){const t=this.i.attr("data-count");$(this.i).val(t)}}),()=>{$('[data-plugin="knob"]').trigger("change")}),[c,p]);const u=c.crm_count+c.whatsapp_count+c.integration_count;return e.createElement(e.Fragment,null,e.createElement("div",{className:"row"},e.createElement("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2"},e.createElement(z,{minimumResultsForSearch:-1,templateResult:v,templateSelection:v,onChange:t=>S(t.target.value)},o.map((t,a)=>{const n=moment({month:t.month-1,year:t.year});return e.createElement("option",{key:a,value:t.id,"data-option":JSON.stringify(t)},n.format("MMMM YYYY").toTitleCase())})))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-12"},e.createElement("h4",{className:"mt-0 mb-2"},"Vista general de leads"))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-md-4"},e.createElement("div",{className:"card card-body"},e.createElement("div",{style:{height:"250px"}},e.createElement("canvas",{id:"leadsStatusPie",width:"100%",height:"100%"})),e.createElement("h4",{className:"mt-3 mb-2 text-center"},"Ingreso de leads"),e.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-evenly"},e.createElement("div",{className:"text-center"},e.createElement("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#f1556c","data-bgcolor":"#f1556c33",value:c.crm_count/u*100||0,"data-count":c.crm_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.createElement("small",{className:"text-muted d-block text-center"},f.APP_NAME)),e.createElement("div",{className:"text-center"},e.createElement("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#1abc9c","data-bgcolor":"#1abc9c33",value:c.whatsapp_count/u*100||0,"data-count":c.whatsapp_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.createElement("small",{className:"text-muted d-block text-center"},"WhatsApp")),e.createElement("div",{className:"text-center"},e.createElement("input",{"data-plugin":"knob","data-width":"60","data-height":"60","data-graph":"sources","data-fgcolor":"#4a81d4","data-bgcolor":"#4a81d433",value:c.integration_count/u*100||0,"data-count":c.integration_count||0,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.createElement("small",{className:"text-muted d-block text-center"},"Integracion"))))),e.createElement("div",{className:"col-md-8"},e.createElement("div",{className:"row"},e.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-info","data-plugin":"counterup"},k),e.createElement("h5",null,"Leads"),e.createElement("small",null,"S/. ",i(L)))))),e.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-success","data-plugin":"counterup"},M),e.createElement("h5",null,"Convertidos"),e.createElement("small",null,"S/. ",i(G)))))),e.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-danger","data-plugin":"counterup"},P),e.createElement("h5",null,"No convertidos"),e.createElement("small",null,"S/. ",i(W)))))),e.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"text-center"},e.createElement("h2",{className:"fw-normal text-primary","data-plugin":"counterup"},I),e.createElement("h5",null,"En gestion"),e.createElement("small",null,"S/. ",i(B))))))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-header"},e.createElement("h4",{className:"header-title text-center my-0"},"Ingreso de Leads por Integración")),e.createElement("div",{className:" card-body",style:{minHeight:"160px"}},e.createElement("div",{className:"d-flex flex-wrap gap-2 justify-content-evenly"},p.map((t,a)=>{const n=t.count||0,m=n/c.integration_count*100,d=`${n.origin}-${n.count}-${a}`;return e.createElement("div",{id:d,key:d,className:"text-center"},e.createElement("input",{"data-plugin":"knob","data-width":"100","data-height":"100","data-fgcolor":"#4a81d4","data-bgcolor":"#4a81d433",value:m,"data-count":n,"data-skin":"tron","data-angleloffset":"180","data-readonly":!0,"data-thickness":".15",style:{outline:"none",border:"none"}}),e.createElement("small",{className:"text-muted d-block text-center mt-1"},t.origin))})))))))),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"d-flex gap-3 mb-3",style:{overflowX:"auto"}},y.map((t,a)=>e.createElement("div",{key:a,className:"card",style:{minWidth:"270px",maxWidth:"270px"}},e.createElement("div",{className:"card-header"},e.createElement("div",{className:"float-end"},e.createElement("b",null,t.quantity)),e.createElement("h4",{className:"header-title my-0 text-truncate",style:{color:t.color}},t.name)),e.createElement("div",{className:"card-body"},e.createElement("div",{className:"d-flex gap-3 flex-column"},w.filter(({status_id:n})=>n==t.id).sort((n,m)=>m.quantity-n.quantity).map((n,m)=>{const d=(n.quantity/t.quantity*100).toFixed(2);return e.createElement("div",{key:m},e.createElement("h5",{className:"my-0"},n.manage_status_name," ",e.createElement("span",{className:"float-end",style:{color:n.manage_status_color}},n.quantity)),e.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0",style:{backgroundColor:`${n.manage_status_color}44`}},e.createElement("div",{className:"progress-bar progress-animated wow animated animated",role:"progressbar","aria-valuenow":d,"aria-valuemin":"0","aria-valuemax":"100",style:{width:`${d}%`,visibility:"visible",animationName:"animationProgress",backgroundColor:n.manage_status_color}})))})))))))))};J((o,s)=>{V(o).render(e.createElement(X,{...s,title:"KPI - Leads"},e.createElement(Q,{...s})))});
