var T=Object.defineProperty;var E=(n,t,r)=>t in n?T(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var x=(n,t,r)=>E(n,typeof t!="symbol"?t+"":t,r);import{m as S,C as F,c as U,j as e,r as d,G as P}from"./CreateReactScript-9UX3kXBD.js";import{U as _}from"./UsersRest-DE27vXo1.js";import{B as M,A as V,i as y}from"./Adminto-C-Pv7Jhd.js";import{M as B}from"./Modal-D0pWPGeP.js";import{t as D}from"./sweetalert2.esm.all-CVcmmqxW.js";class X extends M{constructor(){super(...arguments);x(this,"path","atalaya/users");x(this,"invite",async r=>{try{const{status:l,result:o}=await S.Fetch(`/api/${this.path}/invite`,{method:"POST",body:JSON.stringify({email:r})});if(!l)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return{status:!0}}catch(l){return{status:!1,message:l.message}}})}}const R=new X,G=new _,H=n=>{const{users:t,roles:r,APP_DOMAIN:l,match:o}=n;console.log(o);const p=d.useRef(),m=d.useRef(null),[j,f]=d.useState([]),[c,g]=d.useState(""),[N,C]=d.useState(null),[A,u]=d.useState(!1),O=async(s,a)=>{await G.assignRole({role:s.id,user:a.id})&&location.reload()},k=async s=>{const{data:a,summary:i}=await R.paginate({searchValue:s});u(!1),f(a),C((i==null?void 0:i.isValid)??null)},I=s=>{const a=s.target.value;g(a),m.current&&(R.controller.abort("Nothing"),clearTimeout(m.current)),f([]),u(!1),!(!a||a.length<3)&&(u(!0),m.current=setTimeout(()=>{k(a)},300))},b=async s=>{const{status:a,result:i}=await S.Fetch(`//${P.APP_DOMAIN}/api/users-by-services-by-business`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(Cookies.get("XSRF-TOKEN"))},body:JSON.stringify({email:s})});if(!a)return D((i==null?void 0:i.message)??"OcurriÃ³ un error inesperado",{icon:e.jsx("i",{className:"mdi mdi-alert text-danger"})})};return d.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),e.jsx(e.Fragment,{children:e.jsxs(V,{...n,title:"Usuarios",floatEnd:e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>$(p.current).modal("show"),children:[e.jsx("i",{className:"mdi mdi-account-plus me-1"}),"Invitar"]}),children:[e.jsx("div",{className:"d-flex flex-wrap align-items-center justify-content-center",style:{minHeight:"calc(100vh - 135px)",maxHeight:"max-content"},children:e.jsx("div",{className:"d-flex flex-wrap align-items-center justify-content-center gap-2",children:t.map((s,a)=>{var v,w;const i=((w=(v=s.service_user)==null?void 0:v.roles)==null?void 0:w[0])??{name:s.is_owner?"Owner":"Sin rol"};return e.jsx("div",{className:"card mb-0",style:{width:"360px"},children:e.jsx("div",{className:"card-body widget-user",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0 avatar-lg me-2",children:e.jsx("img",{src:`//${l}/api/profile/thumbnail/${s.relative_id}`,className:"img-fluid rounded-circle",alt:"user"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex-grow-1 overflow-hidden",style:{width:"215px"},children:[e.jsxs("h5",{className:"mt-0 mb-1 text-truncate",children:[s.name," ",s.lastname]}),e.jsx("p",{className:"text-muted mb-2 font-13 text-truncate",children:s.email})]}),e.jsx("div",{children:e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn btn-light btn-sm dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:[i.name," ",e.jsx("i",{className:"mdi mdi-chevron-down"})]}),e.jsxs("div",{className:"dropdown-menu",children:[r.map((h,J)=>e.jsx(y,{content:`Asignar rol ${h.name}`,children:e.jsxs("a",{className:"dropdown-item",href:"#",onClick:()=>O(h,s),children:[e.jsx("i",{className:"mdi mdi-account-convert me-2"}),h.name]})})),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("a",{className:"dropdown-item",href:"#",children:[e.jsx("i",{className:"mdi mdi-plus me-2"}),"Nuevo rol"]})]})]})})]})]})})},`user-${a}`)})})}),e.jsxs(B,{modalRef:p,title:"Invita usuarios",hideFooter:!0,onSubmit:s=>s.preventDefault(),onClose:()=>g(""),children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Ingresa nombre o correo",value:c,onChange:I}),c.length<3?e.jsx("div",{className:"text-center text-muted p-2 mt-2",children:"Ingresa al menos 3 caracteres"}):e.jsx(e.Fragment,{children:A?e.jsxs("div",{className:"text-center p-2 mt-2",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-muted mb-0",children:"Buscando usuarios..."})]}):j.length>0||N?e.jsxs("div",{className:"d-flex flex-column gap-2 mt-2",children:[j.map((s,a)=>e.jsx("div",{className:"card border mb-0",children:e.jsxs("div",{className:"card-body p-2 d-flex align-items-center gap-2",children:[e.jsx("img",{src:`//${l}/api/profile/thumbnail/${s.relative_id}`,className:"rounded-circle",alt:s.name,width:"40",height:"40"}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h5",{className:"mt-0 mb-1",children:s.fullname}),e.jsx("div",{className:"text-muted",children:s.email})]}),e.jsx("button",{className:"btn btn-white btn-sm rounded-pill",onClick:()=>b(s.email),children:e.jsx("i",{className:"mdi mdi-account-plus"})})]})},`found-${a}`)),N===!0&&e.jsx("div",{className:"card border mb-0",children:e.jsxs("div",{className:"card-body p-2 d-flex align-items-center gap-2",children:[e.jsx("img",{src:`//${l}/api/profile/thumbnail/undefined`,className:"rounded-circle",width:"40",height:"40"}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h5",{className:"mt-0 mb-1",children:c.split("@")[0]}),e.jsx("div",{className:"text-muted",children:c})]}),e.jsx(y,{content:"Invitar usuario a Atalaya",children:e.jsx("button",{className:"btn btn-white btn-sm rounded-pill",onClick:()=>b(c),children:e.jsx("i",{className:"mdi mdi-email-send"})})})]})},`found-${c}`)]}):c&&e.jsx("div",{className:"card card-body p-2 mt-2 text-center mb-0",children:"No se encontraron resultados"})})]})]})})};F((n,t)=>{U(n).render(e.jsx(H,{...t}))});
