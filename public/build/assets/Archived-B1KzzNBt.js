var Q=Object.defineProperty;var U=(n,r,o)=>r in n?Q(n,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[r]=o;var P=(n,r,o)=>U(n,typeof r!="symbol"?r+"":r,o);import{C as X,c as Y,j as e,r as m,G as D}from"./CreateReactScript-CdFATXLL.js";import{B as H,A as J,i as K}from"./Adminto-B_ZcJn3o.js";import{S as V}from"./sweetalert2.esm.all-BuvcKzCS.js";import{R as f}from"./ReactAppend-CjjPEe2D.js";import{C as L,P as ee}from"./ProductsByClientsRest-BM1DlOjH.js";import{M as se}from"./Modal-BJsTSCqc.js";import{T as te}from"./Table-B4SmTMhW.js";import{r as h}from"./server.browser-Bo-BiJWX.js";import{D as ae}from"./DxPanelButton-C55OhXoe.js";import{C as re,a as B,T as le}from"./ClientNotesRest-DjyfLxRq.js";import{N as G}from"./Number2Currency-e57Tgsuk.js";import{T as z}from"./TippyButton-CVak2u-A.js";import"./Logout-Dfbya5P9.js";import"./default-CIFIzJWl.js";import"./index-kunFbdsj.js";import"./ArrayJoin-2k6ba35P.js";class ne extends H{constructor(){super(...arguments);P(this,"path","archived")}}const v=new ne,ce=new L,ie=new re,oe=new ee,me=({projectStatuses:n,finishedProjectStatus:r,archived:o,can:y,session:w,noteTypes:C})=>{var _,T,k,S,R,F,E,A;const x=m.useRef(),u=m.useRef(),[t,p]=m.useState(null),[i,j]=m.useState([]),[b,N]=m.useState([]),M=async({id:s,status:a})=>{await v.status({id:s,status:a})&&$(x.current).dxDataGrid("instance").refresh()},O=async s=>{const{isConfirmed:a}=await V.fire({title:"Estas seguro de eliminar a esta persona?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!a||!await v.delete(s)||$(x.current).dxDataGrid("instance").refresh()},W=async s=>{p(s),history.pushState(null,null,`/archived/${s.id}`),j([]),N([]),$(u.current).modal("show")};m.useEffect(()=>{q(),I()},[t]);const q=async()=>{const s=await ie.byClient(t==null?void 0:t.id);j(s??[])},I=async()=>{const s=await oe.byClient(t==null?void 0:t.id);N(s)};m.useEffect(()=>{$(u.current).on("hidden.bs.modal",()=>{p(null),history.pushState(null,null,"/archived")}),o&&ce.get(o).then(s=>{s&&(p(s),j([]),N([]),$(u.current).modal("show"),GET.annotation&&$(`[data-name="${GET.annotation}"]`).click())})},[null]);const Z=[];i==null||i.forEach(s=>Z.push(...s.tasks));const g=[];return i==null||i.forEach(s=>g.push(...s.tasks.filter(a=>a.status!="Realizado"))),e.jsxs(e.Fragment,{children:[e.jsx(te,{gridRef:x,title:"Archivados",rest:v,toolBar:s=>{s.unshift(ae({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(x.current).dxDataGrid("instance").refresh()}))},pageSize:25,columns:[{dataField:"contact_name",caption:"Lead",width:250,cellTemplate:(s,{data:a})=>{s.attr("style","height: 48px; cursor: pointer"),s.on("click",()=>W(a)),s.html(h(e.jsx("b",{children:a.contact_name})))},fixed:!0,fixedPosition:"left"},{dataField:"contact_email",caption:"Correo",cellTemplate:(s,{data:a})=>{s.html(h(e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-email-outline text-blue me-1"}),a.contact_email]})))}},{dataField:"contact_phone",caption:"Telefono",cellTemplate:(s,{data:a})=>{s.html(h(e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-cellphone text-blue me-1"}),a.contact_phone]})))}},{dataField:"status.name",caption:"Estado de gesti처n",dataType:"string",width:180,cellTemplate:(s,{data:a})=>{var l,c,d;s.attr("style","overflow: visible"),f(s,e.jsx("span",{className:"btn rounded-pill",style:{border:"none",borderRadius:"25px",padding:"2px 12px",color:(l=a.status)==null?void 0:l.color,fontWeight:"bolder",backgroundColor:`${(c=a.status)==null?void 0:c.color}22`,cursor:"default"},children:(d=a.status)==null?void 0:d.name}))}},{dataField:"manage_status.name",caption:"Etiqueta",dataType:"string",width:180,cellTemplate:(s,{data:a})=>{var l,c,d;s.attr("style","overflow: visible"),f(s,e.jsx("span",{className:"btn rounded-pill",style:{border:"none",borderRadius:"25px",padding:"2px 12px",color:(l=a.manage_status)==null?void 0:l.color,fontWeight:"bolder",backgroundColor:`${(c=a.manage_status)==null?void 0:c.color}22`,cursor:"default"},children:((d=a.manage_status)==null?void 0:d.name)||"Sin etiqueta"}))}},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",cellTemplate:(s,{data:a})=>{s.html(h(e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-calendar-blank text-blue me-1"}),moment(a.created_at.replace("Z","+05:00")).format("lll")]})))}},{dataField:"updated_at",caption:"Fecha actualizaci처n",dataType:"date",cellTemplate:(s,{data:a})=>{s.html(h(e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-calendar-blank text-blue me-1"}),moment(a.updated_at.replace("Z","+05:00")).format("lll")]})))},sortOrder:"desc"},{caption:"Acciones",width:235,cellTemplate:(s,{data:a})=>{s.attr("style","display: flex; gap: 4px; overflow: visible"),y("clients","root","all","changestatus")&&f(s,e.jsx(z,{className:"btn btn-xs btn-light",title:"Restaurar",onClick:()=>M(a),children:e.jsx("i",{className:"fas fa-trash-restore"})})),y("clients","root","all","delete")&&f(s,e.jsx(z,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>O(a.id),children:e.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(se,{modalRef:u,title:"Detalles del archivado",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:s=>s.preventDefault(),hideFooter:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsx("div",{className:"d-flex mb-3",children:e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h4",{className:"media-heading mt-0",children:t==null?void 0:t.contact_name}),e.jsx("span",{className:"badge bg-primary me-1",children:(t==null?void 0:t.contact_position)||"Trabajador"}),e.jsxs("small",{className:"text-muted",children:["desde ",e.jsx("b",{children:t==null?void 0:t.origin})]})]})}),e.jsx("hr",{}),e.jsx("h4",{children:"Estados"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-2",children:[e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado de gesti처n"}),e.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((_=t==null?void 0:t.status)==null?void 0:_.color)||"#6c757d"},children:((T=t==null?void 0:t.status)==null?void 0:T.name)||"Sin estado"})]}),e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado del lead"}),e.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((k=t==null?void 0:t.manage_status)==null?void 0:k.color)||"#6c757d"},children:((S=t==null?void 0:t.manage_status)==null?void 0:S.name)||"Sin estado"})]})]}),(t==null?void 0:t.assigned_to)&&e.jsxs(e.Fragment,{children:[e.jsx("b",{className:"d-block mb-1",children:"Atendido por:"}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("img",{className:"d-flex me-2 rounded-circle",src:`//${D.APP_DOMAIN}/api/profile/thumbnail/${(R=t==null?void 0:t.assigned)==null?void 0:R.relative_id}`,onError:s=>{s.target.src=`//${D.APP_DOMAIN}/assets/img/user-404.svg`},alt:(F=t==null?void 0:t.assigned)==null?void 0:F.name,height:"32"}),e.jsxs("div",{className:"w-100",children:[e.jsx("h5",{className:"m-0 font-14",children:(E=t==null?void 0:t.assigned)==null?void 0:E.name}),e.jsx("span",{className:"font-12 mb-0",children:(A=t==null?void 0:t.assigned)==null?void 0:A.email})]})]})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos del contacto"}),e.jsx("h5",{className:"font-600 mb-0",children:"Correo electronico"}),e.jsxs("p",{className:"mb-2 text-truncate",children:[" ",t==null?void 0:t.contact_email," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Tefono / Celular"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.contact_phone," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Mensaje"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.message," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Fecha de registro"}),e.jsxs("p",{className:"mb-2",children:[moment(t==null?void 0:t.created_at).format("LL"),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:moment(t==null?void 0:t.created_at).format("LTS")})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos de la empresa"}),e.jsx("h5",{className:"font-600 mb-0",children:"Nombre comercial"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.tradename)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"RUC"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.ruc)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"N째 trabajadores"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.workers)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]})]}),e.jsx("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12",children:e.jsxs("div",{className:"card card-body",children:[e.jsxs("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto",overflowY:"hidden"},children:[e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:[e.jsx("i",{className:"mdi mdi-clock"})," Actividad"]})},"note-type-activity"),C.sort((s,a)=>s.order-a.order).map((s,a)=>{if(s.name!="Correos")return e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#note-type-${s.id}`,"data-name":s.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link",children:[e.jsx("i",{className:s.icon})," ",s.name]})},`note-type-${a}`)})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"note-type-activity",children:i.sort((s,a)=>a.created_at>s.created_at?1:-1).map((s,a)=>e.jsx(B,{...s,showOptions:!1,session:w},`note-${a}`))},"tab-note-type-activity"),C.sort((s,a)=>s.order-a.order).map((s,a)=>e.jsxs("div",{className:"tab-pane",id:`note-type-${s.id}`,children:[e.jsxs("h4",{className:"header-title mb-2",children:["Lista de ",s.name]}),i.filter(l=>l.note_type_id==s.id).sort((l,c)=>c.created_at>l.created_at?1:-1).map((l,c)=>e.jsx(B,{...l,session:w},`note-${c}`))]},`tab-note-type-${a}`))]})]})}),e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-danger",children:e.jsx("h5",{className:"header-title my-0 text-white",children:"Tareas"})}),e.jsx("div",{className:"card-body",children:g.length>0?g.sort((s,a)=>s.ends_at>a.ends_at?1:-1).map((s,a)=>e.jsx(le,{...s},`task-${a}`)):e.jsx("i",{className:"text-muted",children:"- No hay tareas pendientes -"})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-primary",children:[e.jsxs("div",{className:"float-end text-white",children:["S/. ",G(b.reduce((s,a)=>s+Number(a.price),0))]}),e.jsx("h5",{className:"header-title my-0 text-white",children:"Productos"})]}),e.jsx("div",{className:"card-body",children:b.length>0?e.jsx("div",{className:"mt-2 d-flex flex-column gap-2",children:b.map((s,a)=>e.jsx("div",{className:"card mb-0",style:{border:`1px solid ${s.color}44`,backgroundColor:`${s.color}11`},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("div",{className:"float-end",children:e.jsx(K,{content:"Quitar producto",children:e.jsx("i",{className:"fa fa-times",onClick:()=>deleteClientProduct(s),style:{cursor:"pointer"}})})}),e.jsx("h5",{className:"header-title mt-0 mb-1",style:{fontSize:"14.4px",color:s.color},children:s.name}),e.jsxs("small",{children:["S/. ",G(s.price)]})]})},a))}):e.jsx("i",{className:"text-muted",children:"- Sin productos -"})})]})]})]})})]})};X((n,r)=>{if(!r.can("clients","root","all","list"))return location.href="/";Y(n).render(e.jsx(J,{...r,title:"Archivados",children:e.jsx(me,{...r})}))});
