var k=Object.defineProperty;var I=(r,e,n)=>e in r?k(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var E=(r,e,n)=>I(r,typeof e!="symbol"?e+"":e,n);import{R as t,m as u,r as i}from"./CreateReactScript-BzwrR0sZ.js";import{D as q}from"./Dropdown-CjCrgRst.js";import{D as U}from"./DropdownItem-uEebZ_C2.js";import{P as J,U as R}from"./DateRange-CKh1GjyI.js";import{S as M,i as z}from"./Adminto-DuoVWNzw.js";import{M as _}from"./Modal-ChNOGOpW.js";import{I as x}from"./InputFormGroup-UB2lFvd0.js";import{T as C}from"./TippyButton-CZs5jfdH.js";import{S as D,a as G}from"./SetSelectValue-Cjw0rti6.js";const te=({statuses:r,finishedProjectStatus:e,data:n,onChange:l})=>{const c=async(o,a)=>{if(a===e){const{isConfirmed:p}=await M.fire({title:"¿Estás seguro de marcar este proyecto como terminado?",text:"Este proyecto podras verlo en a ventana de proyectos a partir de ahora",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});if(!p)return}await J.projectStatus(o,a)&&l()};return t.createElement(t.Fragment,null,t.createElement(q,{className:"btn btn-xs btn-light rounded-pill",title:n.status.name,tippy:"Actualizar estado",icon:{icon:"fa fa-circle",color:n.status.color}},r.map(({id:o,name:a,color:m})=>t.createElement(U,{key:o,onClick:()=>c(n.id,o)},t.createElement("i",{className:"fa fa-circle",style:{color:m}})," ",a))))};class y{}E(y,"paginate",async e=>{const{result:n}=await u.Fetch("/api/payments/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return n}),E(y,"byProject",async e=>{const{result:n}=await u.Fetch(`/api/payments/project/${e}`);return(n==null?void 0:n.data)??[]}),E(y,"save",async e=>{try{const{status:n,result:l}=await u.Fetch("/api/payments",{method:"POST",body:JSON.stringify(e)});if(!n)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return u.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:l.message,type:"success"}),!0}catch(n){return u.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}}),E(y,"status",async({id:e,status:n})=>{try{const{status:l,result:c}=await u.Fetch("/api/payments/status",{method:"PATCH",body:JSON.stringify({id:e,status:n})});if(!l)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return u.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(l){return u.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:l.message,type:"danger"}),!1}}),E(y,"delete",async e=>{try{const{status:n,result:l}=await u.Fetch(`/api/payments/${e}`,{method:"DELETE"});if(!n)throw new Error((l==null?void 0:l.message)??"Ocurrio un error inesperado");return u.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:l.message,type:"success"}),!0}catch(n){return u.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:n.message,type:"danger"}),!1}});const re=({can:r,dataLoaded:e,setDataLoaded:n,grid2refresh:l})=>{const c=i.useRef(),o=i.useRef(),a=i.useRef(),m=i.useRef(),p=i.useRef(),f=i.useRef(),[h,b]=i.useState([]),[w,N]=i.useState(!1),[S,P]=i.useState(Number(e==null?void 0:e.remaining_amount));i.useEffect(()=>{e.id&&B(),$(c.current).on("hidden.bs.modal",()=>{n({}),b([]),N(!1),o.current.value=null,a.current.value=null,m.current.value=null,f.current.value=null})},[e]);const B=async()=>{const s=await y.byProject(e==null?void 0:e.id);b(s),P(Number(e==null?void 0:e.remaining_amount)),a.current.value=(e==null?void 0:e.id)||null,$(c.current).modal("show")},A=async s=>{s.preventDefault();const g={id:o.current.value||void 0,payment_id:a.current.value,project_id:e.id,payment_type:m.current.value,amount:f.current.value,date:p.current.value};await y.save(g)&&(o.current.value=null,p.current.value=null,m.current.value=null,f.current.value=null,await j(),l.refresh())},j=async()=>{const s=await y.byProject(e.id),g=s.reduce((O,Y)=>Number(O)+Number(Y.amount),0),v={...e,total_payments:g,remaining_amount:e.cost-g};n(v),b(s)},T=async s=>{o.current.value=s.id,m.current.value=s.payment_type,f.current.value=s.amount,p.current.value=s.date||moment(s.created_at).format("YYYY-MM-DD"),P(Number(e==null?void 0:e.remaining_amount)+Number(s.amount)),N(!0)},F=async s=>{const{isConfirmed:g}=await M.fire({title:"Estas seguro de eliminar este pago?",text:"No podras revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!g||!await y.delete(s)||(await j(),l.refresh())};return t.createElement(_,{modalRef:c,title:`Pagos de ${e==null?void 0:e.name} - S/.${e==null?void 0:e.cost}`,onSubmit:A,hideButtonSubmit:!0},t.createElement("div",{className:`row ${!r("projects","all","addpayment","editpayment")&&"d-none"}`},t.createElement("input",{ref:a,type:"hidden"}),t.createElement("input",{ref:o,type:"hidden"}),t.createElement(x,{eRef:m,label:"Concepto",col:"col-12",required:!0}),t.createElement(x,{eRef:p,type:"date",label:"Fecha",col:"col-md-7",required:!0}),t.createElement("div",{className:"form-group col-md-5"},t.createElement("label",null,"Monto ",t.createElement("b",{className:"text-danger"},"*")),t.createElement("div",{className:"input-group"},t.createElement("input",{ref:f,type:"number",className:"form-control",placeholder:`Max: ${S}`,min:0,max:S||0,step:.01}),t.createElement(z,{content:w?"Actualizar pago":"Agregar pago"},t.createElement("button",{className:"btn input-group-text btn-dark waves-effect waves-light",type:"submit"},t.createElement("i",{className:`fa ${w?"fa-save":"fa-plus"}`})))))),t.createElement("hr",{className:"mb-2 mt-0"}),t.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-2"},t.createElement("thead",null,t.createElement("tr",null,r("projects","all","editpayment","deletepayment")&&t.createElement("th",null),t.createElement("th",null,"Concepto"),t.createElement("th",null,"Fecha"),t.createElement("th",null,"Monto"))),t.createElement("tbody",null,h.map(s=>(s.date||(s.date=moment(s.created_at).format("YYYY-MM-DD")),s)).sort((s,g)=>new Date(s.date)-new Date(g.date)).map(s=>t.createElement("tr",{key:`project-payment-${s.id}`},r("projects","all","editpayment","deletepayment")&&t.createElement("td",null,t.createElement("div",{className:"d-flex align-items-center gap-1"},r("projects","all","editpayment")&&t.createElement(C,{title:"Editar pago",className:"btn btn-xs btn-soft-primary",type:"button",onClick:()=>T(s)},t.createElement("i",{className:"fa fa-pen"})),r("projects","all","deletepayment")&&t.createElement(C,{title:"Eliminar pago",className:"btn btn-xs btn-soft-danger",type:"button",onClick:()=>F(s.id)},t.createElement("i",{className:"fa fa-trash"})))),t.createElement("td",null,s.payment_type),t.createElement("td",null,moment(s.date).format("LL")),t.createElement("td",null,"S/.",s.amount))))),t.createElement("table",{className:"table table-bordered table-sm table-responsive table-striped mb-0",style:{width:"max-content",float:"right"}},t.createElement("tbody",null,t.createElement("tr",null,t.createElement("th",{colSpan:3,className:"text-end"},"Pagado"),t.createElement("td",null,"S/.",e==null?void 0:e.total_payments)),t.createElement("tr",null,t.createElement("th",{colSpan:3,className:"text-end"},"Por pagar"),t.createElement("td",null,"S/.",e==null?void 0:e.remaining_amount)))))},ne=({dataLoaded:r,setDataLoaded:e,grid2refresh:n})=>{var p;const l=i.useRef(),c=i.useRef(),o=i.useRef();i.useEffect(()=>{r.id&&a(),$(l.current).on("hidden.bs.modal",()=>{c.current.value=null,D(o.current,null,null),e({})})},[r]);const a=async()=>{const f=await R.byProject(r==null?void 0:r.id);c.current.value=(r==null?void 0:r.id)||null,D(o.current,f,"id","fullname"),$(l.current).modal("show")},m=async f=>{f.preventDefault();const h={project_id:c.current.value,users:$(o.current).val()};await R.massiveByProject(h)&&($(l.current).modal("hide"),n.refresh())};return t.createElement(_,{modalRef:l,title:"Asignar usuarios al proyecto",onSubmit:m},t.createElement("div",{id:"assign-users-container"},t.createElement("p",null,"Que usuarios deseas asignar al proyecto ",t.createElement("b",null,r==null?void 0:r.name)," de ",t.createElement("b",null,(p=r==null?void 0:r.client)==null?void 0:p.name)),t.createElement("input",{ref:c,type:"hidden"}),t.createElement(G,{eRef:o,label:"Usuarios a asignar",col:"col-12",dropdownParent:"#assign-users-container",searchAPI:"/api/users/paginate",searchBy:"fullname",multiple:!0})))};export{ne as A,te as P,re as a};
