var b=Object.defineProperty;var h=(l,t,s)=>t in l?b(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var d=(l,t,s)=>h(l,typeof t!="symbol"?t+"":t,s);import{m as n,C as E,c as x,R as o,r as i}from"./CreateReactScript-BzwrR0sZ.js";import{A as w}from"./Adminto-DbqKSvzH.js";import{N}from"./Number2Currency-e57Tgsuk.js";import{T as F,D as T}from"./DxPanelButton-B0o8aYX1.js";import{D as v}from"./DxButton-CsjWvhyj.js";import{D as u}from"./DxBox-CPKh0yyu.js";import{D as S}from"./DateRange-DWS2g4w_.js";import{A as R}from"./Assigneds-Bi3N399T.js";import{R as D}from"./ReactAppend-CoTY4G2g.js";import"./server.browser-CLYKlTOS.js";class m{}d(m,"paginate",async t=>{const{result:s}=await n.Fetch("/api/projects/archived/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});return s}),d(m,"save",async t=>{try{const{status:s,result:r}=await n.Fetch("/api/projects",{method:"POST",body:JSON.stringify(t)});if(!s)throw new Error((r==null?void 0:r.message)||"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(s){return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}}),d(m,"status",async({id:t,status:s})=>{try{const{status:r,result:c}=await n.Fetch("/api/projects/status",{method:"PATCH",body:JSON.stringify({id:t,status:s})});if(!r)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(r){return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),d(m,"projectStatus",async(t,s)=>{try{const{status:r,result:c}=await n.Fetch("/api/projects/project-status",{method:"PATCH",body:JSON.stringify({project:t,status:s})});if(!r)throw new Error((c==null?void 0:c.message)??"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:c.message,type:"success"}),!0}catch(r){return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),d(m,"delete",async t=>{try{const{status:s,result:r}=await n.Fetch(`/api/projects/${t}`,{method:"DELETE"});if(!s)throw new Error((r==null?void 0:r.message)??"Ocurrio un error inesperado");return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:r.message,type:"success"}),!0}catch(s){return n.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:s.message,type:"danger"}),!1}});const _=({can:l})=>{const t=i.useRef();i.useRef(),i.useRef(),i.useRef(),i.useRef(),i.useRef(),i.useRef(),i.useRef(),i.useRef(),i.useRef(),i.useRef(),i.useRef();const[s,r]=i.useState(!1),[c,j]=i.useState({}),[C,A]=i.useState({}),g=async({id:a,status:e})=>{await m.status({id:a,status:e})&&$(t.current).dxDataGrid("instance").refresh()};return o.createElement(o.Fragment,null,o.createElement(F,{gridRef:t,title:"Proyectos Archivados",rest:m,exportable:!0,toolBar:a=>{a.unshift(T({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(t.current).dxDataGrid("instance").refresh()}))},filterValue:void 0,columns:[{dataField:"client.tradename",caption:"Nombre comercial",filterValue:n.GET.client||void 0,fixed:!0,fixedPosition:"left"},{dataField:"type.name",caption:"Tipo",visible:!1},{dataField:"name",caption:"Proyecto"},{dataField:"users",caption:"Asignados",dataType:"string",cellTemplate:(a,{data:e})=>{const p=(e.users||"").split("|").filter(Boolean);a.append(u([R(p)]))},visible:!1,allowExporting:!1},l("projects","root","all","addpayment")&&{dataField:"cost",caption:"Costo total",dataType:"number",cellTemplate:(a,{data:e})=>{a.text(`S/. ${N(e.cost)}`)}},l("projects","root","all","addpayment")&&{dataField:"remaining_amount",caption:"Debe",dataType:"number",cellTemplate:(a,{data:e})=>{const p=(e.total_payments/e.cost*100).toFixed(2),f=Number(e.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),y=Number(e.cost-e.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2});a.append(u([o.createElement(o.Fragment,null,o.createElement("p",{className:"mb-0 d-flex justify-content-between"},o.createElement("b",{className:"text-success"},o.createElement("i",{className:"fa fa-arrow-circle-up"})," S/. ",f),o.createElement("b",{className:"float-end text-danger"},o.createElement("i",{className:"fa fa-arrow-circle-down"})," S/. ",y)),o.createElement("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"}},o.createElement("div",{className:"progress-bar bg-primary progress-animated wow animated animated animated",role:"progressbar","aria-valuenow":e.total_payments,"aria-valuemin":"0","aria-valuemax":e.cost,style:{width:`${p}%`,visibility:"visible",animationName:"animationProgress"}})))],!1))},allowExporting:!1},{dataField:"starts_at",caption:"Fecha inicio proyecto",dataType:"date",format:"yyyy-MM-dd",cellTemplate:(a,{data:e})=>{a.text(moment(e.starts_at).format("LL"))}},{dataField:"ends_at",caption:"Fecha fin proyecto",dataType:"date",format:"yyyy-MM-dd",cellTemplate:(a,{data:e})=>{a.append(u([{width:"200px",height:"30px",children:S(e.starts_at,e.ends_at)}]))},sortOrder:"asc"},{dataField:"last_payment_date",caption:"Fecha ultimo pago",dataType:"datetime",format:"yyyy-MM-dd HH:mm:ss",cellTemplate:(a,{data:e})=>{if(!e.last_payment_date)return a.html('<i class="text-muted">- No hay pagos -</i>');a.text(moment(e.last_payment_date).format("LLL"))}},l("projects","root","all","changestatus")?{dataField:"status.name",caption:"Estado del proyecto",dataType:"string",cellTemplate:(a,{data:e})=>{a.attr("style","overflow: visible"),D(a,o.createElement("button",{className:"btn btn-xs btn-light rounded-pill",disabled:!0},o.createElement("i",{class:"fa fa-circle me-1",style:{color:e.status.color}}),e.status.name))}}:null,{caption:"Acciones",cellTemplate:(a,{data:e})=>{l("projects","root","all","delete")&&a.append(v({className:"btn btn-xs btn-soft-dark",title:"Restaurar",icon:"fas fa-trash-restore",onClick:()=>g(e)}))},allowFiltering:!1,allowExporting:!1}]}))};E((l,t)=>{if(!t.can("projects","root","all","list"))return location.href="/";x(l).render(o.createElement(w,{...t,title:"Proyectos archivados"},o.createElement(_,{...t})))});
