import{r as n,j as e,C as Ae,c as Ee,m as ue,G as xe}from"./CreateReactScript-B6O9ZSea.js";import{S as pe,A as Te,i as D}from"./Adminto-B43G_Npl.js";import{M}from"./Modal-BhoQjCqR.js";import{a as P,C as Fe,P as Pe,b as he,T as Ge}from"./ProductsByClientsRest-CoXf6jH3.js";import{I as v}from"./InputFormGroup-BlYFLmsq.js";import{T as K}from"./TextareaFormGroup-E3t8jAtw.js";import{S as Y,a as Be}from"./SetSelectValue-NfYNc4h7.js";import{D as Z}from"./DropdownItem-DQDHqnSE.js";import{D as Me}from"./DropdownEnd-BJ9JAA6O.js";import{P as qe,a as ze,A as Ie}from"./AssignUsersModal-DyNgChcB.js";import{R as N}from"./ReactAppend-BgXBm0oa.js";import{P as Ue,A as Oe,D as Ve}from"./DateRange-DQ7JnoCz.js";import{T as We,D as fe}from"./DxPanelButton-pL3cSJsr.js";import{T as h}from"./TippyButton-BonVcmlT.js";import{N as J}from"./Number2Currency-e57Tgsuk.js";import{D as He}from"./DxBox-zlQRErMP.js";import{D as Qe}from"./Dropdown-CBDdoNKc.js";import{L as Xe}from"./LeadsRest-D4srqZWD.js";import{r as Ye}from"./server.browser-B_O_MfoD.js";const Je=({can:g,client:r,setClient:q,grid2refresh:z,page:G})=>{const y=n.useRef(),i=n.useRef(),f=n.useRef(),w=n.useRef(),p=n.useRef(),o=n.useRef(),[k,j]=n.useState([]),[C,R]=n.useState(!1);n.useEffect(()=>{r.id&&S(),$(y.current).on("hidden.bs.modal",()=>{q({}),j([]),R(!1),f.current.value=null,Y(w.current,null,null),p.current.value=null,o.current.value=null})},[r]);const S=async()=>{const l=await P.byClient(r==null?void 0:r.id);j(l),$(y.current).modal("show")},A=async l=>{l.preventDefault();const u={id:f.current.value||void 0,type_id:w.current.value,client_id:r.id,name:p.current.value,description:o.current.value};await P.save(u)&&($(i.current).modal("hide"),f.current.value=null,Y(w.current,null,null),p.current.value=null,o.current.value=null,await _(),$(z.current).dxDataGrid("instance").refresh())},_=async()=>{const l=await P.byClient(r.id);j(l)},E=async l=>{f.current.value=l.id,Y(w.current,l.type.id,l.type.name),p.current.value=l.name,o.current.value=l.description,$(i.current).modal("show"),R(!0)},T=async l=>{const{isConfirmed:u}=await pe.fire({title:"Estas seguro de eliminar esta nota?",text:"No podras revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!u||!await P.delete(l)||(await _(),$(z.current).dxDataGrid("instance").refresh())};return e.jsxs(e.Fragment,{children:[e.jsx(M,{modalRef:y,title:`Notas de ${(r==null?void 0:r.tradename)||(r==null?void 0:r.name)||(r==null?void 0:r.contact_name)}`,size:"full-width",isStatic:!0,hideFooter:!0,children:e.jsxs("div",{style:{height:"calc(100vh - 180px)",overflowY:"auto"},children:[e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn btn-primary",type:"button",onClick:()=>$(i.current).modal("show"),children:"Agregar nota"})}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"d-flex flex-wrap flex-row justify-content-center gap-2",children:k.sort((l,u)=>new Date(u.created_at)-new Date(l.created_at)).map((l,u)=>{const x=moment(l.created_at),U=moment().diff(x,"hours")>12?x.format("lll"):x.fromNow();return e.jsx("div",{className:"card text-white bg-purple mb-0",style:{width:"100%",maxWidth:"300px",height:"max-content"},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex align-items-center border-bottom border-white pb-1 mb-1",children:[e.jsx("div",{className:"avatar-sm me-2 mb-1",children:e.jsx("img",{src:`/api/profile/thumbnail/${l.user.relative_id}?v=${new Date(l.user.updated_at).getTime()}`,className:"img-fluid rounded-circle",alt:"user"})}),e.jsxs("div",{className:"flex-grow-1 overflow-hidden",children:[e.jsxs("h5",{className:"text-white m-0",children:[l.user.name," ",l.user.lastname]}),e.jsx("p",{className:"text-white-50 m-0 font-13 text-truncate",children:U})]}),g(G,"root","all","editnotes","deletenotes")&&e.jsxs(Me,{children:[g(G,"root","all","editnotes")&&e.jsx(Z,{onClick:()=>E(l),children:"Editar"}),g(G,"root","all","deletenotes")&&e.jsx(Z,{onClick:()=>T(l.id),children:"Eliminar"})]})]}),e.jsxs("blockquote",{className:"card-bodyquote mb-0",children:[l.name&&e.jsx("b",{children:l.name}),e.jsx("p",{className:"mb-1",children:l.description})]})]})},`note-${u}`)})})]})}),e.jsx(M,{modalRef:i,title:C?"Editar nota":"Agregar nota",size:"sm",onSubmit:A,children:e.jsxs("div",{id:"note-crud-container",children:[e.jsx("input",{ref:f,type:"hidden"}),e.jsx(Be,{eRef:w,label:"Tipo de nota",col:"col-12",dropdownParent:"#note-crud-container",searchAPI:"/api/types/paginate",searchBy:"name",filter:["table_id","=","c81ad4fb-a895-4f4c-b4b3-5989a7a66a85"],required:!0}),e.jsx(v,{eRef:p,label:"Titulo de la nota"}),e.jsx(K,{eRef:o,label:"Descripcion de la nota",required:!0})]})})]})},F=new Fe,Ke=new Xe,Ze=new P,Le=new Pe,es=({projectStatuses:g,finishedProjectStatus:r,clientStatuses:q,products:z=[],manageStatuses:G,session:y,can:i,noteTypes:f,defaultClientStatus:w,client:p})=>{var ne,le,re,ce,ie,oe,de,me;const o=n.useRef(),k=n.useRef(),j=n.useRef(),C=n.useRef(),R=n.useRef(),S=n.useRef(),A=n.useRef(),_=n.useRef(),E=n.useRef(),T=n.useRef(),l=n.useRef(),u=n.useRef(),x=n.useRef(),[L,I]=n.useState(!1),[U,ee]=n.useState({}),[je,se]=n.useState({}),[be,ss]=n.useState({}),[Ne,ve]=n.useState({}),[ts,as]=n.useState([]),[t,O]=n.useState({}),[b,V]=n.useState([]),[W,H]=n.useState([]),te=s=>{s!=null&&s.id?I(!0):I(!1),$('[href="#client-data"]').addClass("active"),$('[href="#contact-data"]').removeClass("active"),$("#client-data").addClass("active"),$("#contact-data").removeClass("active"),C.current.value=(s==null?void 0:s.id)||null,R.current.value=(s==null?void 0:s.ruc)||null,S.current.value=(s==null?void 0:s.name)||null,A.current.value=(s==null?void 0:s.tradename)||null,_.current.value=(s==null?void 0:s.web_url)||null,E.current.value=(s==null?void 0:s.message)||"Cliente creado desde Atalaya",T.current.value=(s==null?void 0:s.contact_name)||null,l.current.value=(s==null?void 0:s.contact_phone)||null,u.current.value=(s==null?void 0:s.contact_email)||null,x.current.value=(s==null?void 0:s.contact_address)||null,$(k.current).modal("show")},ge=async s=>{s.preventDefault();const a={id:C.current.value||void 0,ruc:R.current.value,name:S.current.value,tradename:A.current.value,web_url:_.current.value,message:E.current.value??"Cliente creado desde Atalaya",contact_name:T.current.value??"",contact_phone:l.current.value??"",contact_email:u.current.value??"",contact_address:x.current.value??"",status_id:C.current.value?void 0:w};await F.save(a)&&($(o.current).dxDataGrid("instance").refresh(),$(k.current).modal("hide"))},ye=async s=>{const{isConfirmed:a}=await pe.fire({title:"Estas seguro de eliminar este lead?",text:"No podras revertir esta accion!",icon:"warning",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Cancelar"});!a||!await F.delete(s)||$(o.current).dxDataGrid("instance").refresh()},ae=async(s,a)=>{await F.assign(s,a)&&$(o.current).dxDataGrid("instance").refresh()},we=async(s,a)=>{await Ke.leadStatus({lead:s,status:a}),$(o.current).dxDataGrid("instance").refresh()},B=async s=>{O(s),history.pushState(null,null,`/clients/${s.id}`),V([]),H([]),$(j.current).modal("show")};n.useEffect(()=>{Ce(),Re()},[t]);const Ce=async()=>{const s=await Ze.byClient(t==null?void 0:t.id);V(s??[])},Re=async()=>{const s=await Le.byClient(t==null?void 0:t.id);H(s)};n.useEffect(()=>{$(j.current).on("hidden.bs.modal",()=>{O(null),history.pushState(null,null,"/clients")}),p&&F.get(p).then(s=>{s&&(O(s),V([]),H([]),$(j.current).modal("show"),ue.GET.annotation&&$(`[data-name="${ue.GET.annotation}"]`).click())})},[null]);const _e=[];b==null||b.forEach(s=>_e.push(...s.tasks));const Q=[];return b==null||b.forEach(s=>Q.push(...s.tasks.filter(a=>a.status!="Realizado"))),e.jsxs(e.Fragment,{children:[e.jsx(We,{gridRef:o,title:"Clientes",rest:F,toolBar:s=>{s.unshift(fe({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(o.current).dxDataGrid("instance").refresh()})),i("clients","all","create")&&s.unshift(fe({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>te()}))},columns:[i("projects","root","all","list")?{dataField:"id",caption:"ID",dataType:"number",cellTemplate:(s,{data:a,value:d,...m})=>{N(s,e.jsxs(h,{className:"btn btn-xs btn-white",title:`Ver ${a.projects_count} proyectos`,onClick:()=>{m.component.collapseAll(-1),m.component.expandRow(m.row.data)},children:[e.jsx("i",{className:"fas fa-shapes"})," ",a.projects_count]}))},sortOrder:"desc"}:null,{dataField:"ruc",caption:"RUC",cellTemplate:(s,{data:a})=>{s.attr("style","height: 48px; cursor: pointer"),s.on("click",()=>B(a)),s.html(a.ruc||'<i class="text-muted">- Sin RUC -</i>')}},{dataField:"tradename",caption:"Nombre comercial",width:250,cellTemplate:(s,{data:a})=>{s.attr("style","height: 48px; cursor: pointer"),s.on("click",()=>B(a)),N(s,e.jsxs("div",{className:"d-flex align-items-center",children:[a.assigned_to&&e.jsx(D,{content:`Atendido por ${a.assigned.name} ${a.assigned.lastname}`,children:e.jsx("img",{className:"avatar-xs rounded-circle me-1",src:`//${xe.APP_DOMAIN}/api/profile/thumbnail/${a.assigned.relative_id}`,alt:a.assigned.name})}),e.jsx("div",{children:a.tradename||e.jsx("i",{className:"text-muted",children:"- Sin nombre -"})})]}))}},{dataField:"name",caption:"Razon social",visible:!1},{dataField:"contact_name",caption:"Nombre de contacto",width:250,cellTemplate:(s,{data:a})=>{s.attr("style","height: 48px; cursor: pointer"),s.on("click",()=>B(a)),s.html(Ye(e.jsx("b",{children:a.contact_name})))}},{dataField:"contact_phone",caption:"Telefono"},{dataField:"contact_email",caption:"Correo"},i("clients","root","all","changestatus")?{dataField:"status.name",caption:"Estado del cliente",dataType:"string",cellTemplate:(s,{data:a})=>{s.attr("style","overflow: visible"),N(s,e.jsx(Qe,{className:"btn btn-xs btn-white rounded-pill",title:a.status.name,icon:{icon:"fa fa-circle",color:a.status.color},tippy:"Actualizar estado",children:q.map(({id:d,name:m,color:c})=>e.jsxs(Z,{onClick:()=>we(a.id,d),children:[e.jsx("i",{className:"fa fa-circle",style:{color:c}})," ",m]},d))}))}}:null,i("clients","root","all","list","update","changestatus","delete")?{caption:"Acciones",width:235,cellTemplate:(s,{data:a})=>{s.attr("style","display: flex; gap: 4px; overflow: visible"),N(s,e.jsx(h,{className:"btn btn-xs btn-soft-primary",title:"Ver detalles",onClick:()=>B(a),children:e.jsx("i",{className:"fa fa-eye"})})),i("clients","root","all","update")&&N(s,e.jsx(h,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>te(a),children:e.jsx("i",{className:"fa fa-pen"})})),a.assigned_to?a.assigned_to==y.id&&N(s,e.jsx(h,{className:"btn btn-xs btn-soft-danger",title:"Dejar de atender",onClick:()=>ae(a.id,!1),children:e.jsx("i",{className:"fas fa-hands-wash"})})):N(s,e.jsx(h,{className:"btn btn-xs btn-soft-dark",title:"Atender lead",onClick:()=>ae(a.id,!0),children:e.jsx("i",{className:"fas fa-hands-helping"})})),i("clients","root","all","delete")&&N(s,e.jsx(h,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>ye(a.id),children:e.jsx("i",{className:"fa fa-trash-alt"})}))},allowFiltering:!1,allowExporting:!1}:null],masterDetail:{enabled:!1,template:async(s,{data:a,component:d})=>{s.css("padding","10px"),s.css("overflow","visible"),s.css("background-color","#323a46");let{data:m}=await Ue.paginate({filter:["client_id","=",a.id],isLoadingAll:!0});s.append(He([e.jsxs(e.Fragment,{children:[e.jsx(h,{title:"Cerrar tabla",className:"btn btn-xs btn-soft-danger waves-effect mb-1",onClick:()=>d.collapseAll(-1),children:e.jsx("i",{className:"fa fa-times"})}),e.jsxs("table",{className:"table table-dark table-sm table-bordered mb-0",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Tipo"}),e.jsx("th",{scope:"col",children:"Asignados"}),e.jsx("th",{scope:"col",children:"Costo"}),e.jsx("th",{scope:"col",children:"Pagos"}),e.jsx("th",{scope:"col",children:"Fecha de desarrollo"}),e.jsx("th",{scope:"col",children:"Estado del proyecto"}),e.jsx("th",{scope:"col",children:"Acciones"})]})}),e.jsx("tbody",{children:m==null?void 0:m.sort((c,X)=>X.project_status==null?-1:1).map(c=>{const X=(c.total_payments/c.cost*100).toFixed(2),De=Number(c.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),ke=Number(c.cost-c.total_payments).toLocaleString("en-US",{maximumFractionDigits:2,minimumFractionDigits:2}),$e=c.users.map(Se=>Se.relative_id);return e.jsxs("tr",{children:[e.jsxs("td",{valign:"middle",children:[c.status_id==r?e.jsx(D,{content:"Este proyecto esta terminado",children:e.jsx("i",{className:"mdi mdi-18px mdi-check me-1 text-success"})}):"",c.project_status==null?e.jsx(D,{content:"Este proyecto esta archivado",children:e.jsx("i",{className:"mdi mdi-18px mdi-archive me-1 text-danger"})}):"",c.type.name]}),e.jsx("td",{valign:"middle",children:Oe($e)}),e.jsx("td",{valign:"middle",children:`S/. ${J(c.cost)}`}),e.jsxs("td",{valign:"middle",children:[e.jsxs("p",{className:"mb-0 d-flex justify-content-between",children:[e.jsxs("b",{className:"text-success",children:[e.jsx("i",{className:"fa fa-arrow-circle-up"})," S/. ",De]}),e.jsxs("b",{className:"float-end text-danger",children:[e.jsx("i",{className:"fa fa-arrow-circle-down"})," S/. ",ke]})]}),e.jsx("div",{className:"progress progress-bar-alt-primary progress-sm mt-0 mb-0",style:{width:"200px"},children:e.jsx("div",{className:"progress-bar bg-primary progress-animated wow animated",role:"progressbar","aria-valuenow":c.total_payments,"aria-valuemin":"0","aria-valuemax":c.cost,style:{width:`${X}%`,visibility:"visible",animationName:"animationProgress"}})})]}),e.jsx("td",{valign:"middle",children:Ve(c.starts_at,c.ends_at)}),e.jsx("td",{valign:"middle",children:e.jsx(qe,{can:i,statuses:g,finishedProjectStatus:r,data:c,onChange:()=>{$(o.current).dxDataGrid("instance").refresh()}})}),e.jsxs("td",{children:[i("projects","root","all","assignUsers")&&e.jsx(h,{className:"btn btn-xs btn-soft-info me-1",title:"Asignar usuarios",icon:"fa fa-user-plus",onClick:()=>se(c),children:e.jsx("i",{className:"fa fa-user-plus"})}),i("projects","root","all","addpayment")&&e.jsx(h,{className:"btn btn-xs btn-soft-success",title:"Ver/Agregar pagos",icon:"fas fa-money-check-alt",onClick:()=>ee(c),children:e.jsx("i",{className:"fas fa-money-check-alt"})})]})]},`project-${c.id}`)})})]})]})]))}}}),e.jsx(M,{modalRef:j,title:"Detalles del cliente",btnSubmitText:"Guardar",size:"full-width",bodyClass:"p-3 bg-light",isStatic:!0,onSubmit:s=>s.preventDefault(),hideFooter:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsx("div",{className:"d-flex mb-3",children:e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h4",{className:"media-heading mt-0",children:t==null?void 0:t.contact_name}),e.jsx("span",{className:"badge bg-primary me-1",children:(t==null?void 0:t.contact_position)||"Trabajador"}),e.jsxs("small",{className:"text-muted",children:["desde ",e.jsx("b",{children:t==null?void 0:t.origin})]})]})}),e.jsx("hr",{}),e.jsx("h4",{children:"Estados"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-between mb-2",children:[e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado de gestión"}),e.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((ne=t==null?void 0:t.status)==null?void 0:ne.color)||"#6c757d"},children:((le=t==null?void 0:t.status)==null?void 0:le.name)||"Sin estado"})]}),e.jsxs("div",{children:[e.jsx("b",{className:"d-block",children:"Estado del lead"}),e.jsx("span",{className:"btn btn-light btn-sm",style:{cursor:"default",color:"#ffffff",backgroundColor:((re=t==null?void 0:t.manage_status)==null?void 0:re.color)||"#6c757d"},children:((ce=t==null?void 0:t.manage_status)==null?void 0:ce.name)||"Sin estado"})]})]}),(t==null?void 0:t.assigned_to)&&e.jsxs(e.Fragment,{children:[e.jsx("b",{className:"d-block mb-1",children:"Atendido por:"}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("img",{className:"d-flex me-2 rounded-circle",src:`//${xe.APP_DOMAIN}/api/profile/thumbnail/${(ie=t==null?void 0:t.assigned)==null?void 0:ie.relative_id}`,alt:(oe=t==null?void 0:t.assigned)==null?void 0:oe.name,height:"32"}),e.jsxs("div",{className:"w-100",children:[e.jsx("h5",{className:"m-0 font-14",children:(de=t==null?void 0:t.assigned)==null?void 0:de.name}),e.jsx("span",{className:"font-12 mb-0",children:(me=t==null?void 0:t.assigned)==null?void 0:me.email})]})]})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos del contacto"}),e.jsx("h5",{className:"font-600 mb-0",children:"Correo electronico"}),e.jsxs("p",{className:"mb-2 text-truncate",children:[" ",t==null?void 0:t.contact_email," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Tefono / Celular"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.contact_phone," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Mensaje"}),e.jsxs("p",{className:"mb-2",children:[" ",t==null?void 0:t.message," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"Fecha de registro"}),e.jsxs("p",{className:"mb-2",children:[moment(t==null?void 0:t.created_at).format("LL"),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:moment(t==null?void 0:t.created_at).format("LTS")})]}),e.jsx("hr",{}),e.jsx("h4",{children:"Datos de la empresa"}),e.jsx("h5",{className:"font-600 mb-0",children:"Nombre comercial"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.tradename)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"RUC"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.ruc)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]}),e.jsx("h5",{className:"font-600 mb-0",children:"N° trabajadores"}),e.jsxs("p",{className:"mb-2",children:[" ",(t==null?void 0:t.workers)??e.jsx("i",{className:"text-muted",children:"No especifica"})," "]})]}),e.jsx("div",{className:"col-lg-6 col-md-4 col-sm-6 col-xs-12",children:e.jsxs("div",{className:"card card-body",children:[e.jsxs("ul",{className:"nav nav-tabs",style:{flexWrap:"nowrap",overflowX:"auto"},children:[e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:"#note-type-activity","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:[e.jsx("i",{className:"mdi mdi-clock"})," Actividad"]})},"note-type-activity"),f.sort((s,a)=>s.order-a.order).map((s,a)=>{if(s.name!="Correos")return e.jsx("li",{className:"nav-item",children:e.jsxs("a",{href:`#note-type-${s.id}`,"data-name":s.name,"data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link",children:[e.jsx("i",{className:s.icon})," ",s.name]})},`note-type-${a}`)})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"note-type-activity",children:b.sort((s,a)=>a.created_at>s.created_at?1:-1).map((s,a)=>e.jsx(he,{...s,showOptions:!1,session:y},`note-${a}`))},"tab-note-type-activity"),f.sort((s,a)=>s.order-a.order).map((s,a)=>e.jsxs("div",{className:"tab-pane",id:`note-type-${s.id}`,children:[e.jsxs("h4",{className:"header-title mb-2",children:["Lista de ",s.name]}),b.filter(d=>d.note_type_id==s.id).sort((d,m)=>m.created_at>d.created_at?1:-1).map((d,m)=>e.jsx(he,{...d,session:y},`note-${m}`))]},`tab-note-type-${a}`))]})]})}),e.jsxs("div",{className:"col-lg-3 col-md-4 col-sm-6 col-xs-12",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-danger",children:e.jsx("h5",{className:"header-title my-0 text-white",children:"Tareas"})}),e.jsx("div",{className:"card-body",children:Q.length>0?Q.sort((s,a)=>s.ends_at>a.ends_at?1:-1).map((s,a)=>e.jsx(Ge,{...s},`task-${a}`)):e.jsx("i",{className:"text-muted",children:"- No hay tareas pendientes -"})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header bg-primary",children:[e.jsxs("div",{className:"float-end text-white",children:["S/. ",J(W.reduce((s,a)=>s+Number(a.price),0))]}),e.jsx("h5",{className:"header-title my-0 text-white",children:"Productos"})]}),e.jsx("div",{className:"card-body",children:W.length>0?e.jsx("div",{className:"mt-2 d-flex flex-column gap-2",children:W.map((s,a)=>e.jsx("div",{className:"card mb-0",style:{border:`1px solid ${s.color}44`,backgroundColor:`${s.color}11`},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("div",{className:"float-end",children:e.jsx(D,{content:"Quitar producto",children:e.jsx("i",{className:"fa fa-times",onClick:()=>deleteClientProduct(s),style:{cursor:"pointer"}})})}),e.jsx("h5",{className:"header-title mt-0 mb-1",style:{fontSize:"14.4px",color:s.color},children:s.name}),e.jsxs("small",{children:["S/. ",J(s.price)]})]})},a))}):e.jsx("i",{className:"text-muted",children:"- Sin productos -"})})]})]})]})}),e.jsxs(M,{modalRef:k,title:L?"Editar cliente":"Agregar cliente",onSubmit:ge,size:"md",children:[e.jsx("input",{ref:C,type:"hidden"}),e.jsxs("ul",{className:"nav nav-pills navtab-bg nav-justified",children:[e.jsx("li",{className:"nav-item",children:e.jsx(D,{content:"Datos del negocio",children:e.jsx("a",{href:"#client-data","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link active",children:"Negocio"})})}),e.jsx("li",{className:"nav-item",children:e.jsx(D,{content:"Datos de contacto",children:e.jsx("a",{href:"#contact-data","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link",children:"Contacto"})})})]}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:"tab-pane active",id:"client-data",children:e.jsxs("div",{className:"row",children:[e.jsx(v,{eRef:R,label:"RUC",col:"col-4",required:!0}),e.jsx(v,{eRef:A,label:"Nombre comercial",col:"col-8",required:!0}),e.jsx(v,{eRef:S,label:"Razon social",col:"col-md-6",required:!0}),e.jsx(v,{eRef:_,label:"URL Web",col:"col-md-6"}),e.jsx(K,{eRef:E,label:"Mensaje",col:"col-12",required:!0})]})}),e.jsx("div",{className:"tab-pane show",id:"contact-data",children:e.jsxs("div",{className:"row",children:[e.jsx(v,{eRef:T,label:"Nombre de contacto",col:"col-6"}),e.jsx(v,{eRef:l,label:"Celular de contacto",type:"tel",col:"col-6"}),e.jsx(v,{eRef:u,label:"Email de contacto",col:"col-12",type:"email"}),e.jsx(K,{eRef:x,label:"Direccion de contacto",col:"col-12"})]})})]})]}),e.jsx(ze,{can:i,dataLoaded:U,setDataLoaded:ee,grid2refresh:be}),e.jsx(Je,{can:i,client:Ne,setClient:ve,grid2refresh:o,page:"clients"}),e.jsx(Ie,{dataLoaded:je,setDataLoaded:se,grid2refresh:$(o.current).dxDataGrid("instance")})]})};Ae((g,r)=>{if(!r.can("clients","root","all","list"))return location.href="/";Ee(g).render(e.jsx(Te,{...r,title:"Clientes",children:e.jsx(es,{...r})}))});
